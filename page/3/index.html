<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="//page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zheng Xing">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com///page/3/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/25/%E7%AE%97%E6%B3%95leetcode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/25/%E7%AE%97%E6%B3%95leetcode/" itemprop="url">算法leetcode</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-25T17:40:02+08:00">
                2019-11-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/11/25/%E7%AE%97%E6%B3%95leetcode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/11/25/算法leetcode/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="分类汇总"><a href="#分类汇总" class="headerlink" title="分类汇总"></a>分类汇总</h1><h2 id="按数据结构"><a href="#按数据结构" class="headerlink" title="按数据结构"></a>按数据结构</h2><h3 id="字符串-string"><a href="#字符串-string" class="headerlink" title="字符串 string"></a>字符串 string</h3><p><a href="https://zheng-xing.github.io/2019/12/01/leetcode-string/" target="_blank" rel="noopener">看这里</a></p>
<h3 id="vector-数组"><a href="#vector-数组" class="headerlink" title="vector 数组"></a>vector 数组</h3><h3 id="stack-amp-heap-栈和队列"><a href="#stack-amp-heap-栈和队列" class="headerlink" title="stack &amp; heap 栈和队列"></a>stack &amp; heap 栈和队列</h3><h3 id="list-链表"><a href="#list-链表" class="headerlink" title="list 链表"></a>list 链表</h3><h3 id="tree-amp-graph-树和图"><a href="#tree-amp-graph-树和图" class="headerlink" title="tree &amp; graph 树和图"></a>tree &amp; graph 树和图</h3><h2 id="按算法"><a href="#按算法" class="headerlink" title="按算法"></a>按算法</h2><h3 id="二分法"><a href="#二分法" class="headerlink" title="二分法"></a>二分法</h3><h3 id="递归与回溯"><a href="#递归与回溯" class="headerlink" title="递归与回溯"></a>递归与回溯</h3><h3 id="bfs-amp-dfs"><a href="#bfs-amp-dfs" class="headerlink" title="bfs &amp; dfs"></a>bfs &amp; dfs</h3><h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><h3 id="贪心"><a href="#贪心" class="headerlink" title="贪心"></a>贪心</h3><h3 id="merge-sort"><a href="#merge-sort" class="headerlink" title="merge sort"></a>merge sort</h3><p><a href="">Leetcode 0315</a></p>
<h2 id="misc-杂"><a href="#misc-杂" class="headerlink" title="misc 杂"></a>misc 杂</h2><h3 id="bit-操作"><a href="#bit-操作" class="headerlink" title="bit 操作"></a>bit 操作</h3><h3 id="O-N-时间"><a href="#O-N-时间" class="headerlink" title="O(N) 时间"></a>O(N) 时间</h3><h3 id="O-1-空间"><a href="#O-1-空间" class="headerlink" title="O(1) 空间"></a>O(1) 空间</h3><h1 id="按题目"><a href="#按题目" class="headerlink" title="按题目"></a>按题目</h1><table>
<thead>
<tr>
<th>题目序号</th>
<th>tag</th>
<th>link</th>
</tr>
</thead>
<tbody><tr>
<td>0005</td>
<td>string</td>
<td><a href="https://juejin.im/post/5b8f9aed6fb9a05d2e1b75d9" target="_blank" rel="noopener">https://juejin.im/post/5b8f9aed6fb9a05d2e1b75d9</a></td>
</tr>
<tr>
<td>0005</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>0005</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>0516</td>
<td>string, dp</td>
<td>???</td>
</tr>
</tbody></table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/03/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/03/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-03T07:40:40+08:00">
                2019-08-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/03/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/08/03/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Deal-with-formula"><a href="#Deal-with-formula" class="headerlink" title="Deal with formula"></a>Deal with formula</h3><ol>
<li>For centered formulae, use \\[ and \\] </li>
<li>For inline formular, use \\( and \\).</li>
</ol>
<p>For example, \\[ x = {-b \pm \sqrt{b^2-4ac} \over 2a} \\] gives: </p>
<p>\[ x = {-b \pm \sqrt{b^2-4ac} \over 2a} \]</p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h3 id="Some-useful-sites"><a href="#Some-useful-sites" class="headerlink" title="Some useful sites"></a>Some useful sites</h3><ol start="0">
<li><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="noopener">Start Instruction 1</a></li>
<li><a href="https://linghucong.js.org/2016/04/15/2016-04-15-hexo-github-pages-blog/" target="_blank" rel="noopener">Start Instruction 2</a></li>
<li><a href="http://www.jianshu.com/p/5973c05d7100" target="_blank" rel="noopener">Additional Functionalities</a></li>
<li><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="noopener">Additional Functionalities 2</a></li>
<li><a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" rel="noopener">Theme Yelee</a></li>
<li><a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">Theme next</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/26/bit-manipulation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/26/bit-manipulation/" itemprop="url">bit_manipulation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-26T00:44:58+08:00">
                2019-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/07/26/bit-manipulation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2019/07/26/bit-manipulation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="WIKI"><a href="#WIKI" class="headerlink" title="WIKI"></a>WIKI</h2><p>Bit manipulation is the act of algorithmically manipulating bits or other pieces of data shorter than a word. Computer programming tasks that require bit manipulation include low-level device control, error detection and correction algorithms, data compression, encryption algorithms, and optimization. For most other tasks, modern programming languages allow the programmer to work directly with abstractions instead of bits that represent those abstractions. Source code that does bit manipulation makes use of the bitwise operations: AND, OR, XOR, NOT, and bit shifts.</p>
<p>Bit manipulation, in some cases, can obviate or reduce the need to loop over a data structure and can give many-fold speed ups, as bit manipulations are processed in parallel, but the code can become more difficult to write and maintain.</p>
<h2 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h2><p>At the heart of bit manipulation are the bit-wise operators &amp; (and), | (or), ~ (not) and ^ (exclusive-or, xor) and shift operators a &lt;&lt; b and a &gt;&gt; b.</p>
<pre><code>There is no boolean operator counterpart to bitwise exclusive-or, but there is a simple explanation. 
The exclusive-or operation takes two inputs and returns a 1 if either one or the other of the inputs is a 1, but not if both are. 
That is, if both inputs are 1 or both inputs are 0, it returns 0. 
Bitwise exclusive-or, with the operator of a caret, ^, performs the exclusive-or operation on each pair of bits. 
Exclusive-or is commonly abbreviated XOR.</code></pre><ol>
<li>Set union A | B</li>
<li>Set intersection A &amp; B</li>
<li>Set subtraction A &amp; ~B</li>
<li>Set negation ALL_BITS ^ A or ~A</li>
<li>Set bit A |= 1 &lt;&lt; bit</li>
<li>Clear bit A &amp;= ~(1 &lt;&lt; bit)</li>
<li>Test bit (A &amp; 1 &lt;&lt; bit) != 0</li>
<li>Extract last bit A&amp;-A or A&amp;~(A-1) or x^(x&amp;(x-1))</li>
<li>Remove last bit A&amp;(A-1)</li>
<li>Get all 1-bits ~0</li>
</ol>
<h1 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h1><h2 id="Count-the-number-of-ones-in-the-binary-representation-of-the-given-number"><a href="#Count-the-number-of-ones-in-the-binary-representation-of-the-given-number" class="headerlink" title="Count the number of ones in the binary representation of the given number"></a>Count the number of ones in the binary representation of the given number</h2><p>[解法一思路]</p>
<ul>
<li>就是利用 <code>n &amp; (n-1)</code> 可以消除最右边的 <code>1</code> 这个技巧</li>
<li>时间复杂度等于 <code>1</code> 的个数，算 O(k) 吧<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">count_one</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(n)</span><br><span class="line">    &#123;</span><br><span class="line">        n = n&amp;(n<span class="number">-1</span>);</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><mark>一个牛逼的分治思路</mark><br>说它牛逼，倒不是说它优化了多少时间，对于本题来说并没有优化很多，毕竟一般的 int 也就 32 个 bit。<br>但是它的思想确实让我很惊喜！没想到二分的思路还可以这么用！</p>
<p><img src="https://raw.githubusercontent.com/zheng-xing/ImageStorage/master/ScreenShot-20200101132310.png" alt="ScreenShot-20200101132310.png"></p>
<p><img src="https://raw.githubusercontent.com/zheng-xing/ImageStorage/master/ScreenShot-20200101132320.png" alt="ScreenShot-20200101132320.png"></p>
<p>我来解释一下思路！</p>
<ol>
<li>如果原始数字是一个 4 位的二进制数，假设是 1110.</li>
<li>那么我们先用 0101 与它做与操作，得到从右边数第一和第三个位置上的数字是 1 的数量，结果是 0100，表示右数第一个位置上有 0 个 1，右数第三个位置上有 1 个 1.</li>
<li>然后用 1010 与它做与操作，得到从右边数第二和第四个位置上数字是 1 的数量，结果是 1010, 表示右数第二个位置上有 1 个 1，右数第四个位置上有 1 个 1. 把这个 1010 向右 shift 一个位子，得到 0101，然后与上面的 0100 相加，得到 1001. </li>
<li>对 1001 的解释<ol>
<li>前面一半 “10” 代表原始数字的 4 个 bit 中前面两个含有 2 个 1， 后面一半 “01” 表示后面两个 bit 位置上含有 1 个 1.</li>
</ol>
</li>
<li>继续递归，我们需要把 “10” 和 “01” 相加得到 4 个 bit 中一共有多少个 1.</li>
</ol>
<p>[代码二]</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">HammingWeight</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    n = (n &amp; <span class="number">0x55555555</span>) + ((n &amp; <span class="number">0xaaaaaaaa</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    n = (n &amp; <span class="number">0x33333333</span>) + ((n &amp; <span class="number">0xcccccccc</span>) &gt;&gt; <span class="number">2</span>);</span><br><span class="line">    n = (n &amp; <span class="number">0x0f0f0f0f</span>) + ((n &amp; <span class="number">0xf0f0f0f0</span>) &gt;&gt; <span class="number">4</span>);</span><br><span class="line">    n = (n &amp; <span class="number">0x00ff00ff</span>) + ((n &amp; <span class="number">0xff00ff00</span>) &gt;&gt; <span class="number">8</span>);</span><br><span class="line">    n = (n &amp; <span class="number">0x0000ffff</span>) + ((n &amp; <span class="number">0xffff0000</span>) &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> n;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Is-power-of-2"><a href="#Is-power-of-2" class="headerlink" title="Is power of 2"></a>Is power of 2</h2><p>[思路]</p>
<ol>
<li>常规的操作是不断着把这个数除以 2，然后判断是否有余数，直到 n 被整除成 1.</li>
<li>而实际上可以把 n 和 n-1 做<font color='red'>与</font>操作，如果结果为 0，那么 n 是 2 的幂次方。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPow2</span><span class="params">(n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &amp; (n<span class="number">-1</span>)) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="leetcode-232"><a href="#leetcode-232" class="headerlink" title="leetcode 232"></a>leetcode 232</h2><p>[题目]</p>
<ul>
<li>给定一个非负整数 num. 对于 0 &lt;= i &lt;= num 范围内的每个数字 i, 计算其二进制数中 1 的数目并将它们作为数组返回。</li>
<li>输入 5</li>
<li>输出 [0, 1, 1, 2, 1, 2]</li>
</ul>
<p>[思路]</p>
<ul>
<li>常规解法就是遍历 0 &lt;= i &lt;= num，对每一个数字求多少个 bit 位为 1</li>
<li>巧妙解法是使用动态规划，见下面的代码</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">countBits</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">res</span><span class="params">(num+<span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= num; i++)&#123;</span><br><span class="line">        res[i] = res[i &amp; (i<span class="number">-1</span>)] + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码的关键就是通过 <code>i &amp; (i-1)</code> 来去掉 i 的最右边那个 1.</p>
<h2 id="Is-power-of-four-actually-map-checking-iterative-and-recursive-methods-can-do-the-same"><a href="#Is-power-of-four-actually-map-checking-iterative-and-recursive-methods-can-do-the-same" class="headerlink" title="Is power of four (actually map-checking, iterative and recursive methods can do the same)"></a>Is power of four (actually map-checking, iterative and recursive methods can do the same)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isPowerOfFour</span><span class="params">(<span class="keyword">int</span> n)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !(n&amp;(n<span class="number">-1</span>)) &amp;&amp; (n&amp;<span class="number">0x55555555</span>);</span><br><span class="line">    <span class="comment">//check the 1-bit location;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tricks"><a href="#tricks" class="headerlink" title="^ tricks"></a>^ tricks</h2><ol>
<li>Use ==^== to remove even exactly same numbers and save the odd, or save the distinct bits and remove the same.</li>
<li>Use ==^== and ==&amp;== to add two integers</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getSum</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b==<span class="number">0</span>? a:getSum(a^b, (a&amp;b)&lt;&lt;<span class="number">1</span>); <span class="comment">//be careful about the terminating condition;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者不用递归</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">aplusb</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (b!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> carry = a &amp; b;</span><br><span class="line">            a = a^b; </span><br><span class="line">            b = carry &lt;&lt; <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Given an array containing n distinct numbers taken from 0, 1, 2, …, n, find the one that is missing from the array. For example, Given nums = [0, 1, 3] return 2. (Of course, you can do this by math.)</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        ret ^= i;</span><br><span class="line">        ret ^= nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret^=nums.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="tricks-1"><a href="#tricks-1" class="headerlink" title="| tricks"></a>| tricks</h2><p>Keep as many 1-bits as possible</p>
<p>Find the largest power of 2 (most significant bit in binary form), which is less than or equal to the given number N.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">largest_power</span><span class="params">(<span class="keyword">long</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//changing all right side bits to 1.</span></span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">1</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">2</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">4</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">8</span>);</span><br><span class="line">    N = N | (N&gt;&gt;<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (N+<span class="number">1</span>)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="amp-tricks"><a href="#amp-tricks" class="headerlink" title="&amp; tricks"></a>&amp; tricks</h2><p>Just selecting certain bits</p>
<p>Reversing the bits in integer</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = ((x &amp; <span class="number">0xaaaaaaaa</span>) &gt;&gt; <span class="number">1</span>) | ((x &amp; <span class="number">0x55555555</span>) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">x = ((x &amp; <span class="number">0xcccccccc</span>) &gt;&gt; <span class="number">2</span>) | ((x &amp; <span class="number">0x33333333</span>) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">x = ((x &amp; <span class="number">0xf0f0f0f0</span>) &gt;&gt; <span class="number">4</span>) | ((x &amp; <span class="number">0x0f0f0f0f</span>) &lt;&lt; <span class="number">4</span>);</span><br><span class="line">x = ((x &amp; <span class="number">0xff00ff00</span>) &gt;&gt; <span class="number">8</span>) | ((x &amp; <span class="number">0x00ff00ff</span>) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">x = ((x &amp; <span class="number">0xffff0000</span>) &gt;&gt; <span class="number">16</span>) | ((x &amp; <span class="number">0x0000ffff</span>) &lt;&lt; <span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<p>Given a range [m, n] where 0 &lt;= m &lt;= n &lt;= 2147483647, return the bitwise AND of all numbers in this range, inclusive. For example, given the range [5, 7], you should return 4.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rangeBitwiseAnd</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(m != n)</span><br><span class="line">    &#123;</span><br><span class="line">        m &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        a++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> m&lt;&lt;a; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="number-compliment-0476"><a href="#number-compliment-0476" class="headerlink" title="number compliment 0476"></a>number compliment 0476</h2><p>[题目]</p>
<ul>
<li>Given a positive integer, output its complement number. The complement strategy is to flip the bits of its binary representation.</li>
</ul>
<p>[例子]</p>
<ul>
<li>Input: 5</li>
<li>Output: 2</li>
<li>Explanation: The binary representation of 5 is 101 (no leading zero bits), and its complement is 010. So you need to output 2.</li>
</ul>
<p>[思路一]</p>
<ul>
<li>核心的关键就是找到最高位的 1 在哪个位置，这样子可以让右边全部为 1，做异或操作。</li>
</ul>
<p>[代码一]</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findComplement</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> mask = ~<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (num &amp; mask) mask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> ~mask &amp; ~num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  举例解释代码</span></span><br><span class="line"><span class="comment">num          = 00000101</span></span><br><span class="line"><span class="comment">mask         = 11111000</span></span><br><span class="line"><span class="comment">~mask &amp; ~num = 00000010</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>[思路二：较少的计算量]</p>
<ul>
<li>核心是让最高位的 1 后面这一坨里面的 0 全部变成 1.</li>
</ul>
<p>[代码二]</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findComplement</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> mask = num;</span><br><span class="line">        mask |= mask &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        mask |= mask &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        mask |= mask &gt;&gt; <span class="number">4</span>;</span><br><span class="line">        mask |= mask &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        mask |= mask &gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> num ^ mask;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="DNA-Application"><a href="#DNA-Application" class="headerlink" title="DNA Application"></a>DNA Application</h2><p>All DNA is composed of a series of nucleotides abbreviated as A, C, G, and T, for example: “ACGAATTCCG”. When studying DNA, it is sometimes useful to identify repeated sequences within the DNA. Write a function to find all the 10-letter-long sequences (substrings) that occur more than once in a DNA molecule.</p>
<pre><code>For example,
Given s = &quot;AAAAACCCCCAAAAACCCCCCAAAAAGGGTTT&quot;,
Return: [&quot;AAAAACCCCC&quot;, &quot;CCCCCAAAAA&quot;].</code></pre><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; <span class="title">findRepeatedDnaSequences</span><span class="params">(<span class="built_in">string</span> s)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sLen = s.length();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; v;</span><br><span class="line">        <span class="keyword">if</span>(sLen &lt; <span class="number">11</span>) <span class="keyword">return</span> v;</span><br><span class="line">        <span class="keyword">char</span> keyMap[<span class="number">1</span>&lt;&lt;<span class="number">21</span>]&#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> hashKey = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; ++i) hashKey = (hashKey&lt;&lt;<span class="number">2</span>) | (s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%<span class="number">5</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">9</span>; i &lt; sLen; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(keyMap[hashKey = ((hashKey&lt;&lt;<span class="number">2</span>)|(s[i]-<span class="string">'A'</span>+<span class="number">1</span>)%<span class="number">5</span>)&amp;<span class="number">0xfffff</span>]++ == <span class="number">1</span>)</span><br><span class="line">                v.push_back(s.substr(i<span class="number">-9</span>, <span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>But the above solution can be invalid when repeated sequence appears too many times, in which case we should use ==unordered_map&lt;int, int&gt; keyMap== to replace ==char keyMap[1&lt;&lt;21]{0}== here.</p>
<p>Given an array of size n, find the majority element. The majority element is the element that appears more than ⌊ n/2 ⌋ times. (bit-counting as a usual way, but here we actually also can adopt sorting and Moore Voting Algorithm)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">majorityElement</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(<span class="keyword">int</span>)*<span class="number">8</span>, <span class="built_in">size</span> = nums.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>, mask = <span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">size</span>; ++j)</span><br><span class="line">            <span class="keyword">if</span>(mask &amp; nums[j]) count++;</span><br><span class="line">        <span class="keyword">if</span>(count &gt; <span class="built_in">size</span>/<span class="number">2</span>) ret |= mask;</span><br><span class="line">        mask &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Given an array of integers, every element appears three times except for one. Find that single one. (Still this type can be solved by bit-counting easily.) But we are going to solve it by ==digital logic design==</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//inspired by logical circuit design and boolean algebra;</span></span><br><span class="line"><span class="comment">//counter - unit of 3;</span></span><br><span class="line"><span class="comment">//current   incoming  next</span></span><br><span class="line"><span class="comment">//a b            c    a b</span></span><br><span class="line"><span class="comment">//0 0            0    0 0</span></span><br><span class="line"><span class="comment">//0 1            0    0 1</span></span><br><span class="line"><span class="comment">//1 0            0    1 0</span></span><br><span class="line"><span class="comment">//0 0            1    0 1</span></span><br><span class="line"><span class="comment">//0 1            1    1 0</span></span><br><span class="line"><span class="comment">//1 0            1    0 0</span></span><br><span class="line"><span class="comment">//a = a&amp;~b&amp;~c + ~a&amp;b&amp;c;</span></span><br><span class="line"><span class="comment">//b = ~a&amp;b&amp;~c + ~a&amp;~b&amp;c;</span></span><br><span class="line"><span class="comment">//return a|b since the single number can appear once or twice;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">0</span>, a = <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        t = (a&amp;~b&amp;~nums[i]) | (~a&amp;b&amp;nums[i]);</span><br><span class="line">        b = (~a&amp;b&amp;~nums[i]) | (~a&amp;~b&amp;nums[i]);</span><br><span class="line">        a = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a | b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>atttention</p>
<ol>
<li>result after shifting left(or right) too much is undefined</li>
<li>right shifting operations on negative values are undefined</li>
<li>right operand in shifting should be non-negative, otherwise the result is undefined</li>
<li>The &amp; and | operators have lower precedence than comparison operators</li>
</ol>
<h2 id="SETS"><a href="#SETS" class="headerlink" title="SETS"></a>SETS</h2><p>All the subsets</p>
<p>A big advantage of bit manipulation is that it is trivial to iterate over all the subsets of an N-element set: every N-bit value represents some subset. Even better, ==if A is a subset of B then the number representing A is less than that representing B==, which is convenient for some dynamic programming solutions.</p>
<p>It is also possible to iterate over all the subsets of a particular subset (represented by a bit pattern), provided that you don’t mind visiting them in reverse order (if this is problematic, put them in a list as they’re generated, then walk the list backwards). The trick is similar to that for finding the lowest bit in a number. If we subtract 1 from a subset, then the lowest set element is cleared, and every lower element is set. However, we only want to set those lower elements that are in the superset. So the iteration step is just ==i = (i - 1) &amp; superset==.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">subsets</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; vv;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">size</span> = nums.<span class="built_in">size</span>(); </span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">size</span> == <span class="number">0</span>) <span class="keyword">return</span> vv;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1</span> &lt;&lt; <span class="built_in">size</span>;</span><br><span class="line">    vv.resize(num);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">size</span>; ++j)</span><br><span class="line">            <span class="keyword">if</span>((<span class="number">1</span>&lt;&lt;j) &amp; i) vv[i].push_back(nums[j]);   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vv;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Actually there are two more methods to handle this using recursion and iteration respectively.</p>
<h2 id="BITSET"><a href="#BITSET" class="headerlink" title="BITSET"></a>BITSET</h2><p>A bitset stores bits (elements with only two possible values: 0 or 1, true or false, …).<br>The class emulates an array of bool elements, but optimized for space allocation: generally, each element occupies only one bit (which, on most systems, is eight times less than the smallest elemental type: char).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bitset::count</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;       // std::cout</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;         // std::string</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bitset&gt;         // std::bitset</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::<span class="built_in">bitset</span>&lt;8&gt; <span class="title">foo</span> <span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">"10110011"</span>))</span></span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; foo &lt;&lt; <span class="string">" has "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; foo.count() &lt;&lt; <span class="string">" ones and "</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; (foo.<span class="built_in">size</span>()-foo.count()) &lt;&lt; <span class="string">" zeros.\n"</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="bitwise-AND-of-Numbers-Range-leetcode-0201"><a href="#bitwise-AND-of-Numbers-Range-leetcode-0201" class="headerlink" title="bitwise AND of Numbers Range leetcode 0201"></a>bitwise AND of Numbers Range leetcode 0201</h2><p>题目描述:<br>Given a range [m, n] where 0 &lt;= m &lt;= n &lt;= 2147483647, return the bitwise AND of all numbers in this range, inclusive.<br>For example, given the range [5, 7], you should return 4.</p>
<p>分析：<br>这一题实际上就是在找 两个 integer 二进制写法的公共 prefix</p>
<p>The hardest part of this problem is to find the regular pattern.<br>For example, for number 26 to 30<br>Their binary form are:<br>1 1 0 1 0<br>1 1 0 1 1<br>1 1 1 0 0　　<br>1 1 1 0 1　　<br>1 1 1 1 0<br>Because we are trying to find bitwise AND, so if any bit there are at least one 0 and one 1, it always 0. In this case, it is 11000.<br>So we are go to cut all these bit that they are different. In this case we cut the right 3 bit.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">rangeBitwiseAnd</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(m != n)&#123;</span><br><span class="line">            m &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (m &lt;&lt; i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数字出现三次"><a href="#数字出现三次" class="headerlink" title="数字出现三次"></a>数字出现三次</h2><p>参考文章 “leetcode 数组” 里面的例题 “出现 3 次的数 leetcode 137”</p>
<h3 id="引申题-老鼠喝药"><a href="#引申题-老鼠喝药" class="headerlink" title="引申题 老鼠喝药"></a>引申题 老鼠喝药</h3><p>[题目]<br>有 100 瓶液体，编号 1 到 100，其中有 99 瓶水和 1 瓶毒药。<br>如果老鼠喝了毒药，那么会在一周后死亡。请问你最少用几只老鼠可以最快的检测出哪一瓶是毒药？</p>
<p>[思路]<br>这一引申题的思路跟上面的一个按位置计算的解法非常相似。这里也是按照 bit 位来看的。</p>
<p>我们把这编号 1 到 100 一共 100 个数字用二进制写出来，每个数字都写成长度为 7 位的二进制数 (2^7 = 128 &gt; 100)，左边补零如果不够七位。</p>
<p>现在我们让七只老鼠，第一只老鼠去喝最左边的 bit 位上是 1 的那些瓶的液体，第二只老鼠喝左数第二 bit 位上是 1 的那些瓶子的液体，以此类推。</p>
<p>一周以后，如果第一只老鼠死了，那么有毒药的那瓶液体的编号在最左边 bit 位一定是 1，反之是 0. 同理可以得到 7 个 bit 位上是 1 还是 0.</p>
<p><mark>[其他思考]</mark></p>
<ol>
<li><mark>如果没有时间限制的话，那么就可以用我们熟悉的二分思想，就跟用天平找出来一堆球里面重量跟其他不同的那个题似的。</mark><ol>
<li>先让一只老鼠喝编号 1-50 的那些瓶液体.</li>
<li>如果死了，就递归找第二只老鼠喝 1-25 瓶液体，如果没死就找第二只老鼠喝 51-75 那些瓶液体。</li>
<li>同样的，也是最多需要 7 只老鼠就可以发现。</li>
</ol>
</li>
<li>因此，这里因为有了时间上的限制，我们需要对每个 bit 位分别考虑，就可以对所有的 bit 位<mark>并行计算</mark>。没有时间限制就对所有的瓶子串行得二分计算！</li>
<li>我其实对于上面的解法有点疑惑就是为啥非得用 2 进制来表示数字呢？如果用 3 进制来表示的话，那么对于每一个 bit 位 我们需要找 2 只老鼠，一只老鼠喝最左边 bit 位是 1 的液体，一个老鼠喝 最左边 bit 位是 2 的液体，根据它们两个老鼠是否死亡的信息，可以判断最左边 bit 位上是 0，1，还是 2.<ol>
<li>好像想清楚了！如果是三进制，那么每一个 bit 位上一个老鼠是否死亡只能排除掉 1/3 的可能。而使用二进制的话则可以排除掉 50% 的可能。因为老鼠是否死亡只有两种可能，因此使用二进制已经是最佳的方案了！！！</li>
</ol>
</li>
<li>另外参考 <a href="https://zheng-xing.github.io/2019/12/05/leetcode-%E6%95%B0%E7%BB%84/" target="_blank" rel="noopener">leetcode-数组</a> 一文中 binary index tree 和 segment tree 的思想！</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ol>
<li><a href="https://discuss.leetcode.com/topic/50315/a-summary-how-to-use-bit-manipulation-to-solve-problems-easily-and-efficiently" target="_blank" rel="noopener">https://discuss.leetcode.com/topic/50315/a-summary-how-to-use-bit-manipulation-to-solve-problems-easily-and-efficiently</a></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/05/%E4%B9%92%E4%B9%93%E7%90%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/05/%E4%B9%92%E4%B9%93%E7%90%83/" itemprop="url">乒乓球.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-05T14:24:22+08:00">
                2018-09-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hobby/" itemprop="url" rel="index">
                    <span itemprop="name">hobby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/05/%E4%B9%92%E4%B9%93%E7%90%83/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/05/乒乓球/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="接发球"><a href="#接发球" class="headerlink" title="接发球"></a>接发球</h1><ol>
<li><p>张继科逆旋转发球四种旋转</p>
<div class="video-container">
 <!-- <iframe width="1280" height="720" src="https://www.youtube.com/watch?v=uKLTkFGCxSo" frameborder="0" allowfullscreen>
 </iframe> -->
 <iframe width="560" height="315" src="https://www.youtube.com/embed/uKLTkFGCxSo" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>
</li>
<li><p>如何发好逆旋转侧下旋<br>两个要点：<br>第一，要注意球拍的摆放，一定要往下压平一点。这样才能摩擦球的下部。<br>第二，要注意发力的动作。很多时候球友只注意了侧向的摩擦，这个会造成只有侧旋。一定要有球拍往前送的动作，这样子才会造成下旋。</p>
<div class="video-container">
<iframe width="560" height="315" src="https://www.youtube.com/embed/2rruw3rld5E" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>
</li>
<li><p>急长下旋球<br>要点：<br>第一，触球的中下位置，不仅要有摩擦，还要有向前推送/弹击得感觉。<br>第二，第一个落点在靠近自己的位置。</p>
<div class="video-container">
<iframe width="560" height="315" src="https://www.youtube.com/embed/6QHF_wv5BhU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>
</li>
<li><p>直板发纯下旋球<br>一定要体会兜底的感觉！</p>
<div class="video-container">
<iframe width="560" height="315" src="https://www.youtube.com/embed/HUMVoIDuLMQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>
</li>
<li><p>勾手的上旋球<br>这个动作的欺骗性很强：第一个是因为看起来好像往前摩擦球的下面，有点下旋；第二个再加上球的弧线很低，就容易产生“嗯，确实是下旋的错觉”，然后就冒高了。</p>
<div class="video-container">
<iframe width="560" height="315" src="https://www.youtube.com/embed/F_rKsfAJX3I" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

</li>
</ol>
<h1 id="技战术"><a href="#技战术" class="headerlink" title="技战术"></a>技战术</h1><h1 id="器材篇"><a href="#器材篇" class="headerlink" title="器材篇"></a>器材篇</h1><h2 id="底板"><a href="#底板" class="headerlink" title="底板"></a>底板</h2><p>目前我用的装备是斯蒂卡纳米OC，其特点描述如下：</p>
<ol>
<li>轻量级5层全能型底板，具有出色的手感和控制力。基于经典轻量级进攻型OC系列的升级款，快攻下的全方位控制力，为现代科技乒乓设计。NCT科技在实现了更强击打力量的同时保证控制力不减。世界冠军许昕曾用。</li>
<li>与一般的纯木板有所不同，纳米OFFENSIVE WOOD有着超乎寻常的出球速度。<br>特别是当你发力达到一定程度后，出球弧线骤然降低，出球速度大幅提升，以迅雷不及掩耳之势撕开对手的防线。<br>使用它，你甚至可以用相当柔和的手法把一片没有灌过胶的狂飙轻松打透，并令其发出振聋发聩的声响。<br>既易于上手又易于发力的特性，必将使其成为业余与专业选手无机时代最有力的得分武器。</li>
</ol>
<p>而传统的OC是最能够代表乒乓球弧圈时代的经典底板。球拍受冲击后产生的大幅形变，使选手有充分的时间对球进行摩擦。形变产生的储能，使球具有强烈的冲击性。使OC成为中远台冲高进攻选手的青睐。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/30/ML-DL-basic-knowledge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/30/ML-DL-basic-knowledge/" itemprop="url">ML_DL_basic_knowledge</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-30T11:45:54+08:00">
                2018-08-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/30/ML-DL-basic-knowledge/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/30/ML-DL-basic-knowledge/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="">L1 and L2 的意义</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/30/Algorithms-Questions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/30/Algorithms-Questions/" itemprop="url">Algorithms Questions</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-30T11:45:14+08:00">
                2018-08-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/30/Algorithms-Questions/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/30/Algorithms-Questions/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="">Leetcode 0001</a><br><a href="">Leetcode 0002</a><br><a href="">Leetcode 0003</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/30/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/30/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/" itemprop="url">总目录索引</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-30T11:37:22+08:00">
                2018-08-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/30/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/30/总目录索引/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://zheng-xing.github.io/2018/08/29/Algorithms-Questions/" target="_blank" rel="noopener">Algorithm Questions</a></p>
<p><a href="https://zheng-xing.github.io/2018/08/29/ML-DL-basic-knowledge/" target="_blank" rel="noopener">机器学习和深度学习基础知识</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/01/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/" itemprop="url">Python网络有关.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T12:03:52+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/01/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/01/Python网络有关-md/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一些基础概念"><a href="#一些基础概念" class="headerlink" title="一些基础概念"></a>一些基础概念</h1><h2 id="网络分层"><a href="#网络分层" class="headerlink" title="网络分层"></a>网络分层</h2><p>todo</p>
<h2 id="单工，双工，半双工"><a href="#单工，双工，半双工" class="headerlink" title="单工，双工，半双工"></a>单工，双工，半双工</h2><h2 id="TCP-IP协议分层详解"><a href="#TCP-IP协议分层详解" class="headerlink" title="TCP/IP协议分层详解"></a>TCP/IP协议分层详解</h2><h2 id="tcp三次握手四次挥手"><a href="#tcp三次握手四次挥手" class="headerlink" title="tcp三次握手四次挥手"></a>tcp三次握手四次挥手</h2><p>TCP（Transmission Control Protocol，传输控制协议）是 面向连接的协议，也就是说在收发数据之前，必须先和对方建立连接，</p>
<p>一个TCP连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，只简单的 描述下这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接和要求同步 （同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同 步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数 据。</p>
<p>需要了解的信息：</p>
<p>ACK ： TCP协议规定，只有ACK=1时有效，也规定连接建立后所有发送的报文的ACK必须为1</p>
<p>SYN(SYNchronization) ： 在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文。对方若同意建立连接，则应在响应报文中使SYN=1和ACK=1. 因此,  SYN置1就表示这是一个连接请求或连接接受报文。</p>
<p>FIN （finis）即完，终结的意思， 用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放连接。</p>
<h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p><img src="https://img-blog.csdn.net/20160413203916860?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>首先由Client发出请求连接即 SYN=1 ACK=0  (请看头字段的介绍), TCP规定SYN=1时不能携带数据，但要消耗一个序号,因此声明自己的序号是 seq=x</p>
<p>然后 Server 进行回复确认，即 SYN=1 ACK=1 seq=y, ack=x+1, 再然后 Client 再进行一次确认，但不用SYN 了，这时即为 ACK=1, seq=x+1, ack=y+1.</p>
<p>然后连接建立.</p>
<p>为什么要进行三次握手呢（两次确认）。</p>
<p>建立三次握手主要是因为A发送了再一次的确认，那么A为什么会再确认一次呢，主要是为了防止已失效的连接请求报文段又突然传送给B，从而产生了错误。所谓“已失效的连接请求报文”是这样产生的，正常情况下，A发出连接请求，但是因为连接报文请求丢失而未收到确认，于是A再重传一次连接请求，后来收到了请求，并收到了确认，建立了连接，数据传输完毕后，就释放链接，A共发送了两次连接请求报文段，其中第一个丢失，第二个到达了B，没有“已失效的连接请求报文段”，但是还有异常情况下，A发送的请求报文连接段并没有丢失，而是在某个网络节点滞留较长时间，以致延误到请求释放后的某个时间到达B，本来是一个早已失效的报文段，但是B收到了此失效连接请求报文段后，就误以为A又重新发送的连接请求报文段，并发送确认报文段给A，同意建立连接，如果没有三次握手，那么B发送确认后，连接就建立了，而此时A没有发送建立连接的请求报文段，于是不理会B的确认，也不会给B发送数据，而B却一直等待A发送数据，因此B的许多资源就浪费了，采用三次握手的方式就可以防止这种事情发生，例如刚刚，A不理会B，就不会给B发送确认，B收不到A的确认，就知道A不要求建立连接，就不会白白浪费资源，</p>
<h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><p><img src="https://img-blog.csdn.net/20160413205812456?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>当客户A 没有东西要发送时就要释放 A 这边的连接，A会发送一个报文（没有数据），其中 FIN 设置为1,  服务器B收到后会给应用程序一个信，这时A那边的连接已经关闭，即A不再发送信息（但仍可接收信息）。  A收到B的确认后进入等待状态，等待B请求释放连接， B数据发送完成后就向A请求连接释放，也是用FIN=1 表示， 并且用 ack = u+1(如图）， A收到后回复一个确认信息，并进入 TIME_WAIT 状态， 等待 2MSL 时间。</p>
<p><mark>为什么要等待呢</mark></p>
<p>为了这种情况： B向A发送 FIN = 1 的释放连接请求，但这个报文丢失了， A 没有接到不会发送确认信息，B 超时会重传，这时A在 WAIT_TIME 还能够接收到这个请求，这时再回复一个确认就行了。（A收到 FIN = 1 的请求后 WAIT_TIME会重新记时）</p>
<p>另外服务器B存在一个保活状态，即如果A突然故障死机了，那B那边的连接资源什么时候能释放呢？  就是保活时间到了后，B会发送探测信息， 以决定是否释放连接.</p>
<p><mark>为什么连接的时候是三次握手，关闭的时候却是四次握手</mark></p>
<p>答：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，”你发的FIN报文我收到了”。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。</p>
<h1 id="socket使用"><a href="#socket使用" class="headerlink" title="socket使用"></a>socket使用</h1><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 收消息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发消息</span></span><br></pre></td></tr></table></figure>


<h2 id="一些应用场景"><a href="#一些应用场景" class="headerlink" title="一些应用场景"></a>一些应用场景</h2><h3 id="聊天室"><a href="#聊天室" class="headerlink" title="聊天室"></a>聊天室</h3><p>聊天室的要求就是一直监听，有消息就打印到当前窗口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">6789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        print(<span class="string">"[%s]: %s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>].decode(<span class="string">"utf-8"</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="echo-服务器"><a href="#echo-服务器" class="headerlink" title="echo 服务器"></a>echo 服务器</h3><p>echo 就是你发给它啥，它返回同样的东西给你。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">6789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        udpSocket.sendto(recvInfo[<span class="number">0</span>], recvInfo[<span class="number">1</span>])</span><br><span class="line">        print(<span class="string">"[%s]: %s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>].decode(<span class="string">"utf-8"</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h3 id="多线程聊天"><a href="#多线程聊天" class="headerlink" title="多线程聊天"></a>多线程聊天</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收数据，然后打印</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recvData</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        print(<span class="string">"\r&gt;&gt;[%s]:%s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>]))  <span class="comment"># \r 是从行开头打印，是为了覆盖掉本来的 &lt;&lt; 提示。</span></span><br><span class="line">        print(<span class="string">"\n&lt;&lt;"</span>)    <span class="comment"># 行开头本来有 &lt;&lt;，接收数据后会打印新的内容，导致看不到 &lt;&lt; 提示符了，因此另起一行补上。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测键盘，发数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendData</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sendInfo = input(<span class="string">"&lt;&lt;"</span>)</span><br><span class="line">        udpSocket.sendto(sendInfo.encode(<span class="string">"gb2312"</span>), (destIp, destPort))</span><br><span class="line"></span><br><span class="line">udpSocket = <span class="literal">None</span></span><br><span class="line">destIp = <span class="string">""</span></span><br><span class="line">destPort = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">global</span> udpSocket</span><br><span class="line">    <span class="keyword">global</span> destIp</span><br><span class="line">    <span class="keyword">global</span> destPort</span><br><span class="line"></span><br><span class="line">    destIp = input(<span class="string">"Destination IP: "</span>)</span><br><span class="line">    destPort = input(<span class="string">"Destination port: "</span>)</span><br><span class="line"></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">4567</span>)</span><br><span class="line"></span><br><span class="line">    tr = Thread(target=recvData)</span><br><span class="line">    ts = Thread(target=sendData)</span><br><span class="line"></span><br><span class="line">    tr.start()</span><br><span class="line">    ts.start()</span><br><span class="line"></span><br><span class="line">    tr.join()</span><br><span class="line">    ts.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>main() 函数里面的变量也是 main 函数的局部变量，可不是全局变量！</li>
<li>udpSocket 要放在 main 函数外面作为全局变量，main 函数要声明 udpSocket 为 global，两个收发数据的函数因为没有改变 udpSocket，所以不需要声明为 global.</li>
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/28/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/28/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/" itemprop="url">Python并行的方式.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-28T08:00:00+08:00">
                2018-05-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/28/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/28/Python并行的方式-md/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python 里面的并行分为线程并行和进程并行。</p>
<h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><h2 id="fork-创建多任务"><a href="#fork-创建多任务" class="headerlink" title="fork 创建多任务"></a>fork 创建多任务</h2><p>一个简单例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">p = os.fork()    <span class="comment"># 程序从这里会分裂成两个，继续执行</span></span><br><span class="line"><span class="keyword">if</span> p == <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># os.getpid  当前进程的 id</span></span><br><span class="line">    <span class="comment"># os.getppid 当前进程的父进程的 id</span></span><br><span class="line">    print(<span class="string">"This is child %d with father %d."</span> % (os.getpid(), os.getppid()))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"This is father %d."</span> % os.getpid)</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>fork 后产生的父进程和子进程独立运行，父进程完成后可以结束，不需要等待子进程。</li>
<li>fork 只能在 unix/linux/mac 上运行，windows 不行。</li>
<li>如果有多个 fork，那么第一个 fork 处会分叉为两个程序继续运行，碰到第二个 fork 时候两个进程各自继续分叉运行。</li>
</ol>
<h2 id="多进程下的全局变量"><a href="#多进程下的全局变量" class="headerlink" title="多进程下的全局变量"></a>多进程下的全局变量</h2><ol>
<li>每个进程都有自己的全局变量<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">num = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">p = os.fork()</span><br><span class="line"><span class="keyword">if</span> p &gt; <span class="number">0</span>:</span><br><span class="line">    num = num + <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(num)      <span class="comment"># 父进程在此处输出 6</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(num)      <span class="comment"># 子进程在此处输出 5</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="跨平台-multiprocessing"><a href="#跨平台-multiprocessing" class="headerlink" title="跨平台 multiprocessing"></a>跨平台 multiprocessing</h2><p>Process initialization:<br>Process([group [, target [, name [, args [, kwargs]]]]])</p>
<ol>
<li>target: 进程实例所调用的目标</li>
<li>name: 进程实例的别名</li>
<li>group: 一般很少用</li>
</ol>
<p>Process 类常用方法：</p>
<ol>
<li>is_alive()： 判断进程实例是否还在运行</li>
<li>join([timeout]): 是否在此处等待子进程结束，或者等待 timeout 秒</li>
<li>start(): 子进程开始执行</li>
<li>run(): 当不给定 target 参数时候，会执行对象中的 run() 方法。</li>
<li>terminate(): 不管任务是否完成，立即终止。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">toy_func</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"This is child id %d with name %s"</span> % (os.getpid(), name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p = Process(target = toy_func, args=(<span class="string">"toy"</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"Main function ends."</span>)</span><br></pre></td></tr></table></figure>
注意：</li>
<li>如果使用 .join() 那么父进程在 .join() 语句之后的内容会等待子进程结束以后才去执行。</li>
<li>使用 Process 多任务，无论是否有 .join(), 父进程执行完以后都会等待子进程结束才结束。</li>
</ol>
<h2 id="自定义Process子类"><a href="#自定义Process子类" class="headerlink" title="自定义Process子类"></a>自定义Process子类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">earthquake</span><span class="params">(Process)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, interval)</span>:</span></span><br><span class="line">        Process.__init__(self)</span><br><span class="line">        self.interval = interval</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Earthquake starts"</span>)</span><br><span class="line">        t1 = time.time()</span><br><span class="line">        time.sleep(self.interval)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        print(<span class="string">"Earthquake lasts %0.2f seconds."</span> % (t2-t1))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    p1 = earthquake(<span class="number">100</span>)</span><br><span class="line">    p1.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    print(<span class="string">"Main function lasts %0.2f seconds."</span> %(t2-t1))</span><br></pre></td></tr></table></figure>

<h2 id="进程池Pool"><a href="#进程池Pool" class="headerlink" title="进程池Pool"></a>进程池Pool</h2><p>当进程数量不多的时候，可以使用 Process 类来创建几个进程。<br>但是如果有几十上百个进程，那么可以使用Pool 来完成。<br>初始化 Pool 时候可以指定一个数量，即最大的进程数量。<br>当添加一个进程到 Pool 里面时候，如果 Pool 没有满，那么就加入。<br>如果满了，那么就会等待 Pool 里的某个进程结束后才会加入这个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(msg)</span>:</span></span><br><span class="line">    t1 = time.time()</span><br><span class="line">    print(<span class="string">"Job %s starts, with process ID: %d."</span> % (msg, os.getpid()))</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    print(<span class="string">"Job %s ends, running time is %0.2f s."</span> % (msg, t2-t1))</span><br><span class="line"></span><br><span class="line">po = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    po.apply_async(worker, (i,))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"All begin..."</span>)</span><br><span class="line">po.close()    <span class="comment">#关闭进程池，关闭后 po 不再接受新的请求</span></span><br><span class="line">po.join()    <span class="comment">#等待 po 中所有子进程结束，这一句必须放在 .close() 之后。</span></span><br><span class="line">print(<span class="string">"All ends..."</span>)</span><br></pre></td></tr></table></figure>
<p>note:</p>
<ol>
<li>主进程一般用来等待，真正的任务在子进程中进行。</li>
<li>这里使用的 po.apply_async() 是说 5 个子进程可以同时执行。</li>
<li>也可以改成 po.apply() 来运行，但这个时候会等到前一个子进程结束后才会加入新的子进程。</li>
<li><mark>注意，如果不用 po.join(), 那么主进程结束后，进程池里的任务即使没执行完，也会被结束掉，导致不希望的结果。</mark></li>
</ol>
<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><p>这里讲的异步主要是说，主进程建立了子进程，二者各自运行着。<br>子进程结束后会打断主进程，制定一个 function 让主进程先去执行，然后主进程该干嘛干嘛。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"This is a process in Pool with pid=%d, ppid=%d"</span> % (os.getpid(), os.getppid()))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Earthquake"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">(args)</span>:</span></span><br><span class="line">    print(<span class="string">"This is callback function with pid=%d"</span> % os.getpid())</span><br><span class="line">    print(<span class="string">"This function argument is: %s"</span> % args)</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">3</span>)</span><br><span class="line">pool.apply_async(func=test, callback=test2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"This is the main process with pid=%d"</span> % os.getpid())</span><br></pre></td></tr></table></figure>


<h2 id="进程间通信-Queue"><a href="#进程间通信-Queue" class="headerlink" title="进程间通信-Queue"></a>进程间通信-Queue</h2><p>由于进程之间没有变量共享，即全局变量都是每个进程里各自一份。<br>那么就需要特殊的数据结构来让进程之间通信。</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line">q = Queue(<span class="number">3</span>)    <span class="comment"># 新建一个 Queue, 可以保存 3 个内容。</span></span><br><span class="line"></span><br><span class="line">q.qsize()    <span class="comment"># 此处是0</span></span><br><span class="line">q.empty()    <span class="comment"># 返回 True</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy01"</span>)    <span class="comment"># 添加一个内容到 q</span></span><br><span class="line">q.put(<span class="string">"toy02"</span>)    <span class="comment"># 添加一个内容到 q</span></span><br><span class="line">q.qsize()    <span class="comment"># 输出 2</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy03"</span>)    <span class="comment"># 这个添加后 q 就满了</span></span><br><span class="line">q.full()    <span class="comment"># 输出 True</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy04"</span>)    <span class="comment"># 程序会卡在这里，需要等另一个进程从 q 中取出一个东西后，才会继续执行。</span></span><br><span class="line">                  <span class="comment"># 如果使用 q.put_nowait(), 会报错</span></span><br><span class="line"></span><br><span class="line">q.get()    <span class="comment"># 输出 "toy01"</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>如果使用进程池 Pool 来调用 Queue，就不能使用 multiprocessing.Queue。必须使用 multiprocessing.Manager().Queue()</li>
<li>eg. from multiprocessing import Manager; q = Manager.Queue()</li>
</ol>
<h1 id="线程与多任务"><a href="#线程与多任务" class="headerlink" title="线程与多任务"></a>线程与多任务</h1><p>python的 thread 是较底层的模块，threading 模块是稍微高层一点的模块。</p>
<h2 id="threading-Thread-多线程"><a href="#threading-Thread-多线程" class="headerlink" title="threading.Thread 多线程"></a>threading.Thread 多线程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">earthquake</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"An earthquake!"</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    th = Thread(target=earthquake)</span><br><span class="line">    th.start()</span><br></pre></td></tr></table></figure>

<h2 id="Thread-子类"><a href="#Thread-子类" class="headerlink" title="Thread 子类"></a>Thread 子类</h2><h3 id="只有一个-Thread"><a href="#只有一个-Thread" class="headerlink" title="只有一个 Thread"></a>只有一个 Thread</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EqThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"Earthquake %s lasts %d seconds."</span> % (self.name, i))    <span class="comment"># self.name 保存当前线程的名字</span></span><br><span class="line"></span><br><span class="line">t = EqThread()</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># 会输出：Earthquake Thread-1 lasts 0/1/2 seconds.</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>僵尸进程：如果子进程死了，主进程还没有给它收尸，那么就称为僵尸进程。</li>
<li>孤儿进程：主进程先挂了，还在运行的子进程是孤儿进程。</li>
</ol>
<h3 id="多个-Thread-进程"><a href="#多个-Thread-进程" class="headerlink" title="多个 Thread 进程"></a>多个 Thread 进程</h3><p>5个线程各自独立运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EqThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"Earthquake %s lasts %d seconds."</span> % (self.name, i))    <span class="comment"># self.name 保存当前线程的名字</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = EqThread()</span><br><span class="line">    t.start()</span><br><span class="line"><span class="comment"># 会输出：Earthquake Thread-1 lasts 0/1/2 seconds.</span></span><br></pre></td></tr></table></figure>

<h2 id="多线程下的变量"><a href="#多线程下的变量" class="headerlink" title="多线程下的变量"></a>多线程下的变量</h2><ol>
<li><mark>全局变量</mark>对于多线程来说，是共享的！一个线程修改了全局变量，会在另外一个线程里面反映出来。</li>
<li>对于函数里面定义的<mark>局部变量</mark>，即使多个线程都是执行同一个函数，那么局部变量还是各自独有的。</li>
</ol>
<h3 id="八阿哥"><a href="#八阿哥" class="headerlink" title="八阿哥"></a>八阿哥</h3><p>几个线程同时操作一个全局变量，会出错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>

<h3 id="简单的解决方法：轮询"><a href="#简单的解决方法：轮询" class="headerlink" title="简单的解决方法：轮询"></a>简单的解决方法：轮询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">                num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>

<p>轮询可以解决，但是线程2的 While true 还是会占用CPU的。</p>
<h3 id="高级解决方法二：mutex互斥锁"><a href="#高级解决方法二：mutex互斥锁" class="headerlink" title="高级解决方法二：mutex互斥锁"></a>高级解决方法二：mutex互斥锁</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line"></span><br><span class="line">    l.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    l.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line"></span><br><span class="line">    l.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    l.release()</span><br><span class="line"></span><br><span class="line">l = Lock()</span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>此处把锁放到 for 循环外面，这两个线程实际上并没有并行，因为是一个线程执行完以后，另外一个线程才开始执行。</li>
<li>可以把锁放到 for 循环里面，只要包裹住 “num += 1” </li>
</ol>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>下面的代码有可能导致出现死锁。<br>即线程一在等待获得 mutexB, 线程二在等待获得 mutexA.<br>此时会卡住。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in thread 1</span></span><br><span class="line">mutexA.acquire()</span><br><span class="line">mutexB.acquire()</span><br><span class="line">mutexB.release()</span><br><span class="line">mutexA.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># in thread 2</span></span><br><span class="line">mutexB.acquire()</span><br><span class="line">mutexA.acquire()</span><br><span class="line">mutexA.release()</span><br><span class="line">mutexB.release()</span><br></pre></td></tr></table></figure>

<p>解决方法就是在写代码的时候就考虑到这个问题，或者加上超时保护，或者采用银行家算法。</p>
<h2 id="多个线程同步，按顺序执行"><a href="#多个线程同步，按顺序执行" class="headerlink" title="多个线程同步，按顺序执行"></a>多个线程同步，按顺序执行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task1</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock1.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock2.release()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task2</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock2.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock3.release()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task3</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock3.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock1.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lock1 = Lock()</span><br><span class="line"></span><br><span class="line">lock2 = Lock()</span><br><span class="line">lock2.acquire()</span><br><span class="line"></span><br><span class="line">lock3 = Lock()</span><br><span class="line">lock3.acquire()</span><br><span class="line"></span><br><span class="line">t1 = Task1()</span><br><span class="line">t2 = Task2()</span><br><span class="line">t3 = Task3()</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t3.start()</span><br></pre></td></tr></table></figure>

<h2 id="生产者-消费者-解耦"><a href="#生产者-消费者-解耦" class="headerlink" title="生产者-消费者-解耦"></a>生产者-消费者-解耦</h2><ol>
<li>为什么要使用生产者和消费者模式<ol>
<li>现实世界里，我们会碰到一个线程专门用来生产数据，另一个线程专门用来处理数据。这两者的速度不一定一致。如果一个跑的快，那么就需要不停地等待另一个执行完毕才会继续进行。为了解决这个问题才引入了生产者和消费者模式。</li>
</ol>
</li>
<li>什么事生产者和消费者模式<ol>
<li>这个模式说的就是利用 Queue 容器来解决生产者和消费者的强耦合问题。</li>
<li>生产者和消费者之间不直接进行通讯，而是生产者把产生的数据扔给阻塞队列，消费者从阻塞队列里取数据。</li>
<li>阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。</li>
<li>这个阻塞队列就是用来给二者解耦的。很多设计模式都会利用第三者来进行解耦。</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># python 2</span></span><br><span class="line">    <span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> queue</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> queue.qsize() &lt; <span class="number">1000</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">                    count = count+<span class="number">1</span></span><br><span class="line">                    msg = <span class="string">"produced "</span> + str(count)</span><br><span class="line">                    queue.put(msg)</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> queue</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> queue.qsize() &gt; <span class="number">100</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                    msg = self.name + <span class="string">" consumes "</span> + queue.get()</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    queue = Queue()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">500</span>):</span><br><span class="line">        queue.put(<span class="string">"Initial product "</span> + str(i))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        p = Producer()</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        c = Consumer()</span><br><span class="line">        c.start()</span><br></pre></td></tr></table></figure>

<h2 id="线程里面多个函数使用变量的方法"><a href="#线程里面多个函数使用变量的方法" class="headerlink" title="线程里面多个函数使用变量的方法"></a>线程里面多个函数使用变量的方法</h2><p>多线程使用全局变量，若要修改必须加锁，不是很方便。<br>使用局部变量的话比较好，但是也有自己的问题。</p>
<h3 id="方法一：函数传参的方法"><a href="#方法一：函数传参的方法" class="headerlink" title="方法一：函数传参的方法"></a>方法一：函数传参的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">(name)</span>:</span></span><br><span class="line">    eq = Earthquake(name)</span><br><span class="line">    do_job_1(eq)</span><br><span class="line">    do_job_2(eq)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_1</span><span class="params">(eq)</span>:</span></span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_2</span><span class="params">(eq)</span>:</span></span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br></pre></td></tr></table></figure>


<h3 id="方法二：使用全局字典的方法"><a href="#方法二：使用全局字典的方法" class="headerlink" title="方法二：使用全局字典的方法"></a>方法二：使用全局字典的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">g_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">(name)</span>:</span></span><br><span class="line">    eq = Earthquake(name)</span><br><span class="line">    g_dict[threading.current_thread()] = eq</span><br><span class="line">    do_job_1()</span><br><span class="line">    do_job_2()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 直接用当前线程作为 key 查找全局字典来获得 value，避免了使用函数形参</span></span><br><span class="line">    eq = g_dict[threading.current_thread()]</span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_2</span><span class="params">()</span>:</span></span><br><span class="line">    eq = g_dict[threading.current_thread()]</span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br></pre></td></tr></table></figure>

<h3 id="方法三：ThreadLocal"><a href="#方法三：ThreadLocal" class="headerlink" title="方法三：ThreadLocal"></a>方法三：ThreadLocal</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建全局 ThreadLocal 对象</span></span><br><span class="line">local_cluster = threading.local()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">()</span>:</span></span><br><span class="line">    eq = local_cluster.earthquake</span><br><span class="line">    <span class="comment"># do some stuff to eq</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_thread</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="comment"># 绑定 ThreadLocal 的 earthquake</span></span><br><span class="line">    local_cluster.earthquake = Earthquake(name)</span><br><span class="line">    processEarthquake()</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=process_thread, args=(<span class="string">"Zheng"</span>,), name=<span class="string">"Thread-1"</span>)</span><br><span class="line">t2 = threading.Thread(target=process_thread, args=(<span class="string">"Xing"</span>,), name=<span class="string">"Thread-2"</span>)</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br></pre></td></tr></table></figure>

<h2 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h2><p>关于 GIL(全局解释器锁)，其实只需要记住，在python 里面，是不存在线程并行的。<br>同一时刻，最多只有一个线程在运行。</p>
<h3 id="解决办法一：使用多进程"><a href="#解决办法一：使用多进程" class="headerlink" title="解决办法一：使用多进程"></a>解决办法一：使用多进程</h3><h3 id="解决办法二：关键部分用-C-来写"><a href="#解决办法二：关键部分用-C-来写" class="headerlink" title="解决办法二：关键部分用 C 来写"></a>解决办法二：关键部分用 C 来写</h3><p>Python 里面需要调用 ctypes 模块里面的功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载动态库，这个库里面只有一个函数: DeadLoop</span></span><br><span class="line">lib = cdll.LoadLibrary(<span class="string">"./libdeadloop.so"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个子线程，让其执行c语言所编写的函数，此函数是一个死循环</span></span><br><span class="line">t = Thread(target=lib.DeadLoop)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主线程，也调用c语言编写的那个死循环函数</span></span><br><span class="line"><span class="comment">#lib.DeadLoop()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>其中用到的 动态库对应的c语言如下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeadLoop</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note: 动态库有个好处就是不需要show源代码给别人就可以让别人用这个功能。</p>
<p>这个文件需要用如下语句来编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc source.c -shared -o libDeadLoop.so</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/27/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/27/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="url">程序员面试知识点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-27T14:52:34+08:00">
                2018-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">面试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/27/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/27/程序员面试知识点/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ol>
<li>算法和数据结构<ol>
<li>至少知道两种n*log(n)的排序算法，比如快速排序和归并排序。merge sort 很重要，比如K-way merge sorts</li>
<li>Graph在内存中的三种构造方式(objects and pointers, matrix, and adjacency list)</li>
<li>掌握二分查找思想及应用场景，灵活处理类似问题，比如search in a sorted array查找、实现sqrt()等问题</li>
<li>大体了解一种平衡树，比如(red/black tree, splay tree or AVL tree) , 比如知道treemap的内部实现是red/black tree， 了解database index 所用的b+ tree/b tree.</li>
<li>Binary Search Tree的基本操作比如添加、删除节点，树与其他数据结构的相互转化, BST删除节点操作基本都会挂。</li>
<li>二叉树的各种遍历算法（前序、中序、后序、层序），根据遍历结果重建二叉树；</li>
<li>K-ary trees（一个树有k个children)/trie-tree的实现算法和应用场景；</li>
<li>结合Graph常考的算法比如拓扑排序，最短路径以及最小生成树算法</li>
<li>理解Min/Max heap的实现、各种操作时间复杂度和应用场景，熟练解决查找top(N)类型问题；</li>
<li>Hashtable: 透彻理解Hashtable的原理、性能、碰撞处理，并能用array (in your favorate language) 来实现一个简单的hashtable，考虑多线程的情况；对于java的hashmap 要了解java hashmap和hashtable区别，concurrenthashmap, linkedhashmap.</li>
</ol>
</li>
<li>操作系统<ol>
<li>理解操作系统中的进程、线程、以及它们之间的区别</li>
<li>理解系统并发操作中的常见问题（死锁），以及如何使用locks, mutexes, semaphores来解决并发问题。</li>
</ol>
</li>
<li>计算机网络<ol>
<li>tcp/ip三次握手</li>
<li>http/https区别</li>
<li>输入<a href="http://www.google.com" target="_blank" rel="noopener">http://www.google.com</a> 这个网址后会发生什么</li>
</ol>
</li>
<li>C++ 语言<ol>
<li>理解面向对象设计（封装、继承、多态），能把一个模糊定义的业务需求用OO的方式抽象（比如设计电梯、停车场等）；设计模式：Singleton（线程安全版本）、factory等；</li>
<li></li>
</ol>
</li>
<li>Python 语言</li>
<li>分布式系统，大数据处理<ol>
<li>理解分布式系统的基本概念，解决的问题以及分布式系统设计中CAP(Consistency, Availability, Partition)一致性、可用性、高性能之间的trade-offs</li>
<li>sql与nosql数据库区别，简单了解几种nosql数据库；mysql vs MongoDB vs redis</li>
</ol>
</li>
<li>杂<ol>
<li>了解你所面试的公司：产品，成立时间，融资，竞争对手</li>
</ol>
</li>
</ol>
<h1 id="展开"><a href="#展开" class="headerlink" title="展开"></a>展开</h1><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><h3 id="“What-happens-when-you-type-google-com-into-your-browser’s-address-box-and-press-enter-”"><a href="#“What-happens-when-you-type-google-com-into-your-browser’s-address-box-and-press-enter-”" class="headerlink" title="“What happens when you type google.com into your browser’s address box and press enter?”"></a>“What happens when you type google.com into your browser’s address box and press enter?”</h3><p>This is a partial article from <a href="https://github.com/alex/what-happens-when" target="_blank" rel="noopener">this one</a>.</p>
<h4 id="The-“g”-key-is-pressed"><a href="#The-“g”-key-is-pressed" class="headerlink" title="The “g” key is pressed"></a>The “g” key is pressed</h4><p>The following sections explains the physical keyboard actions and the OS<br>interrupts. When you press the key “g” the browser receives the event<br>and the auto-complete functions kick in. Depending on your browser’s<br>algorithm and if you are in private/incognito mode or not various<br>suggestions will be presented to you in the dropbox below the URL bar.<br>Most of these algorithms sort and prioritize results based on search<br>history, bookmarks, cookies, and popular searches from the internet as a<br>whole. As you are typing “google.com” many blocks of code run and the<br>suggestions will be refined with each key press. It may even suggest<br>“google.com” before you finish typing it.</p>
<h4 id="The-“enter”-key-bottoms-out"><a href="#The-“enter”-key-bottoms-out" class="headerlink" title="The “enter” key bottoms out"></a>The “enter” key bottoms out</h4><p>To pick a zero point, let’s choose the Enter key on the keyboard hitting<br>the bottom of its range. At this point, an electrical circuit specific<br>to the enter key is closed (either directly or capacitively). This<br>allows a small amount of current to flow into the logic circuitry of the<br>keyboard, which scans the state of each key switch, debounces the<br>electrical noise of the rapid intermittent closure of the switch, and<br>converts it to a keycode integer, in this case 13. The keyboard<br>controller then encodes the keycode for transport to the computer. This<br>is now almost universally over a Universal Serial Bus (USB) or Bluetooth<br>connection, but historically has been over PS/2 or ADB connections.</p>
<p><em>In the case of the USB keyboard:</em></p>
<ul>
<li>The USB circuitry of the keyboard is powered by the 5V supply<br>provided over pin 1 from the computer’s USB host controller.</li>
<li>The keycode generated is stored by internal keyboard circuitry<br>memory in a register called “endpoint”.</li>
<li>The host USB controller polls that “endpoint” every ~10ms (minimum<br>value declared by the keyboard), so it gets the keycode value stored<br>on it.</li>
<li>This value goes to the USB SIE (Serial Interface Engine) to be<br>converted in one or more USB packets that follows the low level<br>USB protocol.</li>
<li>Those packets are sent by a differential electrical signal over D+<br>and D-pins (the middle 2) at a maximum speed of 1.5 Mb/s, as an HID<br>(Human Interface Device) device is always declared to be a “low<br>speed device” (USB 2.0 compliance).</li>
<li>This serial signal is then decoded at the computer’s host USB<br>controller, and interpreted by the computer’s Human Interface<br>Device (HID) universal keyboard device driver. The value of the key<br>is then passed into the operating system’s hardware<br>abstraction layer.</li>
</ul>
<p><em>In the case of Virtual Keyboard (as in touch screen devices):</em></p>
<ul>
<li>When the user puts their finger on a modern capacitive touch screen,<br>a tiny amount of current gets transferred to the finger. This<br>completes the circuit through the electrostatic field of the<br>conductive layer and creates a voltage drop at that point on<br>the screen. The <code>screen controller</code> then raises an interrupt<br>reporting the coordinate of the key press.</li>
<li>Then the mobile OS notifies the current focused application of a<br>press event in one of its GUI elements (which now is the virtual<br>keyboard application buttons).</li>
<li>The virtual keyboard can now raise a software interrupt for sending<br>a ‘key pressed’ message back to the OS.</li>
<li>This interrupt notifies the current focused application of a ‘key<br>pressed’ event.</li>
</ul>
<h4 id="Interrupt-fires-NOT-for-USB-keyboards"><a href="#Interrupt-fires-NOT-for-USB-keyboards" class="headerlink" title="Interrupt fires [NOT for USB keyboards]"></a>Interrupt fires [NOT for USB keyboards]</h4><p>The keyboard sends signals on its interrupt request line (IRQ), which is<br>mapped to an <code>interrupt vector</code> (integer) by the interrupt controller.<br>The CPU uses the <code>Interrupt Descriptor Table</code> (IDT) to map the interrupt<br>vectors to functions (<code>interrupt handlers</code>) which are supplied by the<br>kernel. When an interrupt arrives, the CPU indexes the IDT with the<br>interrupt vector and runs the appropriate handler. Thus, the kernel is<br>entered.</p>
<h4 id="Parse-URL"><a href="#Parse-URL" class="headerlink" title="Parse URL"></a>Parse URL</h4><ul>
<li><p>The browser now has the following information contained in the URL<br>(Uniform Resource Locator):</p>
<blockquote>
<p>-</p>
<pre><code>`Protocol` &quot;http&quot;

:   Use &apos;Hyper Text Transfer Protocol&apos;</code></pre><p>-</p>
<pre><code>`Resource` &quot;/&quot;

:   Retrieve main (index) page</code></pre></blockquote>
</li>
</ul>
<h4 id="Is-it-a-URL-or-a-search-term"><a href="#Is-it-a-URL-or-a-search-term" class="headerlink" title="Is it a URL or a search term?"></a>Is it a URL or a search term?</h4><p>When no protocol or valid domain name is given the browser proceeds to<br>feed the text given in the address box to the browser’s default web<br>search engine. In many cases the URL has a special piece of text<br>appended to it to tell the search engine that it came from a particular<br>browser’s URL bar.</p>
<h4 id="Convert-non-ASCII-Unicode-characters-in-hostname"><a href="#Convert-non-ASCII-Unicode-characters-in-hostname" class="headerlink" title="Convert non-ASCII Unicode characters in hostname"></a>Convert non-ASCII Unicode characters in hostname</h4><ul>
<li>The browser checks the hostname for characters that are not in<br><code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, <code>-</code>, or <code>.</code>.</li>
<li>Since the hostname is <code>google.com</code> there won’t be any, but if there<br>were the browser would apply<br><a href="https://en.wikipedia.org/wiki/Punycode" target="_blank" rel="noopener">Punycode</a> encoding to the<br>hostname portion of the URL.</li>
</ul>
<h4 id="Check-HSTS-list"><a href="#Check-HSTS-list" class="headerlink" title="Check HSTS list"></a>Check HSTS list</h4><ul>
<li>The browser checks its “preloaded HSTS (HTTP Strict Transport<br>Security)” list. This is a list of websites that have requested to<br>be contacted via HTTPS only.</li>
<li>If the website is in the list, the browser sends its request via<br>HTTPS instead of HTTP. Otherwise, the initial request is sent via<br>HTTP. (Note that a website can still use the HSTS policy <em>without</em><br>being in the HSTS list. The first HTTP request to the website by a<br>user will receive a response requesting that the user only send<br>HTTPS requests. However, this single HTTP request could potentially<br>leave the user vulnerable to a downgrade attack_, which is why the<br>HSTS list is included in modern web browsers.)</li>
</ul>
<h4 id="DNS-lookup"><a href="#DNS-lookup" class="headerlink" title="DNS lookup"></a>DNS lookup</h4><ul>
<li>Browser checks if the domain is in its cache. (to see the DNS Cache<br>in Chrome, go to<br><a href="chrome://net-internals/#dns"><a href="chrome://net-internals/#dns">chrome://net-internals/#dns</a></a>).</li>
<li>If not found, the browser calls <code>gethostbyname</code> library function<br>(varies by OS) to do the lookup.</li>
<li><code>gethostbyname</code> checks if the hostname can be resolved by reference<br>in the local <code>hosts</code> file (whose location varies by OS_) before<br>trying to resolve the hostname through DNS.</li>
<li>If <code>gethostbyname</code> does not have it cached nor can find it in the<br><code>hosts</code> file then it makes a request to the DNS server configured in<br>the network stack. This is typically the local router or the ISP’s<br>caching DNS server.</li>
<li>If the DNS server is on the same subnet the network library follows<br>the <code>ARP process</code> below for the DNS server.</li>
<li>If the DNS server is on a different subnet, the network library<br>follows the <code>ARP process</code> below for the default gateway IP.</li>
</ul>
<h4 id="ARP-process"><a href="#ARP-process" class="headerlink" title="ARP process"></a>ARP process</h4><p>In order to send an ARP (Address Resolution Protocol) broadcast the<br>network stack library needs the target IP address to look up. It also<br>needs to know the MAC address of the interface it will use to send out<br>the ARP broadcast.</p>
<p>The ARP cache is first checked for an ARP entry for our target IP. If it<br>is in the cache, the library function returns the result: Target IP =<br>MAC.</p>
<p>If the entry is not in the ARP cache:</p>
<ul>
<li>The route table is looked up, to see if the Target IP address is on<br>any of the subnets on the local route table. If it is, the library<br>uses the interface associated with that subnet. If it is not, the<br>library uses the interface that has the subnet of our<br>default gateway.</li>
<li>The MAC address of the selected network interface is looked up.</li>
<li>The network library sends a Layer 2 (data link layer of the<br>OSI model_) ARP request:</li>
</ul>
<p><code>ARP Request</code>:</p>
<pre><code>Sender MAC: interface:mac:address:here
Sender IP: interface.ip.goes.here
Target MAC: FF:FF:FF:FF:FF:FF (Broadcast)
Target IP: target.ip.goes.here</code></pre><p>Depending on what type of hardware is between the computer and the<br>router:</p>
<p>Directly connected:</p>
<ul>
<li>If the computer is directly connected to the router the router<br>responds with an <code>ARP Reply</code> (see below)</li>
</ul>
<p>Hub:</p>
<ul>
<li>If the computer is connected to a hub, the hub will broadcast the<br>ARP request out all other ports. If the router is connected on the<br>same “wire”, it will respond with an <code>ARP Reply</code> (see below).</li>
</ul>
<p>Switch:</p>
<ul>
<li>If the computer is connected to a switch, the switch will check its<br>local CAM/MAC table to see which port has the MAC address we are<br>looking for. If the switch has no entry for the MAC address it will<br>rebroadcast the ARP request to all other ports.</li>
<li>If the switch has an entry in the MAC/CAM table it will send the ARP<br>request to the port that has the MAC address we are looking for.</li>
<li>If the router is on the same “wire”, it will respond with an<br><code>ARP Reply</code> (see below)</li>
</ul>
<p><code>ARP Reply</code>:</p>
<pre><code>Sender MAC: target:mac:address:here
Sender IP: target.ip.goes.here
Target MAC: interface:mac:address:here
Target IP: interface.ip.goes.here</code></pre><p>Now that the network library has the IP address of either our DNS server<br>or the default gateway it can resume its DNS process:</p>
<ul>
<li>Port 53 is opened to send a UDP request to DNS server (if the<br>response size is too large, TCP will be used instead).</li>
<li>If the local/ISP DNS server does not have it, then a recursive<br>search is requested and that flows up the list of DNS servers until<br>the SOA is reached, and if found an answer is returned.</li>
</ul>
<h4 id="Opening-of-a-socket"><a href="#Opening-of-a-socket" class="headerlink" title="Opening of a socket"></a>Opening of a socket</h4><p>Once the browser receives the IP address of the destination server, it<br>takes that and the given port number from the URL (the HTTP protocol<br>defaults to port 80, and HTTPS to port 443), and makes a call to the<br>system library function named <code>socket</code> and requests a TCP socket stream</p>
<ul>
<li><p><code>AF_INET/AF_INET6</code> and <code>SOCK_STREAM</code>.</p>
</li>
<li><p>This request is first passed to the Transport Layer where a TCP<br>segment is crafted. The destination port is added to the header, and<br>a source port is chosen from within the kernel’s dynamic port range<br>(ip_local_port_range in Linux).</p>
</li>
<li><p>This segment is sent to the Network Layer, which wraps an additional<br>IP header. The IP address of the destination server as well as that<br>of the current machine is inserted to form a packet.</p>
</li>
<li><p>The packet next arrives at the Link Layer. A frame header is added<br>that includes the MAC address of the machine’s NIC as well as the<br>MAC address of the gateway (local router). As before, if the kernel<br>does not know the MAC address of the gateway, it must broadcast an<br>ARP query to find it.</p>
</li>
</ul>
<p>At this point the packet is ready to be transmitted through either:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/IEEE_802.3" target="_blank" rel="noopener">Ethernet</a></li>
<li><a href="https://en.wikipedia.org/wiki/IEEE_802.11" target="_blank" rel="noopener">WiFi</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cellular_data_communication_protocol" target="_blank" rel="noopener">Cellular data<br>network</a></li>
</ul>
<p>For most home or small business Internet connections the packet will<br>pass from your computer, possibly through a local network, and then<br>through a modem (MOdulator/DEModulator) which converts digital 1’s and<br>0’s into an analog signal suitable for transmission over telephone,<br>cable, or wireless telephony connections. On the other end of the<br>connection is another modem which converts the analog signal back into<br>digital data to be processed by the next <a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">network<br>node</a><br>where the from and to addresses would be analyzed further.</p>
<p>Most larger businesses and some newer residential connections will have<br>fiber or direct Ethernet connections in which case the data remains<br>digital and is passed directly to the next <a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">network<br>node</a> for<br>processing.</p>
<p>Eventually, the packet will reach the router managing the local subnet.<br>From there, it will continue to travel to the autonomous system’s (AS)<br>border routers, other ASes, and finally to the destination server. Each<br>router along the way extracts the destination address from the IP header<br>and routes it to the appropriate next hop. The time to live (TTL) field<br>in the IP header is decremented by one for each router that passes. The<br>packet will be dropped if the TTL field reaches zero or if the current<br>router has no space in its queue (perhaps due to network congestion).</p>
<p>This send and receive happens multiple times following the TCP<br>connection flow:</p>
<ul>
<li><p>Client chooses an initial sequence number (ISN) and sends the packet<br>to the server with the SYN bit set to indicate it is setting the ISN</p>
</li>
<li><p>   Server receives SYN and if it’s in an agreeable mood:</p>
<p>   :   -   Server chooses its own initial sequence number</p>
<pre><code>-   Server sets SYN to indicate it is choosing its ISN
-   Server copies the (client ISN +1) to its ACK field and adds
    the ACK flag to indicate it is acknowledging receipt of the
    first packet</code></pre></li>
</ul>
<p>-</p>
<pre><code>Client acknowledges the connection by sending a packet:

:   -   Increases its own sequence number
    -   Increases the receiver acknowledgment number
    -   Sets ACK field</code></pre><p>-</p>
<pre><code>Data is transferred as follows:

:   -   As one side sends N data bytes, it increases its SEQ by that
        number
    -   When the other side acknowledges receipt of that packet (or
        a string of packets), it sends an ACK packet with the ACK
        value equal to the last received sequence from the other</code></pre><p>-</p>
<pre><code>To close the connection:

:   -   The closer sends a FIN packet
    -   The other sides ACKs the FIN packet and sends its own FIN
    -   The closer acknowledges the other side&apos;s FIN with an ACK</code></pre><h4 id="TLS-handshake"><a href="#TLS-handshake" class="headerlink" title="TLS handshake"></a>TLS handshake</h4><ul>
<li>The client computer sends a <code>ClientHello</code> message to the server with<br>its Transport Layer Security (TLS) version, list of cipher<br>algorithms and compression methods available.</li>
<li>The server replies with a <code>ServerHello</code> message to the client with<br>the TLS version, selected cipher, selected compression methods and<br>the server’s public certificate signed by a CA<br>(Certificate Authority). The certificate contains a public key that<br>will be used by the client to encrypt the rest of the handshake<br>until a symmetric key can be agreed upon.</li>
<li>The client verifies the server digital certificate against its list<br>of trusted CAs. If trust can be established based on the CA, the<br>client generates a string of pseudo-random bytes and encrypts this<br>with the server’s public key. These random bytes can be used to<br>determine the symmetric key.</li>
<li>The server decrypts the random bytes using its private key and uses<br>these bytes to generate its own copy of the symmetric master key.</li>
<li>The client sends a <code>Finished</code> message to the server, encrypting a<br>hash of the transmission up to this point with the symmetric key.</li>
<li>The server generates its own hash, and then decrypts the client-sent<br>hash to verify that it matches. If it does, it sends its own<br><code>Finished</code> message to the client, also encrypted with the<br>symmetric key.</li>
<li>From now on the TLS session transmits the application (HTTP) data<br>encrypted with the agreed symmetric key.</li>
</ul>
<h4 id="HTTP-protocol"><a href="#HTTP-protocol" class="headerlink" title="HTTP protocol"></a>HTTP protocol</h4><p>If the web browser used was written by Google, instead of sending an<br>HTTP request to retrieve the page, it will send a request to try and<br>negotiate with the server an “upgrade” from HTTP to the SPDY protocol.</p>
<p>If the client is using the HTTP protocol and does not support SPDY, it<br>sends a request to the server of the form:</p>
<pre><code>GET / HTTP/1.1
Host: google.com
Connection: close
[other headers]</code></pre><p>where <code>[other headers]</code> refers to a series of colon-separated key-value<br>pairs formatted as per the HTTP specification and separated by single<br>new lines. (This assumes the web browser being used doesn’t have any<br>bugs violating the HTTP spec. This also assumes that the web browser is<br>using <code>HTTP/1.1</code>, otherwise it may not include the <code>Host</code> header in the<br>request and the version specified in the <code>GET</code> request will either be<br><code>HTTP/1.0</code> or <code>HTTP/0.9</code>.)</p>
<p>HTTP/1.1 defines the “close” connection option for the sender to signal<br>that the connection will be closed after completion of the response. For<br>example,</p>
<blockquote>
<p>Connection: close</p>
</blockquote>
<p>HTTP/1.1 applications that do not support persistent connections MUST<br>include the “close” connection option in every message.</p>
<p>After sending the request and headers, the web browser sends a single<br>blank newline to the server indicating that the content of the request<br>is done.</p>
<p>The server responds with a response code denoting the status of the<br>request and responds with a response of the form:</p>
<pre><code>200 OK
[response headers]</code></pre><p>Followed by a single newline, and then sends a payload of the HTML<br>content of <code>www.google.com</code>. The server may then either close the<br>connection, or if headers sent by the client requested it, keep the<br>connection open to be reused for further requests.</p>
<p>If the HTTP headers sent by the web browser included sufficient<br>information for the web server to determine if the version of the file<br>cached by the web browser has been unmodified since the last retrieval<br>(ie. if the web browser included an <code>ETag</code> header), it may instead<br>respond with a request of the form:</p>
<pre><code>304 Not Modified
[response headers]</code></pre><p>and no payload, and the web browser instead retrieves the HTML from its<br>cache.</p>
<p>After parsing the HTML, the web browser (and server) repeats this<br>process for every resource (image, CSS, favicon.ico, etc) referenced by<br>the HTML page, except instead of <code>GET / HTTP/1.1</code> the request will be<br><code>GET /$(URL relative to www.google.com) HTTP/1.1</code>.</p>
<p>If the HTML referenced a resource on a different domain than<br><code>www.google.com</code>, the web browser goes back to the steps involved in<br>resolving the other domain, and follows all steps up to this point for<br>that domain. The <code>Host</code> header in the request will be set to the<br>appropriate server name instead of <code>google.com</code>.</p>
<h4 id="HTTP-Server-Request-Handle"><a href="#HTTP-Server-Request-Handle" class="headerlink" title="HTTP Server Request Handle"></a>HTTP Server Request Handle</h4><p>The HTTPD (HTTP Daemon) server is the one handling the<br>requests/responses on the server side. The most common HTTPD servers are<br>Apache or nginx for Linux and IIS for Windows.</p>
<ul>
<li><p>The HTTPD (HTTP Daemon) receives the request.</p>
</li>
<li><p>   The server breaks down the request to the following parameters:</p>
<p>   :   -   HTTP Request Method (either <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>,</p>
<pre><code>    `DELETE`, `CONNECT`, `OPTIONS`, or `TRACE`). In the case of
    a URL entered directly into the address bar, this will be
    `GET`.
-   Domain, in this case - google.com.
-   Requested path/page, in this case - / (as no specific
    path/page was requested, / is the default path).</code></pre></li>
<li><p>The server verifies that there is a Virtual Host configured on the<br>server that corresponds with google.com.</p>
</li>
<li><p>The server verifies that google.com can accept GET requests.</p>
</li>
<li><p>The server verifies that the client is allowed to use this method<br>(by IP, authentication, etc.).</p>
</li>
<li><p>If the server has a rewrite module installed (like mod_rewrite for<br>Apache or URL Rewrite for IIS), it tries to match the request<br>against one of the configured rules. If a matching rule is found,<br>the server uses that rule to rewrite the request.</p>
</li>
<li><p>The server goes to pull the content that corresponds with the<br>request, in our case it will fall back to the index file, as “/“ is<br>the main file (some cases can override this, but this is the most<br>common method).</p>
</li>
<li><p>The server parses the file according to the handler. If Google is<br>running on PHP, the server uses PHP to interpret the index file, and<br>streams the output to the client.</p>
</li>
</ul>
<h4 id="Behind-the-scenes-of-the-Browser"><a href="#Behind-the-scenes-of-the-Browser" class="headerlink" title="Behind the scenes of the Browser"></a>Behind the scenes of the Browser</h4><p>Once the server supplies the resources (HTML, CSS, JS, images, etc.) to<br>the browser it undergoes the below process:</p>
<ul>
<li>Parsing - HTML, CSS, JS</li>
<li>Rendering - Construct DOM Tree → Render Tree → Layout of Render Tree<br>→ Painting the render tree</li>
</ul>
<h4 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h4><p>The browser’s functionality is to present the web resource you choose,<br>by requesting it from the server and displaying it in the browser<br>window. The resource is usually an HTML document, but may also be a PDF,<br>image, or some other type of content. The location of the resource is<br>specified by the user using a URI (Uniform Resource Identifier).</p>
<p>The way the browser interprets and displays HTML files is specified in<br>the HTML and CSS specifications. These specifications are maintained by<br>the W3C (World Wide Web Consortium) organization, which is the standards<br>organization for the web.</p>
<p>Browser user interfaces have a lot in common with each other. Among the<br>common user interface elements are:</p>
<ul>
<li>An address bar for inserting a URI</li>
<li>Back and forward buttons</li>
<li>Bookmarking options</li>
<li>Refresh and stop buttons for refreshing or stopping the loading of<br>current documents</li>
<li>Home button that takes you to your home page</li>
</ul>
<p><strong>Browser High Level Structure</strong></p>
<p>The components of the browsers are:</p>
<ul>
<li><strong>User interface:</strong> The user interface includes the address bar,<br>back/forward button, bookmarking menu, etc. Every part of the<br>browser display except the window where you see the requested page.</li>
<li><strong>Browser engine:</strong> The browser engine marshals actions between the<br>UI and the rendering engine.</li>
<li><strong>Rendering engine:</strong> The rendering engine is responsible for<br>displaying requested content. For example if the requested content<br>is HTML, the rendering engine parses HTML and CSS, and displays the<br>parsed content on the screen.</li>
<li><strong>Networking:</strong> The networking handles network calls such as HTTP<br>requests, using different implementations for different platforms<br>behind a platform-independent interface.</li>
<li><strong>UI backend:</strong> The UI backend is used for drawing basic widgets<br>like combo boxes and windows. This backend exposes a generic<br>interface that is not platform specific. Underneath it uses<br>operating system user interface methods.</li>
<li><strong>JavaScript engine:</strong> The JavaScript engine is used to parse and<br>execute JavaScript code.</li>
<li><strong>Data storage:</strong> The data storage is a persistence layer. The<br>browser may need to save all sorts of data locally, such as cookies.<br>Browsers also support storage mechanisms such as localStorage,<br>IndexedDB, WebSQL and FileSystem.</li>
</ul>
<h4 id="HTML-parsing"><a href="#HTML-parsing" class="headerlink" title="HTML parsing"></a>HTML parsing</h4><p>The rendering engine starts getting the contents of the requested<br>document from the networking layer. This will usually be done in 8kB<br>chunks.</p>
<p>The primary job of HTML parser to parse the HTML markup into a parse<br>tree.</p>
<p>The output tree (the “parse tree”) is a tree of DOM element and<br>attribute nodes. DOM is short for Document Object Model. It is the<br>object presentation of the HTML document and the interface of HTML<br>elements to the outside world like JavaScript. The root of the tree is<br>the “Document” object. Prior of any manipulation via scripting, the DOM<br>has an almost one-to-one relation to the markup.</p>
<p><strong>The parsing algorithm</strong></p>
<p>HTML cannot be parsed using the regular top-down or bottom-up parsers.</p>
<p>The reasons are:</p>
<ul>
<li>The forgiving nature of the language.</li>
<li>The fact that browsers have traditional error tolerance to support<br>well known cases of invalid HTML.</li>
<li>The parsing process is reentrant. For other languages, the source<br>doesn’t change during parsing, but in HTML, dynamic code (such as<br>script elements containing document.write() calls) can add extra<br>tokens, so the parsing process actually modifies the input.</li>
</ul>
<p>Unable to use the regular parsing techniques, the browser utilizes a<br>custom parser for parsing HTML. The parsing algorithm is described in<br>detail by the HTML5 specification.</p>
<p>The algorithm consists of two stages: tokenization and tree<br>construction.</p>
<p><strong>Actions when the parsing is finished</strong></p>
<p>The browser begins fetching external resources linked to the page (CSS,<br>images, JavaScript files, etc.).</p>
<p>At this stage the browser marks the document as interactive and starts<br>parsing scripts that are in “deferred” mode: those that should be<br>executed after the document is parsed. The document state is set to<br>“complete” and a “load” event is fired.</p>
<p>Note there is never an “Invalid Syntax” error on an HTML page. Browsers<br>fix any invalid content and go on.</p>
<h4 id="CSS-interpretation"><a href="#CSS-interpretation" class="headerlink" title="CSS interpretation"></a>CSS interpretation</h4><ul>
<li>Parse CSS files, <code>&lt;style&gt;</code> tag contents, and <code>style</code> attribute<br>values using <a href="http://www.w3.org/TR/CSS2/grammar.html" target="_blank" rel="noopener">“CSS lexical and syntax<br>grammar”</a></li>
<li>Each CSS file is parsed into a <code>StyleSheet object</code>, where each<br>object contains CSS rules with selectors and objects corresponding<br>CSS grammar.</li>
<li>A CSS parser can be top-down or bottom-up when a specific parser<br>generator is used.</li>
</ul>
<h4 id="Page-Rendering"><a href="#Page-Rendering" class="headerlink" title="Page Rendering"></a>Page Rendering</h4><ul>
<li>Create a ‘Frame Tree’ or ‘Render Tree’ by traversing the DOM nodes,<br>and calculating the CSS style values for each node.</li>
<li>Calculate the preferred width of each node in the ‘Frame Tree’<br>bottom up by summing the preferred width of the child nodes and the<br>node’s horizontal margins, borders, and padding.</li>
<li>Calculate the actual width of each node top-down by allocating each<br>node’s available width to its children.</li>
<li>Calculate the height of each node bottom-up by applying text<br>wrapping and summing the child node heights and the node’s margins,<br>borders, and padding.</li>
<li>Calculate the coordinates of each node using the information<br>calculated above.</li>
<li>More complicated steps are taken when elements are <code>floated</code>,<br>positioned <code>absolutely</code> or <code>relatively</code>, or other complex features<br>are used. See <a href="http://dev.w3.org/csswg/css2/" target="_blank" rel="noopener">http://dev.w3.org/csswg/css2/</a> and<br><a href="http://www.w3.org/Style/CSS/current-work" target="_blank" rel="noopener">http://www.w3.org/Style/CSS/current-work</a> for more details.</li>
<li>Create layers to describe which parts of the page can be animated as<br>a group without being re-rasterized. Each frame/render object is<br>assigned to a layer.</li>
<li>Textures are allocated for each layer of the page.</li>
<li>The frame/render objects for each layer are traversed and drawing<br>commands are executed for their respective layer. This may be<br>rasterized by the CPU or drawn on the GPU directly using D2D/SkiaGL.</li>
<li>All of the above steps may reuse calculated values from the last<br>time the webpage was rendered, so that incremental changes require<br>less work.</li>
<li>The page layers are sent to the compositing process where they are<br>combined with layers for other visible content like the browser<br>chrome, iframes and addon panels.</li>
<li>Final layer positions are computed and the composite commands are<br>issued via Direct3D/OpenGL. The GPU command buffer(s) are flushed to<br>the GPU for asynchronous rendering and the frame is sent to the<br>window server.</li>
</ul>
<h4 id="GPU-Rendering"><a href="#GPU-Rendering" class="headerlink" title="GPU Rendering"></a>GPU Rendering</h4><ul>
<li>During the rendering process the graphical computing layers can use<br>general purpose <code>CPU</code> or the graphical processor <code>GPU</code> as well.</li>
<li>When using <code>GPU</code> for graphical rendering computations the graphical<br>software layers split the task into multiple pieces, so it can take<br>advantage of <code>GPU</code> massive parallelism for float point calculations<br>required for the rendering process.</li>
</ul>
<h4 id="Window-Server"><a href="#Window-Server" class="headerlink" title="Window Server"></a>Window Server</h4><h4 id="Post-rendering-and-user-induced-execution"><a href="#Post-rendering-and-user-induced-execution" class="headerlink" title="Post-rendering and user-induced execution"></a>Post-rendering and user-induced execution</h4><p>After rendering has completed, the browser executes JavaScript code as a<br>result of some timing mechanism (such as a Google Doodle animation) or<br>user interaction (typing a query into the search box and receiving<br>suggestions). Plugins such as Flash or Java may execute as well,<br>although not at this time on the Google homepage. Scripts can cause<br>additional network requests to be performed, as well as modify the page<br>or its layout, causing another round of page rendering and painting.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/%5C/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/%5C/">1</a><a class="page-number" href="/%5C/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/%5C/page/4/">4</a><a class="extend next" rel="next" href="/%5C/page/4/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Zheng Xing" />
            
              <p class="site-author-name" itemprop="name">Zheng Xing</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng Xing</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://githubio-2.disqus.com/count.js" async></script>
    

    

  




	





  











<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
