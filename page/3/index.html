<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="//page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zheng Xing">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com///page/3/"/>





  <title>Hexo</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/Algorithms-Questions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/Algorithms-Questions/" itemprop="url">Algorithms Questions</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T20:45:14-07:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/Algorithms-Questions/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/Algorithms-Questions/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="">Leetcode 0001</a><br><a href="">Leetcode 0002</a><br><a href="">Leetcode 0003</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/29/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/29/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/" itemprop="url">总目录索引</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-29T20:37:22-07:00">
                2018-08-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/29/%E6%80%BB%E7%9B%AE%E5%BD%95%E7%B4%A2%E5%BC%95/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/08/29/总目录索引/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://zheng-xing.github.io/2018/08/29/Algorithms-Questions/" target="_blank" rel="noopener">Algorithm Questions</a></p>
<p><a href="https://zheng-xing.github.io/2018/08/29/ML-DL-basic-knowledge/" target="_blank" rel="noopener">机器学习和深度学习基础知识</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/31/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/" itemprop="url">Python网络有关.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-31T21:03:52-07:00">
                2018-05-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/31/Python%E7%BD%91%E7%BB%9C%E6%9C%89%E5%85%B3-md/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/31/Python网络有关-md/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一些基础概念"><a href="#一些基础概念" class="headerlink" title="一些基础概念"></a>一些基础概念</h1><h2 id="网络分层"><a href="#网络分层" class="headerlink" title="网络分层"></a>网络分层</h2><p>todo</p>
<h2 id="单工，双工，半双工"><a href="#单工，双工，半双工" class="headerlink" title="单工，双工，半双工"></a>单工，双工，半双工</h2><h2 id="TCP-IP协议分层详解"><a href="#TCP-IP协议分层详解" class="headerlink" title="TCP/IP协议分层详解"></a>TCP/IP协议分层详解</h2><h2 id="tcp三次握手四次挥手"><a href="#tcp三次握手四次挥手" class="headerlink" title="tcp三次握手四次挥手"></a>tcp三次握手四次挥手</h2><p>TCP（Transmission Control Protocol，传输控制协议）是 面向连接的协议，也就是说在收发数据之前，必须先和对方建立连接，</p>
<p>一个TCP连接必须要经过三次“对话”才能建立起来，其中的过程非常复杂，只简单的 描述下这三次对话的简单过程：主机A向主机B发出连接请求数据包：“我想给你发数据，可以吗？”，这是第一次对话；主机B向主机A发送同意连接和要求同步 （同步就是两台主机一个在发送，一个在接收，协调工作）的数据包：“可以，你什么时候发？”，这是第二次对话；主机A再发出一个数据包确认主机B的要求同 步：“我现在就发，你接着吧！”，这是第三次对话。三次“对话”的目的是使数据包的发送和接收同步，经过三次“对话”之后，主机A才向主机B正式发送数 据。</p>
<p>需要了解的信息：</p>
<p>ACK ： TCP协议规定，只有ACK=1时有效，也规定连接建立后所有发送的报文的ACK必须为1</p>
<p>SYN(SYNchronization) ： 在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文。对方若同意建立连接，则应在响应报文中使SYN=1和ACK=1. 因此,  SYN置1就表示这是一个连接请求或连接接受报文。</p>
<p>FIN （finis）即完，终结的意思， 用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放连接。</p>
<h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p><img src="https://img-blog.csdn.net/20160413203916860?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>首先由Client发出请求连接即 SYN=1 ACK=0  (请看头字段的介绍), TCP规定SYN=1时不能携带数据，但要消耗一个序号,因此声明自己的序号是 seq=x</p>
<p>然后 Server 进行回复确认，即 SYN=1 ACK=1 seq=y, ack=x+1, 再然后 Client 再进行一次确认，但不用SYN 了，这时即为 ACK=1, seq=x+1, ack=y+1.</p>
<p>然后连接建立.</p>
<p>为什么要进行三次握手呢（两次确认）。</p>
<p>建立三次握手主要是因为A发送了再一次的确认，那么A为什么会再确认一次呢，主要是为了防止已失效的连接请求报文段又突然传送给B，从而产生了错误。所谓“已失效的连接请求报文”是这样产生的，正常情况下，A发出连接请求，但是因为连接报文请求丢失而未收到确认，于是A再重传一次连接请求，后来收到了请求，并收到了确认，建立了连接，数据传输完毕后，就释放链接，A共发送了两次连接请求报文段，其中第一个丢失，第二个到达了B，没有“已失效的连接请求报文段”，但是还有异常情况下，A发送的请求报文连接段并没有丢失，而是在某个网络节点滞留较长时间，以致延误到请求释放后的某个时间到达B，本来是一个早已失效的报文段，但是B收到了此失效连接请求报文段后，就误以为A又重新发送的连接请求报文段，并发送确认报文段给A，同意建立连接，如果没有三次握手，那么B发送确认后，连接就建立了，而此时A没有发送建立连接的请求报文段，于是不理会B的确认，也不会给B发送数据，而B却一直等待A发送数据，因此B的许多资源就浪费了，采用三次握手的方式就可以防止这种事情发生，例如刚刚，A不理会B，就不会给B发送确认，B收不到A的确认，就知道A不要求建立连接，就不会白白浪费资源，</p>
<h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><p><img src="https://img-blog.csdn.net/20160413205812456?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>当客户A 没有东西要发送时就要释放 A 这边的连接，A会发送一个报文（没有数据），其中 FIN 设置为1,  服务器B收到后会给应用程序一个信，这时A那边的连接已经关闭，即A不再发送信息（但仍可接收信息）。  A收到B的确认后进入等待状态，等待B请求释放连接， B数据发送完成后就向A请求连接释放，也是用FIN=1 表示， 并且用 ack = u+1(如图）， A收到后回复一个确认信息，并进入 TIME_WAIT 状态， 等待 2MSL 时间。</p>
<p><mark>为什么要等待呢</mark></p>
<p>为了这种情况： B向A发送 FIN = 1 的释放连接请求，但这个报文丢失了， A 没有接到不会发送确认信息，B 超时会重传，这时A在 WAIT_TIME 还能够接收到这个请求，这时再回复一个确认就行了。（A收到 FIN = 1 的请求后 WAIT_TIME会重新记时）</p>
<p>另外服务器B存在一个保活状态，即如果A突然故障死机了，那B那边的连接资源什么时候能释放呢？  就是保活时间到了后，B会发送探测信息， 以决定是否释放连接.</p>
<p><mark>为什么连接的时候是三次握手，关闭的时候却是四次握手</mark></p>
<p>答：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，”你发的FIN报文我收到了”。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。</p>
<h1 id="socket使用"><a href="#socket使用" class="headerlink" title="socket使用"></a>socket使用</h1><h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 收消息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发消息</span></span><br></pre></td></tr></table></figure>


<h2 id="一些应用场景"><a href="#一些应用场景" class="headerlink" title="一些应用场景"></a>一些应用场景</h2><h3 id="聊天室"><a href="#聊天室" class="headerlink" title="聊天室"></a>聊天室</h3><p>聊天室的要求就是一直监听，有消息就打印到当前窗口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">6789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        print(<span class="string">"[%s]: %s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>].decode(<span class="string">"utf-8"</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="echo-服务器"><a href="#echo-服务器" class="headerlink" title="echo 服务器"></a>echo 服务器</h3><p>echo 就是你发给它啥，它返回同样的东西给你。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">6789</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        udpSocket.sendto(recvInfo[<span class="number">0</span>], recvInfo[<span class="number">1</span>])</span><br><span class="line">        print(<span class="string">"[%s]: %s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>].decode(<span class="string">"utf-8"</span>)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h3 id="多线程聊天"><a href="#多线程聊天" class="headerlink" title="多线程聊天"></a>多线程聊天</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 收数据，然后打印</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recvData</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        recvInfo = udpSocket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        print(<span class="string">"\r&gt;&gt;[%s]:%s"</span> % (str(recvInfo[<span class="number">1</span>]), recvInfo[<span class="number">0</span>]))  <span class="comment"># \r 是从行开头打印，是为了覆盖掉本来的 &lt;&lt; 提示。</span></span><br><span class="line">        print(<span class="string">"\n&lt;&lt;"</span>)    <span class="comment"># 行开头本来有 &lt;&lt;，接收数据后会打印新的内容，导致看不到 &lt;&lt; 提示符了，因此另起一行补上。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测键盘，发数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendData</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        sendInfo = input(<span class="string">"&lt;&lt;"</span>)</span><br><span class="line">        udpSocket.sendto(sendInfo.encode(<span class="string">"gb2312"</span>), (destIp, destPort))</span><br><span class="line"></span><br><span class="line">udpSocket = <span class="literal">None</span></span><br><span class="line">destIp = <span class="string">""</span></span><br><span class="line">destPort = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">global</span> udpSocket</span><br><span class="line">    <span class="keyword">global</span> destIp</span><br><span class="line">    <span class="keyword">global</span> destPort</span><br><span class="line"></span><br><span class="line">    destIp = input(<span class="string">"Destination IP: "</span>)</span><br><span class="line">    destPort = input(<span class="string">"Destination port: "</span>)</span><br><span class="line"></span><br><span class="line">    udpSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">    udpSocket.bind(<span class="string">""</span>, <span class="number">4567</span>)</span><br><span class="line"></span><br><span class="line">    tr = Thread(target=recvData)</span><br><span class="line">    ts = Thread(target=sendData)</span><br><span class="line"></span><br><span class="line">    tr.start()</span><br><span class="line">    ts.start()</span><br><span class="line"></span><br><span class="line">    tr.join()</span><br><span class="line">    ts.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>main() 函数里面的变量也是 main 函数的局部变量，可不是全局变量！</li>
<li>udpSocket 要放在 main 函数外面作为全局变量，main 函数要声明 udpSocket 为 global，两个收发数据的函数因为没有改变 udpSocket，所以不需要声明为 global.</li>
<li></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/27/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/" itemprop="url">Python并行的方式.md</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-27T17:00:00-07:00">
                2018-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/27/Python%E5%B9%B6%E8%A1%8C%E7%9A%84%E6%96%B9%E5%BC%8F-md/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/05/27/Python并行的方式-md/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python 里面的并行分为线程并行和进程并行。</p>
<h1 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h1><h2 id="fork-创建多任务"><a href="#fork-创建多任务" class="headerlink" title="fork 创建多任务"></a>fork 创建多任务</h2><p>一个简单例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">p = os.fork()    <span class="comment"># 程序从这里会分裂成两个，继续执行</span></span><br><span class="line"><span class="keyword">if</span> p == <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># os.getpid  当前进程的 id</span></span><br><span class="line">    <span class="comment"># os.getppid 当前进程的父进程的 id</span></span><br><span class="line">    print(<span class="string">"This is child %d with father %d."</span> % (os.getpid(), os.getppid()))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">"This is father %d."</span> % os.getpid)</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>fork 后产生的父进程和子进程独立运行，父进程完成后可以结束，不需要等待子进程。</li>
<li>fork 只能在 unix/linux/mac 上运行，windows 不行。</li>
<li>如果有多个 fork，那么第一个 fork 处会分叉为两个程序继续运行，碰到第二个 fork 时候两个进程各自继续分叉运行。</li>
</ol>
<h2 id="多进程下的全局变量"><a href="#多进程下的全局变量" class="headerlink" title="多进程下的全局变量"></a>多进程下的全局变量</h2><ol>
<li>每个进程都有自己的全局变量<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">num = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">p = os.fork()</span><br><span class="line"><span class="keyword">if</span> p &gt; <span class="number">0</span>:</span><br><span class="line">    num = num + <span class="number">1</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    print(num)      <span class="comment"># 父进程在此处输出 6</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(num)      <span class="comment"># 子进程在此处输出 5</span></span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="跨平台-multiprocessing"><a href="#跨平台-multiprocessing" class="headerlink" title="跨平台 multiprocessing"></a>跨平台 multiprocessing</h2><p>Process initialization:<br>Process([group [, target [, name [, args [, kwargs]]]]])</p>
<ol>
<li>target: 进程实例所调用的目标</li>
<li>name: 进程实例的别名</li>
<li>group: 一般很少用</li>
</ol>
<p>Process 类常用方法：</p>
<ol>
<li>is_alive()： 判断进程实例是否还在运行</li>
<li>join([timeout]): 是否在此处等待子进程结束，或者等待 timeout 秒</li>
<li>start(): 子进程开始执行</li>
<li>run(): 当不给定 target 参数时候，会执行对象中的 run() 方法。</li>
<li>terminate(): 不管任务是否完成，立即终止。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">toy_func</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"This is child id %d with name %s"</span> % (os.getpid(), name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    p = Process(target = toy_func, args=(<span class="string">"toy"</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"Main function ends."</span>)</span><br></pre></td></tr></table></figure>
注意：</li>
<li>如果使用 .join() 那么父进程在 .join() 语句之后的内容会等待子进程结束以后才去执行。</li>
<li>使用 Process 多任务，无论是否有 .join(), 父进程执行完以后都会等待子进程结束才结束。</li>
</ol>
<h2 id="自定义Process子类"><a href="#自定义Process子类" class="headerlink" title="自定义Process子类"></a>自定义Process子类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">earthquake</span><span class="params">(Process)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, interval)</span>:</span></span><br><span class="line">        Process.__init__(self)</span><br><span class="line">        self.interval = interval</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Earthquake starts"</span>)</span><br><span class="line">        t1 = time.time()</span><br><span class="line">        time.sleep(self.interval)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        print(<span class="string">"Earthquake lasts %0.2f seconds."</span> % (t2-t1))</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    p1 = earthquake(<span class="number">100</span>)</span><br><span class="line">    p1.start()</span><br><span class="line">    p1.join()</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    print(<span class="string">"Main function lasts %0.2f seconds."</span> %(t2-t1))</span><br></pre></td></tr></table></figure>

<h2 id="进程池Pool"><a href="#进程池Pool" class="headerlink" title="进程池Pool"></a>进程池Pool</h2><p>当进程数量不多的时候，可以使用 Process 类来创建几个进程。<br>但是如果有几十上百个进程，那么可以使用Pool 来完成。<br>初始化 Pool 时候可以指定一个数量，即最大的进程数量。<br>当添加一个进程到 Pool 里面时候，如果 Pool 没有满，那么就加入。<br>如果满了，那么就会等待 Pool 里的某个进程结束后才会加入这个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(msg)</span>:</span></span><br><span class="line">    t1 = time.time()</span><br><span class="line">    print(<span class="string">"Job %s starts, with process ID: %d."</span> % (msg, os.getpid()))</span><br><span class="line">    time.sleep(random.random())</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    print(<span class="string">"Job %s ends, running time is %0.2f s."</span> % (msg, t2-t1))</span><br><span class="line"></span><br><span class="line">po = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    po.apply_async(worker, (i,))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"All begin..."</span>)</span><br><span class="line">po.close()    <span class="comment">#关闭进程池，关闭后 po 不再接受新的请求</span></span><br><span class="line">po.join()    <span class="comment">#等待 po 中所有子进程结束，这一句必须放在 .close() 之后。</span></span><br><span class="line">print(<span class="string">"All ends..."</span>)</span><br></pre></td></tr></table></figure>
<p>note:</p>
<ol>
<li>主进程一般用来等待，真正的任务在子进程中进行。</li>
<li>这里使用的 po.apply_async() 是说 5 个子进程可以同时执行。</li>
<li>也可以改成 po.apply() 来运行，但这个时候会等到前一个子进程结束后才会加入新的子进程。</li>
<li><mark>注意，如果不用 po.join(), 那么主进程结束后，进程池里的任务即使没执行完，也会被结束掉，导致不希望的结果。</mark></li>
</ol>
<h2 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h2><p>这里讲的异步主要是说，主进程建立了子进程，二者各自运行着。<br>子进程结束后会打断主进程，制定一个 function 让主进程先去执行，然后主进程该干嘛干嘛。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"This is a process in Pool with pid=%d, ppid=%d"</span> % (os.getpid(), os.getppid()))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        print(i)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Earthquake"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">(args)</span>:</span></span><br><span class="line">    print(<span class="string">"This is callback function with pid=%d"</span> % os.getpid())</span><br><span class="line">    print(<span class="string">"This function argument is: %s"</span> % args)</span><br><span class="line"></span><br><span class="line">pool = Pool(<span class="number">3</span>)</span><br><span class="line">pool.apply_async(func=test, callback=test2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"This is the main process with pid=%d"</span> % os.getpid())</span><br></pre></td></tr></table></figure>


<h2 id="进程间通信-Queue"><a href="#进程间通信-Queue" class="headerlink" title="进程间通信-Queue"></a>进程间通信-Queue</h2><p>由于进程之间没有变量共享，即全局变量都是每个进程里各自一份。<br>那么就需要特殊的数据结构来让进程之间通信。</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line">q = Queue(<span class="number">3</span>)    <span class="comment"># 新建一个 Queue, 可以保存 3 个内容。</span></span><br><span class="line"></span><br><span class="line">q.qsize()    <span class="comment"># 此处是0</span></span><br><span class="line">q.empty()    <span class="comment"># 返回 True</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy01"</span>)    <span class="comment"># 添加一个内容到 q</span></span><br><span class="line">q.put(<span class="string">"toy02"</span>)    <span class="comment"># 添加一个内容到 q</span></span><br><span class="line">q.qsize()    <span class="comment"># 输出 2</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy03"</span>)    <span class="comment"># 这个添加后 q 就满了</span></span><br><span class="line">q.full()    <span class="comment"># 输出 True</span></span><br><span class="line"></span><br><span class="line">q.put(<span class="string">"toy04"</span>)    <span class="comment"># 程序会卡在这里，需要等另一个进程从 q 中取出一个东西后，才会继续执行。</span></span><br><span class="line">                  <span class="comment"># 如果使用 q.put_nowait(), 会报错</span></span><br><span class="line"></span><br><span class="line">q.get()    <span class="comment"># 输出 "toy01"</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>如果使用进程池 Pool 来调用 Queue，就不能使用 multiprocessing.Queue。必须使用 multiprocessing.Manager().Queue()</li>
<li>eg. from multiprocessing import Manager; q = Manager.Queue()</li>
</ol>
<h1 id="线程与多任务"><a href="#线程与多任务" class="headerlink" title="线程与多任务"></a>线程与多任务</h1><p>python的 thread 是较底层的模块，threading 模块是稍微高层一点的模块。</p>
<h2 id="threading-Thread-多线程"><a href="#threading-Thread-多线程" class="headerlink" title="threading.Thread 多线程"></a>threading.Thread 多线程</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">earthquake</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"An earthquake!"</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    th = Thread(target=earthquake)</span><br><span class="line">    th.start()</span><br></pre></td></tr></table></figure>

<h2 id="Thread-子类"><a href="#Thread-子类" class="headerlink" title="Thread 子类"></a>Thread 子类</h2><h3 id="只有一个-Thread"><a href="#只有一个-Thread" class="headerlink" title="只有一个 Thread"></a>只有一个 Thread</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EqThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"Earthquake %s lasts %d seconds."</span> % (self.name, i))    <span class="comment"># self.name 保存当前线程的名字</span></span><br><span class="line"></span><br><span class="line">t = EqThread()</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># 会输出：Earthquake Thread-1 lasts 0/1/2 seconds.</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>僵尸进程：如果子进程死了，主进程还没有给它收尸，那么就称为僵尸进程。</li>
<li>孤儿进程：主进程先挂了，还在运行的子进程是孤儿进程。</li>
</ol>
<h3 id="多个-Thread-进程"><a href="#多个-Thread-进程" class="headerlink" title="多个 Thread 进程"></a>多个 Thread 进程</h3><p>5个线程各自独立运行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EqThread</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            print(<span class="string">"Earthquake %s lasts %d seconds."</span> % (self.name, i))    <span class="comment"># self.name 保存当前线程的名字</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    t = EqThread()</span><br><span class="line">    t.start()</span><br><span class="line"><span class="comment"># 会输出：Earthquake Thread-1 lasts 0/1/2 seconds.</span></span><br></pre></td></tr></table></figure>

<h2 id="多线程下的变量"><a href="#多线程下的变量" class="headerlink" title="多线程下的变量"></a>多线程下的变量</h2><ol>
<li><mark>全局变量</mark>对于多线程来说，是共享的！一个线程修改了全局变量，会在另外一个线程里面反映出来。</li>
<li>对于函数里面定义的<mark>局部变量</mark>，即使多个线程都是执行同一个函数，那么局部变量还是各自独有的。</li>
</ol>
<h3 id="八阿哥"><a href="#八阿哥" class="headerlink" title="八阿哥"></a>八阿哥</h3><p>几个线程同时操作一个全局变量，会出错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>

<h3 id="简单的解决方法：轮询"><a href="#简单的解决方法：轮询" class="headerlink" title="简单的解决方法：轮询"></a>简单的解决方法：轮询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">                num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>

<p>轮询可以解决，但是线程2的 While true 还是会占用CPU的。</p>
<h3 id="高级解决方法二：mutex互斥锁"><a href="#高级解决方法二：mutex互斥锁" class="headerlink" title="高级解决方法二：mutex互斥锁"></a>高级解决方法二：mutex互斥锁</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line"></span><br><span class="line">    l.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    l.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line"></span><br><span class="line">    l.acquire()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    l.release()</span><br><span class="line"></span><br><span class="line">l = Lock()</span><br><span class="line"></span><br><span class="line">th1 = Thread(target=func1)</span><br><span class="line">th1.start()</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">5</span>)    <span class="comment"># 如果删除这一句，那么最后的输出 num != 20000000</span></span><br><span class="line"></span><br><span class="line">th2 = Thread(target=func2)</span><br><span class="line">th2.start()</span><br><span class="line"></span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>此处把锁放到 for 循环外面，这两个线程实际上并没有并行，因为是一个线程执行完以后，另外一个线程才开始执行。</li>
<li>可以把锁放到 for 循环里面，只要包裹住 “num += 1” </li>
</ol>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>下面的代码有可能导致出现死锁。<br>即线程一在等待获得 mutexB, 线程二在等待获得 mutexA.<br>此时会卡住。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in thread 1</span></span><br><span class="line">mutexA.acquire()</span><br><span class="line">mutexB.acquire()</span><br><span class="line">mutexB.release()</span><br><span class="line">mutexA.release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># in thread 2</span></span><br><span class="line">mutexB.acquire()</span><br><span class="line">mutexA.acquire()</span><br><span class="line">mutexA.release()</span><br><span class="line">mutexB.release()</span><br></pre></td></tr></table></figure>

<p>解决方法就是在写代码的时候就考虑到这个问题，或者加上超时保护，或者采用银行家算法。</p>
<h2 id="多个线程同步，按顺序执行"><a href="#多个线程同步，按顺序执行" class="headerlink" title="多个线程同步，按顺序执行"></a>多个线程同步，按顺序执行</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task1</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock1.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock2.release()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task2</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock2.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock3.release()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task3</span><span class="params">(Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> lock3.acquire():</span><br><span class="line">                <span class="comment"># here do something</span></span><br><span class="line">                lock1.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lock1 = Lock()</span><br><span class="line"></span><br><span class="line">lock2 = Lock()</span><br><span class="line">lock2.acquire()</span><br><span class="line"></span><br><span class="line">lock3 = Lock()</span><br><span class="line">lock3.acquire()</span><br><span class="line"></span><br><span class="line">t1 = Task1()</span><br><span class="line">t2 = Task2()</span><br><span class="line">t3 = Task3()</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t3.start()</span><br></pre></td></tr></table></figure>

<h2 id="生产者-消费者-解耦"><a href="#生产者-消费者-解耦" class="headerlink" title="生产者-消费者-解耦"></a>生产者-消费者-解耦</h2><ol>
<li>为什么要使用生产者和消费者模式<ol>
<li>现实世界里，我们会碰到一个线程专门用来生产数据，另一个线程专门用来处理数据。这两者的速度不一定一致。如果一个跑的快，那么就需要不停地等待另一个执行完毕才会继续进行。为了解决这个问题才引入了生产者和消费者模式。</li>
</ol>
</li>
<li>什么事生产者和消费者模式<ol>
<li>这个模式说的就是利用 Queue 容器来解决生产者和消费者的强耦合问题。</li>
<li>生产者和消费者之间不直接进行通讯，而是生产者把产生的数据扔给阻塞队列，消费者从阻塞队列里取数据。</li>
<li>阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。</li>
<li>这个阻塞队列就是用来给二者解耦的。很多设计模式都会利用第三者来进行解耦。</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># python 2</span></span><br><span class="line">    <span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> queue</span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> queue.qsize() &lt; <span class="number">1000</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">                    count = count+<span class="number">1</span></span><br><span class="line">                    msg = <span class="string">"produced "</span> + str(count)</span><br><span class="line">                    queue.put(msg)</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> queue</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> queue.qsize() &gt; <span class="number">100</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">                    msg = self.name + <span class="string">" consumes "</span> + queue.get()</span><br><span class="line">                    print(msg)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    queue = Queue()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">500</span>):</span><br><span class="line">        queue.put(<span class="string">"Initial product "</span> + str(i))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">        p = Producer()</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        c = Consumer()</span><br><span class="line">        c.start()</span><br></pre></td></tr></table></figure>

<h2 id="线程里面多个函数使用变量的方法"><a href="#线程里面多个函数使用变量的方法" class="headerlink" title="线程里面多个函数使用变量的方法"></a>线程里面多个函数使用变量的方法</h2><p>多线程使用全局变量，若要修改必须加锁，不是很方便。<br>使用局部变量的话比较好，但是也有自己的问题。</p>
<h3 id="方法一：函数传参的方法"><a href="#方法一：函数传参的方法" class="headerlink" title="方法一：函数传参的方法"></a>方法一：函数传参的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">(name)</span>:</span></span><br><span class="line">    eq = Earthquake(name)</span><br><span class="line">    do_job_1(eq)</span><br><span class="line">    do_job_2(eq)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_1</span><span class="params">(eq)</span>:</span></span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_2</span><span class="params">(eq)</span>:</span></span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br></pre></td></tr></table></figure>


<h3 id="方法二：使用全局字典的方法"><a href="#方法二：使用全局字典的方法" class="headerlink" title="方法二：使用全局字典的方法"></a>方法二：使用全局字典的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">g_dict = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">(name)</span>:</span></span><br><span class="line">    eq = Earthquake(name)</span><br><span class="line">    g_dict[threading.current_thread()] = eq</span><br><span class="line">    do_job_1()</span><br><span class="line">    do_job_2()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 直接用当前线程作为 key 查找全局字典来获得 value，避免了使用函数形参</span></span><br><span class="line">    eq = g_dict[threading.current_thread()]</span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_job_2</span><span class="params">()</span>:</span></span><br><span class="line">    eq = g_dict[threading.current_thread()]</span><br><span class="line">    <span class="comment"># do some stuff here</span></span><br></pre></td></tr></table></figure>

<h3 id="方法三：ThreadLocal"><a href="#方法三：ThreadLocal" class="headerlink" title="方法三：ThreadLocal"></a>方法三：ThreadLocal</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建全局 ThreadLocal 对象</span></span><br><span class="line">local_cluster = threading.local()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processEarthquake</span><span class="params">()</span>:</span></span><br><span class="line">    eq = local_cluster.earthquake</span><br><span class="line">    <span class="comment"># do some stuff to eq</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_thread</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="comment"># 绑定 ThreadLocal 的 earthquake</span></span><br><span class="line">    local_cluster.earthquake = Earthquake(name)</span><br><span class="line">    processEarthquake()</span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=process_thread, args=(<span class="string">"Zheng"</span>,), name=<span class="string">"Thread-1"</span>)</span><br><span class="line">t2 = threading.Thread(target=process_thread, args=(<span class="string">"Xing"</span>,), name=<span class="string">"Thread-2"</span>)</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line">t1.join()</span><br><span class="line">t2.join()</span><br></pre></td></tr></table></figure>

<h2 id="GIL"><a href="#GIL" class="headerlink" title="GIL"></a>GIL</h2><p>关于 GIL(全局解释器锁)，其实只需要记住，在python 里面，是不存在线程并行的。<br>同一时刻，最多只有一个线程在运行。</p>
<h3 id="解决办法一：使用多进程"><a href="#解决办法一：使用多进程" class="headerlink" title="解决办法一：使用多进程"></a>解决办法一：使用多进程</h3><h3 id="解决办法二：关键部分用-C-来写"><a href="#解决办法二：关键部分用-C-来写" class="headerlink" title="解决办法二：关键部分用 C 来写"></a>解决办法二：关键部分用 C 来写</h3><p>Python 里面需要调用 ctypes 模块里面的功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载动态库，这个库里面只有一个函数: DeadLoop</span></span><br><span class="line">lib = cdll.LoadLibrary(<span class="string">"./libdeadloop.so"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个子线程，让其执行c语言所编写的函数，此函数是一个死循环</span></span><br><span class="line">t = Thread(target=lib.DeadLoop)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主线程，也调用c语言编写的那个死循环函数</span></span><br><span class="line"><span class="comment">#lib.DeadLoop()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>其中用到的 动态库对应的c语言如下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeadLoop</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note: 动态库有个好处就是不需要show源代码给别人就可以让别人用这个功能。</p>
<p>这个文件需要用如下语句来编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc source.c -shared -o libDeadLoop.so</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/26/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/26/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/" itemprop="url">程序员面试知识点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-26T23:52:34-07:00">
                2018-04-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">面试</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/26/%E7%A8%8B%E5%BA%8F%E5%91%98%E9%9D%A2%E8%AF%95%E7%9F%A5%E8%AF%86%E7%82%B9/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/26/程序员面试知识点/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ol>
<li>算法和数据结构<ol>
<li>至少知道两种n*log(n)的排序算法，比如快速排序和归并排序。merge sort 很重要，比如K-way merge sorts</li>
<li>Graph在内存中的三种构造方式(objects and pointers, matrix, and adjacency list)</li>
<li>掌握二分查找思想及应用场景，灵活处理类似问题，比如search in a sorted array查找、实现sqrt()等问题</li>
<li>大体了解一种平衡树，比如(red/black tree, splay tree or AVL tree) , 比如知道treemap的内部实现是red/black tree， 了解database index 所用的b+ tree/b tree.</li>
<li>Binary Search Tree的基本操作比如添加、删除节点，树与其他数据结构的相互转化, BST删除节点操作基本都会挂。</li>
<li>二叉树的各种遍历算法（前序、中序、后序、层序），根据遍历结果重建二叉树；</li>
<li>K-ary trees（一个树有k个children)/trie-tree的实现算法和应用场景；</li>
<li>结合Graph常考的算法比如拓扑排序，最短路径以及最小生成树算法</li>
<li>理解Min/Max heap的实现、各种操作时间复杂度和应用场景，熟练解决查找top(N)类型问题；</li>
<li>Hashtable: 透彻理解Hashtable的原理、性能、碰撞处理，并能用array (in your favorate language) 来实现一个简单的hashtable，考虑多线程的情况；对于java的hashmap 要了解java hashmap和hashtable区别，concurrenthashmap, linkedhashmap.</li>
</ol>
</li>
<li>操作系统<ol>
<li>理解操作系统中的进程、线程、以及它们之间的区别</li>
<li>理解系统并发操作中的常见问题（死锁），以及如何使用locks, mutexes, semaphores来解决并发问题。</li>
</ol>
</li>
<li>计算机网络<ol>
<li>tcp/ip三次握手</li>
<li>http/https区别</li>
<li>输入<a href="http://www.google.com" target="_blank" rel="noopener">http://www.google.com</a> 这个网址后会发生什么</li>
</ol>
</li>
<li>C++ 语言<ol>
<li>理解面向对象设计（封装、继承、多态），能把一个模糊定义的业务需求用OO的方式抽象（比如设计电梯、停车场等）；设计模式：Singleton（线程安全版本）、factory等；</li>
<li></li>
</ol>
</li>
<li>Python 语言</li>
<li>分布式系统，大数据处理<ol>
<li>理解分布式系统的基本概念，解决的问题以及分布式系统设计中CAP(Consistency, Availability, Partition)一致性、可用性、高性能之间的trade-offs</li>
<li>sql与nosql数据库区别，简单了解几种nosql数据库；mysql vs MongoDB vs redis</li>
</ol>
</li>
<li>杂<ol>
<li>了解你所面试的公司：产品，成立时间，融资，竞争对手</li>
</ol>
</li>
</ol>
<h1 id="展开"><a href="#展开" class="headerlink" title="展开"></a>展开</h1><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><h3 id="“What-happens-when-you-type-google-com-into-your-browser’s-address-box-and-press-enter-”"><a href="#“What-happens-when-you-type-google-com-into-your-browser’s-address-box-and-press-enter-”" class="headerlink" title="“What happens when you type google.com into your browser’s address box and press enter?”"></a>“What happens when you type google.com into your browser’s address box and press enter?”</h3><p>This is a partial article from <a href="https://github.com/alex/what-happens-when" target="_blank" rel="noopener">this one</a>.</p>
<h4 id="The-“g”-key-is-pressed"><a href="#The-“g”-key-is-pressed" class="headerlink" title="The “g” key is pressed"></a>The “g” key is pressed</h4><p>The following sections explains the physical keyboard actions and the OS<br>interrupts. When you press the key “g” the browser receives the event<br>and the auto-complete functions kick in. Depending on your browser’s<br>algorithm and if you are in private/incognito mode or not various<br>suggestions will be presented to you in the dropbox below the URL bar.<br>Most of these algorithms sort and prioritize results based on search<br>history, bookmarks, cookies, and popular searches from the internet as a<br>whole. As you are typing “google.com” many blocks of code run and the<br>suggestions will be refined with each key press. It may even suggest<br>“google.com” before you finish typing it.</p>
<h4 id="The-“enter”-key-bottoms-out"><a href="#The-“enter”-key-bottoms-out" class="headerlink" title="The “enter” key bottoms out"></a>The “enter” key bottoms out</h4><p>To pick a zero point, let’s choose the Enter key on the keyboard hitting<br>the bottom of its range. At this point, an electrical circuit specific<br>to the enter key is closed (either directly or capacitively). This<br>allows a small amount of current to flow into the logic circuitry of the<br>keyboard, which scans the state of each key switch, debounces the<br>electrical noise of the rapid intermittent closure of the switch, and<br>converts it to a keycode integer, in this case 13. The keyboard<br>controller then encodes the keycode for transport to the computer. This<br>is now almost universally over a Universal Serial Bus (USB) or Bluetooth<br>connection, but historically has been over PS/2 or ADB connections.</p>
<p><em>In the case of the USB keyboard:</em></p>
<ul>
<li>The USB circuitry of the keyboard is powered by the 5V supply<br>provided over pin 1 from the computer’s USB host controller.</li>
<li>The keycode generated is stored by internal keyboard circuitry<br>memory in a register called “endpoint”.</li>
<li>The host USB controller polls that “endpoint” every ~10ms (minimum<br>value declared by the keyboard), so it gets the keycode value stored<br>on it.</li>
<li>This value goes to the USB SIE (Serial Interface Engine) to be<br>converted in one or more USB packets that follows the low level<br>USB protocol.</li>
<li>Those packets are sent by a differential electrical signal over D+<br>and D-pins (the middle 2) at a maximum speed of 1.5 Mb/s, as an HID<br>(Human Interface Device) device is always declared to be a “low<br>speed device” (USB 2.0 compliance).</li>
<li>This serial signal is then decoded at the computer’s host USB<br>controller, and interpreted by the computer’s Human Interface<br>Device (HID) universal keyboard device driver. The value of the key<br>is then passed into the operating system’s hardware<br>abstraction layer.</li>
</ul>
<p><em>In the case of Virtual Keyboard (as in touch screen devices):</em></p>
<ul>
<li>When the user puts their finger on a modern capacitive touch screen,<br>a tiny amount of current gets transferred to the finger. This<br>completes the circuit through the electrostatic field of the<br>conductive layer and creates a voltage drop at that point on<br>the screen. The <code>screen controller</code> then raises an interrupt<br>reporting the coordinate of the key press.</li>
<li>Then the mobile OS notifies the current focused application of a<br>press event in one of its GUI elements (which now is the virtual<br>keyboard application buttons).</li>
<li>The virtual keyboard can now raise a software interrupt for sending<br>a ‘key pressed’ message back to the OS.</li>
<li>This interrupt notifies the current focused application of a ‘key<br>pressed’ event.</li>
</ul>
<h4 id="Interrupt-fires-NOT-for-USB-keyboards"><a href="#Interrupt-fires-NOT-for-USB-keyboards" class="headerlink" title="Interrupt fires [NOT for USB keyboards]"></a>Interrupt fires [NOT for USB keyboards]</h4><p>The keyboard sends signals on its interrupt request line (IRQ), which is<br>mapped to an <code>interrupt vector</code> (integer) by the interrupt controller.<br>The CPU uses the <code>Interrupt Descriptor Table</code> (IDT) to map the interrupt<br>vectors to functions (<code>interrupt handlers</code>) which are supplied by the<br>kernel. When an interrupt arrives, the CPU indexes the IDT with the<br>interrupt vector and runs the appropriate handler. Thus, the kernel is<br>entered.</p>
<h4 id="Parse-URL"><a href="#Parse-URL" class="headerlink" title="Parse URL"></a>Parse URL</h4><ul>
<li><p>The browser now has the following information contained in the URL<br>(Uniform Resource Locator):</p>
<blockquote>
<p>-</p>
<pre><code>`Protocol` &quot;http&quot;

:   Use &apos;Hyper Text Transfer Protocol&apos;</code></pre><p>-</p>
<pre><code>`Resource` &quot;/&quot;

:   Retrieve main (index) page</code></pre></blockquote>
</li>
</ul>
<h4 id="Is-it-a-URL-or-a-search-term"><a href="#Is-it-a-URL-or-a-search-term" class="headerlink" title="Is it a URL or a search term?"></a>Is it a URL or a search term?</h4><p>When no protocol or valid domain name is given the browser proceeds to<br>feed the text given in the address box to the browser’s default web<br>search engine. In many cases the URL has a special piece of text<br>appended to it to tell the search engine that it came from a particular<br>browser’s URL bar.</p>
<h4 id="Convert-non-ASCII-Unicode-characters-in-hostname"><a href="#Convert-non-ASCII-Unicode-characters-in-hostname" class="headerlink" title="Convert non-ASCII Unicode characters in hostname"></a>Convert non-ASCII Unicode characters in hostname</h4><ul>
<li>The browser checks the hostname for characters that are not in<br><code>a-z</code>, <code>A-Z</code>, <code>0-9</code>, <code>-</code>, or <code>.</code>.</li>
<li>Since the hostname is <code>google.com</code> there won’t be any, but if there<br>were the browser would apply<br><a href="https://en.wikipedia.org/wiki/Punycode" target="_blank" rel="noopener">Punycode</a> encoding to the<br>hostname portion of the URL.</li>
</ul>
<h4 id="Check-HSTS-list"><a href="#Check-HSTS-list" class="headerlink" title="Check HSTS list"></a>Check HSTS list</h4><ul>
<li>The browser checks its “preloaded HSTS (HTTP Strict Transport<br>Security)” list. This is a list of websites that have requested to<br>be contacted via HTTPS only.</li>
<li>If the website is in the list, the browser sends its request via<br>HTTPS instead of HTTP. Otherwise, the initial request is sent via<br>HTTP. (Note that a website can still use the HSTS policy <em>without</em><br>being in the HSTS list. The first HTTP request to the website by a<br>user will receive a response requesting that the user only send<br>HTTPS requests. However, this single HTTP request could potentially<br>leave the user vulnerable to a downgrade attack_, which is why the<br>HSTS list is included in modern web browsers.)</li>
</ul>
<h4 id="DNS-lookup"><a href="#DNS-lookup" class="headerlink" title="DNS lookup"></a>DNS lookup</h4><ul>
<li>Browser checks if the domain is in its cache. (to see the DNS Cache<br>in Chrome, go to<br><a href="chrome://net-internals/#dns"><a href="chrome://net-internals/#dns">chrome://net-internals/#dns</a></a>).</li>
<li>If not found, the browser calls <code>gethostbyname</code> library function<br>(varies by OS) to do the lookup.</li>
<li><code>gethostbyname</code> checks if the hostname can be resolved by reference<br>in the local <code>hosts</code> file (whose location varies by OS_) before<br>trying to resolve the hostname through DNS.</li>
<li>If <code>gethostbyname</code> does not have it cached nor can find it in the<br><code>hosts</code> file then it makes a request to the DNS server configured in<br>the network stack. This is typically the local router or the ISP’s<br>caching DNS server.</li>
<li>If the DNS server is on the same subnet the network library follows<br>the <code>ARP process</code> below for the DNS server.</li>
<li>If the DNS server is on a different subnet, the network library<br>follows the <code>ARP process</code> below for the default gateway IP.</li>
</ul>
<h4 id="ARP-process"><a href="#ARP-process" class="headerlink" title="ARP process"></a>ARP process</h4><p>In order to send an ARP (Address Resolution Protocol) broadcast the<br>network stack library needs the target IP address to look up. It also<br>needs to know the MAC address of the interface it will use to send out<br>the ARP broadcast.</p>
<p>The ARP cache is first checked for an ARP entry for our target IP. If it<br>is in the cache, the library function returns the result: Target IP =<br>MAC.</p>
<p>If the entry is not in the ARP cache:</p>
<ul>
<li>The route table is looked up, to see if the Target IP address is on<br>any of the subnets on the local route table. If it is, the library<br>uses the interface associated with that subnet. If it is not, the<br>library uses the interface that has the subnet of our<br>default gateway.</li>
<li>The MAC address of the selected network interface is looked up.</li>
<li>The network library sends a Layer 2 (data link layer of the<br>OSI model_) ARP request:</li>
</ul>
<p><code>ARP Request</code>:</p>
<pre><code>Sender MAC: interface:mac:address:here
Sender IP: interface.ip.goes.here
Target MAC: FF:FF:FF:FF:FF:FF (Broadcast)
Target IP: target.ip.goes.here</code></pre><p>Depending on what type of hardware is between the computer and the<br>router:</p>
<p>Directly connected:</p>
<ul>
<li>If the computer is directly connected to the router the router<br>responds with an <code>ARP Reply</code> (see below)</li>
</ul>
<p>Hub:</p>
<ul>
<li>If the computer is connected to a hub, the hub will broadcast the<br>ARP request out all other ports. If the router is connected on the<br>same “wire”, it will respond with an <code>ARP Reply</code> (see below).</li>
</ul>
<p>Switch:</p>
<ul>
<li>If the computer is connected to a switch, the switch will check its<br>local CAM/MAC table to see which port has the MAC address we are<br>looking for. If the switch has no entry for the MAC address it will<br>rebroadcast the ARP request to all other ports.</li>
<li>If the switch has an entry in the MAC/CAM table it will send the ARP<br>request to the port that has the MAC address we are looking for.</li>
<li>If the router is on the same “wire”, it will respond with an<br><code>ARP Reply</code> (see below)</li>
</ul>
<p><code>ARP Reply</code>:</p>
<pre><code>Sender MAC: target:mac:address:here
Sender IP: target.ip.goes.here
Target MAC: interface:mac:address:here
Target IP: interface.ip.goes.here</code></pre><p>Now that the network library has the IP address of either our DNS server<br>or the default gateway it can resume its DNS process:</p>
<ul>
<li>Port 53 is opened to send a UDP request to DNS server (if the<br>response size is too large, TCP will be used instead).</li>
<li>If the local/ISP DNS server does not have it, then a recursive<br>search is requested and that flows up the list of DNS servers until<br>the SOA is reached, and if found an answer is returned.</li>
</ul>
<h4 id="Opening-of-a-socket"><a href="#Opening-of-a-socket" class="headerlink" title="Opening of a socket"></a>Opening of a socket</h4><p>Once the browser receives the IP address of the destination server, it<br>takes that and the given port number from the URL (the HTTP protocol<br>defaults to port 80, and HTTPS to port 443), and makes a call to the<br>system library function named <code>socket</code> and requests a TCP socket stream</p>
<ul>
<li><p><code>AF_INET/AF_INET6</code> and <code>SOCK_STREAM</code>.</p>
</li>
<li><p>This request is first passed to the Transport Layer where a TCP<br>segment is crafted. The destination port is added to the header, and<br>a source port is chosen from within the kernel’s dynamic port range<br>(ip_local_port_range in Linux).</p>
</li>
<li><p>This segment is sent to the Network Layer, which wraps an additional<br>IP header. The IP address of the destination server as well as that<br>of the current machine is inserted to form a packet.</p>
</li>
<li><p>The packet next arrives at the Link Layer. A frame header is added<br>that includes the MAC address of the machine’s NIC as well as the<br>MAC address of the gateway (local router). As before, if the kernel<br>does not know the MAC address of the gateway, it must broadcast an<br>ARP query to find it.</p>
</li>
</ul>
<p>At this point the packet is ready to be transmitted through either:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/IEEE_802.3" target="_blank" rel="noopener">Ethernet</a></li>
<li><a href="https://en.wikipedia.org/wiki/IEEE_802.11" target="_blank" rel="noopener">WiFi</a></li>
<li><a href="https://en.wikipedia.org/wiki/Cellular_data_communication_protocol" target="_blank" rel="noopener">Cellular data<br>network</a></li>
</ul>
<p>For most home or small business Internet connections the packet will<br>pass from your computer, possibly through a local network, and then<br>through a modem (MOdulator/DEModulator) which converts digital 1’s and<br>0’s into an analog signal suitable for transmission over telephone,<br>cable, or wireless telephony connections. On the other end of the<br>connection is another modem which converts the analog signal back into<br>digital data to be processed by the next <a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">network<br>node</a><br>where the from and to addresses would be analyzed further.</p>
<p>Most larger businesses and some newer residential connections will have<br>fiber or direct Ethernet connections in which case the data remains<br>digital and is passed directly to the next <a href="https://en.wikipedia.org/wiki/Computer_network#Network_nodes" target="_blank" rel="noopener">network<br>node</a> for<br>processing.</p>
<p>Eventually, the packet will reach the router managing the local subnet.<br>From there, it will continue to travel to the autonomous system’s (AS)<br>border routers, other ASes, and finally to the destination server. Each<br>router along the way extracts the destination address from the IP header<br>and routes it to the appropriate next hop. The time to live (TTL) field<br>in the IP header is decremented by one for each router that passes. The<br>packet will be dropped if the TTL field reaches zero or if the current<br>router has no space in its queue (perhaps due to network congestion).</p>
<p>This send and receive happens multiple times following the TCP<br>connection flow:</p>
<ul>
<li><p>Client chooses an initial sequence number (ISN) and sends the packet<br>to the server with the SYN bit set to indicate it is setting the ISN</p>
</li>
<li><p>   Server receives SYN and if it’s in an agreeable mood:</p>
<p>   :   -   Server chooses its own initial sequence number</p>
<pre><code>-   Server sets SYN to indicate it is choosing its ISN
-   Server copies the (client ISN +1) to its ACK field and adds
    the ACK flag to indicate it is acknowledging receipt of the
    first packet</code></pre></li>
</ul>
<p>-</p>
<pre><code>Client acknowledges the connection by sending a packet:

:   -   Increases its own sequence number
    -   Increases the receiver acknowledgment number
    -   Sets ACK field</code></pre><p>-</p>
<pre><code>Data is transferred as follows:

:   -   As one side sends N data bytes, it increases its SEQ by that
        number
    -   When the other side acknowledges receipt of that packet (or
        a string of packets), it sends an ACK packet with the ACK
        value equal to the last received sequence from the other</code></pre><p>-</p>
<pre><code>To close the connection:

:   -   The closer sends a FIN packet
    -   The other sides ACKs the FIN packet and sends its own FIN
    -   The closer acknowledges the other side&apos;s FIN with an ACK</code></pre><h4 id="TLS-handshake"><a href="#TLS-handshake" class="headerlink" title="TLS handshake"></a>TLS handshake</h4><ul>
<li>The client computer sends a <code>ClientHello</code> message to the server with<br>its Transport Layer Security (TLS) version, list of cipher<br>algorithms and compression methods available.</li>
<li>The server replies with a <code>ServerHello</code> message to the client with<br>the TLS version, selected cipher, selected compression methods and<br>the server’s public certificate signed by a CA<br>(Certificate Authority). The certificate contains a public key that<br>will be used by the client to encrypt the rest of the handshake<br>until a symmetric key can be agreed upon.</li>
<li>The client verifies the server digital certificate against its list<br>of trusted CAs. If trust can be established based on the CA, the<br>client generates a string of pseudo-random bytes and encrypts this<br>with the server’s public key. These random bytes can be used to<br>determine the symmetric key.</li>
<li>The server decrypts the random bytes using its private key and uses<br>these bytes to generate its own copy of the symmetric master key.</li>
<li>The client sends a <code>Finished</code> message to the server, encrypting a<br>hash of the transmission up to this point with the symmetric key.</li>
<li>The server generates its own hash, and then decrypts the client-sent<br>hash to verify that it matches. If it does, it sends its own<br><code>Finished</code> message to the client, also encrypted with the<br>symmetric key.</li>
<li>From now on the TLS session transmits the application (HTTP) data<br>encrypted with the agreed symmetric key.</li>
</ul>
<h4 id="HTTP-protocol"><a href="#HTTP-protocol" class="headerlink" title="HTTP protocol"></a>HTTP protocol</h4><p>If the web browser used was written by Google, instead of sending an<br>HTTP request to retrieve the page, it will send a request to try and<br>negotiate with the server an “upgrade” from HTTP to the SPDY protocol.</p>
<p>If the client is using the HTTP protocol and does not support SPDY, it<br>sends a request to the server of the form:</p>
<pre><code>GET / HTTP/1.1
Host: google.com
Connection: close
[other headers]</code></pre><p>where <code>[other headers]</code> refers to a series of colon-separated key-value<br>pairs formatted as per the HTTP specification and separated by single<br>new lines. (This assumes the web browser being used doesn’t have any<br>bugs violating the HTTP spec. This also assumes that the web browser is<br>using <code>HTTP/1.1</code>, otherwise it may not include the <code>Host</code> header in the<br>request and the version specified in the <code>GET</code> request will either be<br><code>HTTP/1.0</code> or <code>HTTP/0.9</code>.)</p>
<p>HTTP/1.1 defines the “close” connection option for the sender to signal<br>that the connection will be closed after completion of the response. For<br>example,</p>
<blockquote>
<p>Connection: close</p>
</blockquote>
<p>HTTP/1.1 applications that do not support persistent connections MUST<br>include the “close” connection option in every message.</p>
<p>After sending the request and headers, the web browser sends a single<br>blank newline to the server indicating that the content of the request<br>is done.</p>
<p>The server responds with a response code denoting the status of the<br>request and responds with a response of the form:</p>
<pre><code>200 OK
[response headers]</code></pre><p>Followed by a single newline, and then sends a payload of the HTML<br>content of <code>www.google.com</code>. The server may then either close the<br>connection, or if headers sent by the client requested it, keep the<br>connection open to be reused for further requests.</p>
<p>If the HTTP headers sent by the web browser included sufficient<br>information for the web server to determine if the version of the file<br>cached by the web browser has been unmodified since the last retrieval<br>(ie. if the web browser included an <code>ETag</code> header), it may instead<br>respond with a request of the form:</p>
<pre><code>304 Not Modified
[response headers]</code></pre><p>and no payload, and the web browser instead retrieves the HTML from its<br>cache.</p>
<p>After parsing the HTML, the web browser (and server) repeats this<br>process for every resource (image, CSS, favicon.ico, etc) referenced by<br>the HTML page, except instead of <code>GET / HTTP/1.1</code> the request will be<br><code>GET /$(URL relative to www.google.com) HTTP/1.1</code>.</p>
<p>If the HTML referenced a resource on a different domain than<br><code>www.google.com</code>, the web browser goes back to the steps involved in<br>resolving the other domain, and follows all steps up to this point for<br>that domain. The <code>Host</code> header in the request will be set to the<br>appropriate server name instead of <code>google.com</code>.</p>
<h4 id="HTTP-Server-Request-Handle"><a href="#HTTP-Server-Request-Handle" class="headerlink" title="HTTP Server Request Handle"></a>HTTP Server Request Handle</h4><p>The HTTPD (HTTP Daemon) server is the one handling the<br>requests/responses on the server side. The most common HTTPD servers are<br>Apache or nginx for Linux and IIS for Windows.</p>
<ul>
<li><p>The HTTPD (HTTP Daemon) receives the request.</p>
</li>
<li><p>   The server breaks down the request to the following parameters:</p>
<p>   :   -   HTTP Request Method (either <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>,</p>
<pre><code>    `DELETE`, `CONNECT`, `OPTIONS`, or `TRACE`). In the case of
    a URL entered directly into the address bar, this will be
    `GET`.
-   Domain, in this case - google.com.
-   Requested path/page, in this case - / (as no specific
    path/page was requested, / is the default path).</code></pre></li>
<li><p>The server verifies that there is a Virtual Host configured on the<br>server that corresponds with google.com.</p>
</li>
<li><p>The server verifies that google.com can accept GET requests.</p>
</li>
<li><p>The server verifies that the client is allowed to use this method<br>(by IP, authentication, etc.).</p>
</li>
<li><p>If the server has a rewrite module installed (like mod_rewrite for<br>Apache or URL Rewrite for IIS), it tries to match the request<br>against one of the configured rules. If a matching rule is found,<br>the server uses that rule to rewrite the request.</p>
</li>
<li><p>The server goes to pull the content that corresponds with the<br>request, in our case it will fall back to the index file, as “/“ is<br>the main file (some cases can override this, but this is the most<br>common method).</p>
</li>
<li><p>The server parses the file according to the handler. If Google is<br>running on PHP, the server uses PHP to interpret the index file, and<br>streams the output to the client.</p>
</li>
</ul>
<h4 id="Behind-the-scenes-of-the-Browser"><a href="#Behind-the-scenes-of-the-Browser" class="headerlink" title="Behind the scenes of the Browser"></a>Behind the scenes of the Browser</h4><p>Once the server supplies the resources (HTML, CSS, JS, images, etc.) to<br>the browser it undergoes the below process:</p>
<ul>
<li>Parsing - HTML, CSS, JS</li>
<li>Rendering - Construct DOM Tree → Render Tree → Layout of Render Tree<br>→ Painting the render tree</li>
</ul>
<h4 id="Browser"><a href="#Browser" class="headerlink" title="Browser"></a>Browser</h4><p>The browser’s functionality is to present the web resource you choose,<br>by requesting it from the server and displaying it in the browser<br>window. The resource is usually an HTML document, but may also be a PDF,<br>image, or some other type of content. The location of the resource is<br>specified by the user using a URI (Uniform Resource Identifier).</p>
<p>The way the browser interprets and displays HTML files is specified in<br>the HTML and CSS specifications. These specifications are maintained by<br>the W3C (World Wide Web Consortium) organization, which is the standards<br>organization for the web.</p>
<p>Browser user interfaces have a lot in common with each other. Among the<br>common user interface elements are:</p>
<ul>
<li>An address bar for inserting a URI</li>
<li>Back and forward buttons</li>
<li>Bookmarking options</li>
<li>Refresh and stop buttons for refreshing or stopping the loading of<br>current documents</li>
<li>Home button that takes you to your home page</li>
</ul>
<p><strong>Browser High Level Structure</strong></p>
<p>The components of the browsers are:</p>
<ul>
<li><strong>User interface:</strong> The user interface includes the address bar,<br>back/forward button, bookmarking menu, etc. Every part of the<br>browser display except the window where you see the requested page.</li>
<li><strong>Browser engine:</strong> The browser engine marshals actions between the<br>UI and the rendering engine.</li>
<li><strong>Rendering engine:</strong> The rendering engine is responsible for<br>displaying requested content. For example if the requested content<br>is HTML, the rendering engine parses HTML and CSS, and displays the<br>parsed content on the screen.</li>
<li><strong>Networking:</strong> The networking handles network calls such as HTTP<br>requests, using different implementations for different platforms<br>behind a platform-independent interface.</li>
<li><strong>UI backend:</strong> The UI backend is used for drawing basic widgets<br>like combo boxes and windows. This backend exposes a generic<br>interface that is not platform specific. Underneath it uses<br>operating system user interface methods.</li>
<li><strong>JavaScript engine:</strong> The JavaScript engine is used to parse and<br>execute JavaScript code.</li>
<li><strong>Data storage:</strong> The data storage is a persistence layer. The<br>browser may need to save all sorts of data locally, such as cookies.<br>Browsers also support storage mechanisms such as localStorage,<br>IndexedDB, WebSQL and FileSystem.</li>
</ul>
<h4 id="HTML-parsing"><a href="#HTML-parsing" class="headerlink" title="HTML parsing"></a>HTML parsing</h4><p>The rendering engine starts getting the contents of the requested<br>document from the networking layer. This will usually be done in 8kB<br>chunks.</p>
<p>The primary job of HTML parser to parse the HTML markup into a parse<br>tree.</p>
<p>The output tree (the “parse tree”) is a tree of DOM element and<br>attribute nodes. DOM is short for Document Object Model. It is the<br>object presentation of the HTML document and the interface of HTML<br>elements to the outside world like JavaScript. The root of the tree is<br>the “Document” object. Prior of any manipulation via scripting, the DOM<br>has an almost one-to-one relation to the markup.</p>
<p><strong>The parsing algorithm</strong></p>
<p>HTML cannot be parsed using the regular top-down or bottom-up parsers.</p>
<p>The reasons are:</p>
<ul>
<li>The forgiving nature of the language.</li>
<li>The fact that browsers have traditional error tolerance to support<br>well known cases of invalid HTML.</li>
<li>The parsing process is reentrant. For other languages, the source<br>doesn’t change during parsing, but in HTML, dynamic code (such as<br>script elements containing document.write() calls) can add extra<br>tokens, so the parsing process actually modifies the input.</li>
</ul>
<p>Unable to use the regular parsing techniques, the browser utilizes a<br>custom parser for parsing HTML. The parsing algorithm is described in<br>detail by the HTML5 specification.</p>
<p>The algorithm consists of two stages: tokenization and tree<br>construction.</p>
<p><strong>Actions when the parsing is finished</strong></p>
<p>The browser begins fetching external resources linked to the page (CSS,<br>images, JavaScript files, etc.).</p>
<p>At this stage the browser marks the document as interactive and starts<br>parsing scripts that are in “deferred” mode: those that should be<br>executed after the document is parsed. The document state is set to<br>“complete” and a “load” event is fired.</p>
<p>Note there is never an “Invalid Syntax” error on an HTML page. Browsers<br>fix any invalid content and go on.</p>
<h4 id="CSS-interpretation"><a href="#CSS-interpretation" class="headerlink" title="CSS interpretation"></a>CSS interpretation</h4><ul>
<li>Parse CSS files, <code>&lt;style&gt;</code> tag contents, and <code>style</code> attribute<br>values using <a href="http://www.w3.org/TR/CSS2/grammar.html" target="_blank" rel="noopener">“CSS lexical and syntax<br>grammar”</a></li>
<li>Each CSS file is parsed into a <code>StyleSheet object</code>, where each<br>object contains CSS rules with selectors and objects corresponding<br>CSS grammar.</li>
<li>A CSS parser can be top-down or bottom-up when a specific parser<br>generator is used.</li>
</ul>
<h4 id="Page-Rendering"><a href="#Page-Rendering" class="headerlink" title="Page Rendering"></a>Page Rendering</h4><ul>
<li>Create a ‘Frame Tree’ or ‘Render Tree’ by traversing the DOM nodes,<br>and calculating the CSS style values for each node.</li>
<li>Calculate the preferred width of each node in the ‘Frame Tree’<br>bottom up by summing the preferred width of the child nodes and the<br>node’s horizontal margins, borders, and padding.</li>
<li>Calculate the actual width of each node top-down by allocating each<br>node’s available width to its children.</li>
<li>Calculate the height of each node bottom-up by applying text<br>wrapping and summing the child node heights and the node’s margins,<br>borders, and padding.</li>
<li>Calculate the coordinates of each node using the information<br>calculated above.</li>
<li>More complicated steps are taken when elements are <code>floated</code>,<br>positioned <code>absolutely</code> or <code>relatively</code>, or other complex features<br>are used. See <a href="http://dev.w3.org/csswg/css2/" target="_blank" rel="noopener">http://dev.w3.org/csswg/css2/</a> and<br><a href="http://www.w3.org/Style/CSS/current-work" target="_blank" rel="noopener">http://www.w3.org/Style/CSS/current-work</a> for more details.</li>
<li>Create layers to describe which parts of the page can be animated as<br>a group without being re-rasterized. Each frame/render object is<br>assigned to a layer.</li>
<li>Textures are allocated for each layer of the page.</li>
<li>The frame/render objects for each layer are traversed and drawing<br>commands are executed for their respective layer. This may be<br>rasterized by the CPU or drawn on the GPU directly using D2D/SkiaGL.</li>
<li>All of the above steps may reuse calculated values from the last<br>time the webpage was rendered, so that incremental changes require<br>less work.</li>
<li>The page layers are sent to the compositing process where they are<br>combined with layers for other visible content like the browser<br>chrome, iframes and addon panels.</li>
<li>Final layer positions are computed and the composite commands are<br>issued via Direct3D/OpenGL. The GPU command buffer(s) are flushed to<br>the GPU for asynchronous rendering and the frame is sent to the<br>window server.</li>
</ul>
<h4 id="GPU-Rendering"><a href="#GPU-Rendering" class="headerlink" title="GPU Rendering"></a>GPU Rendering</h4><ul>
<li>During the rendering process the graphical computing layers can use<br>general purpose <code>CPU</code> or the graphical processor <code>GPU</code> as well.</li>
<li>When using <code>GPU</code> for graphical rendering computations the graphical<br>software layers split the task into multiple pieces, so it can take<br>advantage of <code>GPU</code> massive parallelism for float point calculations<br>required for the rendering process.</li>
</ul>
<h4 id="Window-Server"><a href="#Window-Server" class="headerlink" title="Window Server"></a>Window Server</h4><h4 id="Post-rendering-and-user-induced-execution"><a href="#Post-rendering-and-user-induced-execution" class="headerlink" title="Post-rendering and user-induced execution"></a>Post-rendering and user-induced execution</h4><p>After rendering has completed, the browser executes JavaScript code as a<br>result of some timing mechanism (such as a Google Doodle animation) or<br>user interaction (typing a query into the search box and receiving<br>suggestions). Plugins such as Flash or Java may execute as well,<br>although not at this time on the Google homepage. Scripts can cause<br>additional network requests to be performed, as well as modify the page<br>or its layout, causing another round of page rendering and painting.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/25/San-Diego-%E7%BE%8E%E9%A3%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/25/San-Diego-%E7%BE%8E%E9%A3%9F/" itemprop="url">San Diego 美食</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-25T00:38:31-07:00">
                2018-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/misc/" itemprop="url" rel="index">
                    <span itemprop="name">misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/25/San-Diego-%E7%BE%8E%E9%A3%9F/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/25/San-Diego-美食/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="中餐"><a href="#中餐" class="headerlink" title="中餐"></a>中餐</h1><h2 id="川菜"><a href="#川菜" class="headerlink" title="川菜"></a>川菜</h2><h3 id="过桥缘"><a href="#过桥缘" class="headerlink" title="过桥缘"></a>过桥缘</h3><p>地址：4690 Convoy St #107, SD, CA 92111</p>
<p>经典菜：</p>
<ol>
<li>凉菜推荐</li>
<li>一个凉菜，口水鸡？里面有很浓郁的芝麻酱味道，很赞</li>
<li>梅菜扣肉是辣的，很独特</li>
</ol>
<h2 id="湘菜"><a href="#湘菜" class="headerlink" title="湘菜"></a>湘菜</h2><h1 id="西餐"><a href="#西餐" class="headerlink" title="西餐"></a>西餐</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/05/%E5%8D%8A%E5%AF%BC%E4%BD%93%E4%BA%A7%E4%B8%9A%E4%B8%80%E8%A7%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/05/%E5%8D%8A%E5%AF%BC%E4%BD%93%E4%BA%A7%E4%B8%9A%E4%B8%80%E8%A7%88/" itemprop="url">半导体产业一览</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-05T23:26:10-07:00">
                2018-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8D%8A%E5%AF%BC%E4%BD%93/" itemprop="url" rel="index">
                    <span itemprop="name">半导体</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/04/05/%E5%8D%8A%E5%AF%BC%E4%BD%93%E4%BA%A7%E4%B8%9A%E4%B8%80%E8%A7%88/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/04/05/半导体产业一览/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是半导体"><a href="#什么是半导体" class="headerlink" title="什么是半导体"></a>什么是半导体</h1><p><a href="https://xuangubao.cn/theme/4" target="_blank" rel="noopener">本节内容来自这里</a><br>1.半导体可以分为四类产品，分别是集成电路、光电子器件、分立器件和传感器。其中规模最大的是集成电路，达到2753亿美元，占半导体市场的81%。由于半导体产品中大部分是集成电路。</p>
<p>2.半导体是一类材料的总称，集成电路是用半导体材料制成的电路的大型集合，芯片是由不同种类型的集成电路或者单一类型集成电路形成的产品。对应成大家好理解的日常用品，半导体各种做纸的纤维，集成电路是一沓子纸，芯片是书或者本子。</p>
<p>3.集成电路（integratedcircuit）是一种微型电子器件或部件。采用一定的工艺，把一个电路中所需的晶体管、电阻、电容和电感等元件及布线互连一起，制作在一小块或几小块半导体晶片或介质基片上，然后封装在一个管壳内，成为具有所需电路功能的微型结构；其中所有元件在结构上已组成一个整体，使电子元件向着微小型化、低功耗、智能化和高可靠性方面迈进了一大步。它在电路中用字母“IC”表示。</p>
<p>4.芯片（chip）、或称微电路（microcircuit）、微芯片（microchip）在电子学中是一种把电路（主要包括半导体设备，也包括被动组件等）小型化的方式，并通常制造在半导体晶圆表面上。</p>
<p><img src="https://baoimage.wallstreetcn.com/Fkbeo6YlvLCV1rue2d7yoBpNSqHw?watermark/1/image/aHR0cHM6Ly9iYW9pbWFnZS53YWxsc3RyZWV0Y24uY29tL3dt/dissolve/80/gravity/Center" alt="haha"></p>
<h1 id="半导体的生产流程"><a href="#半导体的生产流程" class="headerlink" title="半导体的生产流程"></a>半导体的生产流程</h1><p>分为上游，中游和下游</p>
<ol>
<li>上游 - 芯片设计</li>
<li>中游 - 芯片制造</li>
<li>下游 - 封装测试</li>
</ol>
<p><img src="http://chinabaogao.com/resource/images/201803/20180330110753zui1_m.png" alt="haha"><br>上图来自这里: <a href="http://free.chinabaogao.com/dianzi/201803/033032F002018.html" target="_blank" rel="noopener">中国报告网-2018年我国半导体光刻行业生产工艺流程分析</a>。<br>里面还有更详细的介绍。</p>
<h2 id="光刻机"><a href="#光刻机" class="headerlink" title="光刻机"></a>光刻机</h2><p>镜头必须用德国蔡司做的镜头或反光碗，然后ASML做出整个的光刻机。目前在大生产上的浸没式光刻机是用镜头来做的，但是最新的深紫外光刻机已经不用镜头了，用的反光碗。令人惊奇的是反光碗的加工精度，相当于德国国土面积上要平整到正负一毫米。</p>
<h2 id="等离子体刻蚀机"><a href="#等离子体刻蚀机" class="headerlink" title="等离子体刻蚀机"></a>等离子体刻蚀机</h2><p>光刻虽然很重要，但是等离子体刻蚀也比较重要。尤其是最近几年说的十几纳米以内的精度实际上都是由先进的等离子体刻蚀技术来提供的。因为目前的精度下，光刻出来的不是很直的深孔或深沟，而是弯弯曲曲的形状。大量生产的光刻机只能刻出40纳米的线条。最新的深紫外光刻机，EUV，也只做到了20纳米。</p>
<h1 id="半导体的公司"><a href="#半导体的公司" class="headerlink" title="半导体的公司"></a>半导体的公司</h1><p>半导体行业里一般有3类公司。</p>
<ol>
<li>IDM (Integrate Design Manufacture) 从设计到制造一条龙服务的公司，如英特尔、三星。</li>
<li>Fabless，只做芯片设计，根据芯片的设计目的进行逻辑设计和规则制定，公司最终输出的是电路版图，交给制造厂商。典型公司有高通、NVIDIA、博通等。</li>
<li>Foundry，只做加工，没有设计，按照设计厂商输出的电路设计版图要求，在硅晶圆片上完成每个元器件的制造及电路互连，输出是完工的晶圆。典型公司如台积电。</li>
<li>当然还有一类就是半导体的设备公司！</li>
</ol>
<h2 id="半导体厂商-包括所有类别-营收前十名"><a href="#半导体厂商-包括所有类别-营收前十名" class="headerlink" title="半导体厂商(包括所有类别)营收前十名"></a>半导体厂商(包括所有类别)营收前十名</h2><p><img src="http://iknow.stpi.narl.org.tw/Post/Figures/2018/market/ic_14100_20180108.png" alt="haha"><br>自1992年以來，英特爾就一直維持在全球半導體龍頭的地位，近年來隨著PC市場逐步下滑，加上智慧型手機的快速竄起，使得市場對於記憶體需求變得愈來愈大，就在2017年記憶體供給短缺之下，三星首次拉下英特爾第一名的寶座，成為全球最大的半導體製造商。</p>
<p>根據Gartner統計，2017年NAND型快閃記憶體的價格有史以來首次年成長率達到17%，配合DRAM價格上漲44%，這迫使終端裝置公司無法承受這些價格上漲的壓力，因此從個人電腦到智慧型手機的所有產品在2017年都變得更加昂貴。</p>
<p>此外，除了三星受益之外，SK海力士與美光也在記憶體價格暴漲之下，於2017年營收成長率分別達到79%與78.1%。</p>
<h2 id="前十大半导体设备厂商"><a href="#前十大半导体设备厂商" class="headerlink" title="前十大半导体设备厂商"></a>前十大半导体设备厂商</h2><p><img src="http://img.mp.sohu.com/upload/20170513/8dd7eb83d6ff41189b8e96096c8ee336_th.png" alt="haha"><br><a href="http://www.sohu.com/a/140207475_739981" target="_blank" rel="noopener">详细文章见这里</a></p>
<p>“这里面是个公司主要分成三类。一类就是光刻机，就ASML一家。第二类是工艺设备，有应用材料公司（占50%以上），Lam Research公司，以及日本东京电子。还有一类是做测试设备的公司，KLA-Tencor，做了全世界50%以上的测试设备。”</p>
<p>“一共有十类设备，除了光刻，除了测试设备，还有七八类。比如抛光机，镀铜、离子溅射、物理薄膜等。”</p>
<h2 id="2017年十大-Fabless-公司"><a href="#2017年十大-Fabless-公司" class="headerlink" title="2017年十大 Fabless 公司"></a>2017年十大 Fabless 公司</h2><p><img src="https://static.electronicsweekly.com/wp-content/uploads/2018/01/05010239/IMG_1338.png" alt="haha"></p>
<h2 id="十大-Foundry-公司"><a href="#十大-Foundry-公司" class="headerlink" title="十大 Foundry 公司"></a>十大 Foundry 公司</h2><p><img src="https://static.electronicsweekly.com/wp-content/uploads/2017/12/06013105/IMG_0956.jpg" alt="haha"></p>
<p>翻译版<br><img src="https://img.technews.tw/wp-content/uploads/2017/11/29140515/foundry-industry-ranking-2017-e1511935527280.jpg" alt="haha"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/27/Advance-Python-Topics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/27/Advance-Python-Topics/" itemprop="url">Advance Python Topics</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-27T20:56:04-07:00">
                2018-03-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/27/Advance-Python-Topics/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/03/27/Advance-Python-Topics/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Note: 这篇文章主要是对下面这本书(《Powerful Python》2nd edition, Aaron Maxwell)的总结。</p>
<h2 id="基础的知识"><a href="#基础的知识" class="headerlink" title="基础的知识"></a>基础的知识</h2><h3 id="最短代码做-leetcode"><a href="#最短代码做-leetcode" class="headerlink" title="最短代码做 leetcode"></a>最短代码做 leetcode</h3><p><a href="https://github.com/cy69855522/Shortest-LeetCode-Python-Solutions" target="_blank" rel="noopener"></a></p>
<h3 id="copy-复制"><a href="#copy-复制" class="headerlink" title="copy 复制"></a>copy 复制</h3><p>这个其实我明白，但是举例子的时候一下子有点懵。</p>
<p>事实上一个好例子就是 list 里面有 list，因为 list 存的是指针嘛！因此 list 里面的 list 没有被 copy 过来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shallow copy</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = a.copy()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">2</span>].append(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里注意如果修改 a[1] 是不会影响到 b[1] 的，因为 a[1] 是一个 int 类型直接被拷贝过来了。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a[<span class="number">1</span>] = <span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">[<span class="number">1</span>, <span class="number">3</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确用法是使用自带库 copy</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> copy</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = copy.deepcopy(a)</span><br></pre></td></tr></table></figure>

<h3 id="enumerate"><a href="#enumerate" class="headerlink" title="enumerate"></a>enumerate</h3><p>需要枚举一个数组并同时获得值与 index 的时候可以使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(l):</span><br><span class="line">    print(i, v)</span><br><span class="line"><span class="comment"># 0 a</span></span><br><span class="line"><span class="comment"># 1 b</span></span><br><span class="line"><span class="comment"># 2 c</span></span><br></pre></td></tr></table></figure>

<h3 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h3><p>zip 是拉链的意思，想象一下把两个数组像拉链一样挨个聚合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">c = zip(a, b)</span><br><span class="line">list(c)    <span class="comment"># [(1, 4), (2, 5), (3, 6)]</span></span><br></pre></td></tr></table></figure>

<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><ol>
<li>keys(), values(), items() 三个方法可以分别获得 key, value, {key: value} 的数组。</li>
<li></li>
</ol>
<h3 id="heapq"><a href="#heapq" class="headerlink" title="heapq"></a>heapq</h3><p>(from <a href="https://www.geeksforgeeks.org/heap-queue-or-heapq-in-python/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/heap-queue-or-heapq-in-python/</a>)</p>
<p>Heap data structure is mainly used to represent a priority queue. In Python, it is available using “heapq” module. The property of this data structure in python is that each time the smallest of heap element is popped(min heap). Whenever elements are pushed or popped, heap structure in maintained. The heap[0] element also returns the smallest element each time.</p>
<p>Operations on heap :</p>
<ol>
<li><p>heapify(iterable) :- This function is used to convert the iterable into a heap data structure. i.e. in heap order.</p>
</li>
<li><p>heappush(heap, ele) :- This function is used to insert the element mentioned in its arguments into heap. The order is adjusted, so as heap structure is maintained.</p>
</li>
<li><p>heappop(heap) :- This function is used to remove and return the smallest element from heap. The order is adjusted, so as heap structure is maintained.</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python code to demonstrate working of  </span></span><br><span class="line"><span class="comment"># heapify(), heappush() and heappop() </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># importing "heapq" to implement heap queue </span></span><br><span class="line"><span class="keyword">import</span> heapq </span><br><span class="line">  </span><br><span class="line"><span class="comment"># initializing list </span></span><br><span class="line">li = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">3</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heapify to convert list into heap </span></span><br><span class="line">heapq.heapify(li) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># printing created heap </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"The created heap is : "</span>,end=<span class="string">""</span>) </span><br><span class="line"><span class="keyword">print</span> (list(li)) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heappush() to push elements into heap </span></span><br><span class="line"><span class="comment"># pushes 4 </span></span><br><span class="line">heapq.heappush(li,<span class="number">4</span>) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># printing modified heap </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"The modified heap after push is : "</span>,end=<span class="string">""</span>) </span><br><span class="line"><span class="keyword">print</span> (list(li)) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heappop() to pop smallest element </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"The popped and smallest element is : "</span>,end=<span class="string">""</span>) </span><br><span class="line"><span class="keyword">print</span> (heapq.heappop(li))</span><br></pre></td></tr></table></figure>

<p>Output :</p>
<p>The created heap is : [1, 3, 9, 7, 5]<br>The modified heap after push is : [1, 3, 4, 7, 5, 9]<br>The popped and smallest element is : 1</p>
<ol start="4">
<li><p>heappushpop(heap, ele) :- This function combines the functioning of both push and pop operations in one statement, increasing efficiency. Heap order is maintained after this operation.</p>
</li>
<li><p>heapreplace(heap, ele) :- This function also inserts and pops element in one statement, but it is different from above function. In this, element is first popped, then element is pushed.i.e, the value larger than the pushed value can be returned.</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python code to demonstrate working of  </span></span><br><span class="line"><span class="comment"># heappushpop() and heapreplce() </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># importing "heapq" to implement heap queue </span></span><br><span class="line"><span class="keyword">import</span> heapq </span><br><span class="line">  </span><br><span class="line"><span class="comment"># initializing list 1 </span></span><br><span class="line">li1 = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">3</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment"># initializing list 2 </span></span><br><span class="line">li2 = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">3</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heapify() to convert list into heap </span></span><br><span class="line">heapq.heapify(li1) </span><br><span class="line">heapq.heapify(li2) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heappushpop() to push and pop items simultaneously </span></span><br><span class="line"><span class="comment"># pops 2 </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"The popped item using heappushpop() is : "</span>,end=<span class="string">""</span>) </span><br><span class="line"><span class="keyword">print</span> (heapq.heappushpop(li1, <span class="number">2</span>)) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heapreplace() to push and pop items simultaneously </span></span><br><span class="line"><span class="comment"># pops 3 </span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"The popped item using heapreplace() is : "</span>,end=<span class="string">""</span>) </span><br><span class="line"><span class="keyword">print</span> (heapq.heapreplace(li2, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>

<p>Output :</p>
<p>The popped item using heappushpop() is : 2<br>The popped item using heapreplace() is : 3</p>
<ol start="6">
<li><p>nlargest(k, iterable, key = fun) :- This function is used to return the k largest elements from the iterable specified and satisfying the key if mentioned.</p>
</li>
<li><p>nsmallest(k, iterable, key = fun) :- This function is used to return the k smallest elements from the iterable specified and satisfying the key if mentioned.</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python code to demonstrate working of  </span></span><br><span class="line"><span class="comment"># nlargest() and nsmallest() </span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># importing "heapq" to implement heap queue </span></span><br><span class="line"><span class="keyword">import</span> heapq </span><br><span class="line">  </span><br><span class="line"><span class="comment"># initializing list  </span></span><br><span class="line">li1 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>] </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using heapify() to convert list into heap </span></span><br><span class="line">heapq.heapify(li1) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using nlargest to print 3 largest numbers </span></span><br><span class="line"><span class="comment"># prints 10, 9 and 8 </span></span><br><span class="line">print(<span class="string">"The 3 largest numbers in list are : "</span>,end=<span class="string">""</span>) </span><br><span class="line">print(heapq.nlargest(<span class="number">3</span>, li1)) </span><br><span class="line">  </span><br><span class="line"><span class="comment"># using nsmallest to print 3 smallest numbers </span></span><br><span class="line"><span class="comment"># prints 1, 3 and 4 </span></span><br><span class="line">print(<span class="string">"The 3 smallest numbers in list are : "</span>,end=<span class="string">""</span>) </span><br><span class="line">print(heapq.nsmallest(<span class="number">3</span>, li1))</span><br></pre></td></tr></table></figure>

<p>Output :</p>
<p>The 3 largest numbers in list are : [10, 9, 8]<br>The 3 smallest numbers in list are : [1, 3, 4]</p>
<h3 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h3><p>这是 python 自带的迭代器库，有很多实用的，与遍历，迭代相关的函数。</p>
<p><mark>[Permutations 排列]</mark></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>permutations(<span class="string">'ABCD'</span>, <span class="number">2</span>)</span><br><span class="line">AB AC AD BA BC BD CA CB CD DA DB DC</span><br></pre></td></tr></table></figure>

<p><mark>[combinations 组合]</mark></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>combinations(<span class="string">'ABCD'</span>, <span class="number">2</span>)</span><br><span class="line">AB AC AD BC BD CD</span><br></pre></td></tr></table></figure>

<p><mark>[groupby 合并]</mark><br><a href="https://leetcode.com/problems/swap-for-longest-repeated-character-substring/discuss/355852/Python-Groupby/322898" target="_blank" rel="noopener"></a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[k <span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(<span class="string">'AAAABBBCCDAABBB'</span>)]    <span class="comment"># A B C D A B</span></span><br><span class="line">[list(g) <span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(<span class="string">'AAAABBBCCD'</span>)]    <span class="comment"># AAAA BBB CC D</span></span><br></pre></td></tr></table></figure>

<h3 id="functools"><a href="#functools" class="headerlink" title="functools"></a>functools</h3><p>这个库里有很多高阶函数，包括前面介绍到的cmp_to_key 以及 reduce，但是比较逆天的有 lru_cache，即 least recently used cache. 这个 LRU Cache是一个常见的面试题，通常用 hashmap 和双向链表来实现，python 居然直接内置了。</p>
<p>用法即直接作为 decorator 装饰在要 cache 的函数上，以变量值为 key 存储，当反复调用时直接返回计算过的值，例子如下：</p>
<h4 id="lru-cache"><a href="#lru-cache" class="headerlink" title="lru_cache"></a>lru_cache</h4><p><a href="https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution" target="_blank" rel="noopener">https://leetcode.com/problems/stone-game-ii/discuss/345230/Python-DP-Solution</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stoneGameII</span><span class="params">(self, A: List[int])</span> -&gt; int:</span></span><br><span class="line">      N = len(A)</span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> range(N - <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">          A[i] += A[i + <span class="number">1</span>]</span><br><span class="line">      <span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="meta">      @lru_cache(None)</span></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">dp</span><span class="params">(i, m)</span>:</span></span><br><span class="line">          <span class="keyword">if</span> i + <span class="number">2</span> * m &gt;= N: <span class="keyword">return</span> A[i]</span><br><span class="line">          <span class="keyword">return</span> A[i] - min(dp(i + x, max(m, x)) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">2</span> * m + <span class="number">1</span>))</span><br><span class="line">      <span class="keyword">return</span> dp(<span class="number">0</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="string-格式化的三种方式"><a href="#string-格式化的三种方式" class="headerlink" title="string 格式化的三种方式"></a>string 格式化的三种方式</h3><p>TODO</p>
<h4 id="Python-2-6以前：-操作符"><a href="#Python-2-6以前：-操作符" class="headerlink" title="Python 2.6以前：%操作符"></a>Python 2.6以前：%操作符</h4><p>在Python 2.6出现之前，字符串迭代只有一种方法，就是%（也是取模）操作符，%操作符支持unicode和str类型的Python字符串，效果和C语言中的sprintf()方法相似，下面是一个使用%格式化字符串的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">"I'm %s. I'm %d year old"</span> % (<span class="string">'Tom'</span>, <span class="number">27</span>))</span><br><span class="line"><span class="comment"># 还支持复杂点的控制</span></span><br><span class="line">print(<span class="string">'%08.3f'</span> % <span class="number">12.34</span>)  <span class="comment">## 输出0012.340</span></span><br></pre></td></tr></table></figure>

<h4 id="Python-2-6：format函数"><a href="#Python-2-6：format函数" class="headerlink" title="Python 2.6：format函数"></a>Python 2.6：format函数</h4><p>到Python2.6时，出现了一种新的字符串格式化方式，str.format()函数，相比于%操作符，format函数使用{}和:代替了%，威力更加强大，在映射关系方面，format函数支持位置映射、关键字映射、对象属性映射、下标映射等多种方式，不仅参数可以不按顺序，也可以不用参数或者一个参数使用多次，下面通过几个例子来说明。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'&#123;1&#125; &#123;0&#125;'</span>.format(<span class="string">'abc'</span>, <span class="number">123</span>)  <span class="comment"># 可以不按顺序进行位置映射，输出'123 abc'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;&#125; &#123;&#125;'</span>.format(<span class="string">'abc'</span>, <span class="number">123</span>)  <span class="comment"># 可以不指定参数名称，输出'abc 123'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;1&#125; &#123;0&#125; &#123;1&#125;'</span>.format(<span class="string">'abc'</span>, <span class="number">123</span>)  <span class="comment"># 参数可以使用多次，输出'123 abc 123'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;name&#125; &#123;age&#125;'</span>.format(name=<span class="string">'tom'</span>, age=<span class="number">27</span>)  <span class="comment"># 可以按关键字映射，输出'tom 27'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;person.name&#125; &#123;person.age&#125;'</span>.format(person=person)  <span class="comment"># 可以按对象属性映射，输出'tom 27'</span></span><br><span class="line"></span><br><span class="line"><span class="string">'&#123;0[1]&#125; &#123;0[0]&#125;'</span>.format(lst)  <span class="comment"># 通过下标映射</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看到，format函数比%操作符使用起来更加方便，不需要记住太多各种占位符代表的意义，代码可读性也更高。在复杂格式控制方面，format函数也提供了更加强大的控制方式：</span></span><br><span class="line"><span class="comment"># [[填充字符]对齐方式][符号标志][#][宽度][,][.精度][类型]</span></span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="string">'&#123;:S^+#016,.2f&#125;'</span>.format(<span class="number">1234</span>)  <span class="comment"># 输出'SSS+1,234.00SSSS'</span></span><br></pre></td></tr></table></figure>

<h4 id="Python-3-6：f-string"><a href="#Python-3-6：f-string" class="headerlink" title="Python 3.6：f-string"></a>Python 3.6：f-string</h4><p>不少使用过ES6的小伙伴会知道其中的模板字符串，采用直接在字符串中内嵌变量的方式进行字符串格式化操作，Python在3.6版本中也为我们带来了类似的功能：Formatted String Literals（字面量格式化字符串），简称f-string。</p>
<p>f-string就是以f’’开头的字符串，类似u’’和b’’，字符串内容和format方法中的格式一样，但是可以直接将变量带入到字符串中，可读性进一步增加，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">amount = <span class="number">1234</span></span><br><span class="line"><span class="string">f'请转账给我<span class="subst">&#123;amount:,<span class="number">.2</span>f&#125;</span>元'</span>  <span class="comment"># '请转账给我1,234.00元'</span></span><br></pre></td></tr></table></figure>
<p>同时，f-string的性能是比%和format都有提升的，我们做一个简单的测试，分别使用%操作符、format和f-string将下面语句执行10000次：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'My name is %s and i'</span>m %s years old.<span class="string">' % (name, age)</span></span><br><span class="line"><span class="string">'</span>My name <span class="keyword">is</span> &#123;&#125; <span class="keyword">and</span> i<span class="string">'m &#123;&#125; years old.'</span>.format(name, age)</span><br><span class="line"><span class="string">f'My name is <span class="subst">&#123;name&#125;</span> and i'</span>m &#123;age&#125; years old.<span class="string">'</span></span><br></pre></td></tr></table></figure>

<h3 id="小数据池和代码块"><a href="#小数据池和代码块" class="headerlink" title="小数据池和代码块"></a>小数据池和代码块</h3><h4 id="代码块的缓存机制"><a href="#代码块的缓存机制" class="headerlink" title="代码块的缓存机制"></a>代码块的缓存机制</h4><p>前提条件：在同一个代码块内。</p>
<p>机制内容：Python在执行同一个代码块的初始化对象的命令时，会检查是否其值是否已经存在，如果存在，会将其重用。换句话说：执行同一个代码块时，遇到初始化对象的命令时，他会将初始化的这个变量与值存储在一个字典中，在遇到新的变量时，会先在字典中查询记录，如果有同样的记录那么它会重复使用这个字典中的之前的这个值。所以在你给出的例子中，文件执行时（同一个代码块）会把i1、i2两个变量指向同一个对象，满足缓存机制则他们在内存中只存在一个，即：id相同。</p>
<p>适用对象： int（float），str，bool。</p>
<p>对象的具体细则</p>
<ul>
<li>int(float):任何数字在同一代码块下都会复用。</li>
<li>bool:True和False在字典中会以1，0方式存在，并且复用。</li>
<li>str：几乎所有的字符串都会符合缓存机制，具体规定如下（了解即可！）：</li>
</ul>
<p>一些例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 非乘法得到的字符串都满足代码块的缓存机制：</span></span><br><span class="line">s1 = <span class="string">'太白@！#*ewq'</span></span><br><span class="line">s2 = <span class="string">'太白@！#*ewq'</span></span><br><span class="line">print(s1 <span class="keyword">is</span> s2)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2,乘法得到的字符串分两种情况：</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.1 乘数为1时，任何字符串满足代码块的缓存机制：</span></span><br><span class="line"></span><br><span class="line">b1 = <span class="string">'太白@5847395QQ0743895*&amp;^%$#((&amp;_+(())'</span> *<span class="number">1</span></span><br><span class="line">a1 = <span class="string">'太白@5847395QQ0743895*&amp;^%$#((&amp;_+(())'</span> *<span class="number">1</span></span><br><span class="line">print(a1 <span class="keyword">is</span> b1)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2 乘数&gt;=2时：仅含大小写字母，数字，下划线，总长度&lt;=20，满足代码块的缓存机制：</span></span><br><span class="line"></span><br><span class="line">s1 = <span class="string">'old_'</span> * <span class="number">5</span></span><br><span class="line">s2 = <span class="string">'old_'</span> * <span class="number">5</span></span><br><span class="line">print(s1 <span class="keyword">is</span> s2)  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优点：能够提高一些字符串，整数处理人物在时间和空间上的性能；需要值相同的字符串，整数的时候，直接从‘字典’中取出复用，避免频繁的创建和销毁，提升效率，节约内存。</span></span><br></pre></td></tr></table></figure>

<h4 id="小数据池"><a href="#小数据池" class="headerlink" title="小数据池"></a>小数据池</h4><p>小数据池，不同代码块的缓存机制，也称为小整数缓存机制，或者称为驻留机制等等，博主认为，只要你在网上查到的这些名字其实说的都是一个意思，叫什么因人而异。</p>
<p>那么到底什么是小数据池？他有什么作用呢？</p>
<p>前提条件：在不同一个代码块内。</p>
<p>Python自动将-5~256的整数进行了缓存，当你将这些整数赋值给变量时，并不会重新创建对象，而是使用已经创建好的缓存对象。</p>
<p>python会将一定规则的字符串在字符串驻留池中，创建一份，当你将这些字符串赋值给变量时，并不会重新创建对象， 而是使用在字符串驻留池中创建好的对象。</p>
<p>其实，无论是缓存还是字符串驻留池，都是python做的一个优化，就是将~5-256的整数，和一定规则的字符串，放在一个‘池’（容器，或者字典）中，无论程序中那些变量指向这些范围内的整数或者字符串，那么他直接在这个‘池’中引用，言外之意，就是内存中之创建一个。</p>
<p>适用对象： int（float），str，bool </p>
<p>对象的具体细则：（了解即可）</p>
<p>int：那么大家都知道对于整数来说，小数据池的范围是-5~256 ，如果多个变量都是指向同一个（在这个范围内的）数字，他们在内存中指向的都是一个内存地址。</p>
<h2 id="Scaling-with-Generators"><a href="#Scaling-with-Generators" class="headerlink" title="Scaling with Generators"></a>Scaling with Generators</h2><p>generator 不同于一般的一个 list，它是lazy execution，里面的元素用到的时候才会运算取出来。<br>但是要注意，generator 只能用一次，用过以后其位置就跑到了最后面了。</p>
<h3 id="generator-iterable-iterator"><a href="#generator-iterable-iterator" class="headerlink" title="generator, iterable, iterator"></a>generator, iterable, iterator</h3><ol>
<li>一个 list 是 iterable 的</li>
<li>使用 iter(list) 获得一个 iterator</li>
<li>function 定义里面使用 yield 的话就是 generator</li>
<li>iterator 是能遍历一次。</li>
</ol>
<h3 id="使用-iter-获得-generator"><a href="#使用-iter-获得-generator" class="headerlink" title="使用 iter() 获得 generator"></a>使用 iter() 获得 generator</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">nums_iter = iter(nums)  <span class="comment"># nums_iter 是 generator</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums_iter:</span><br><span class="line">  print(num)</span><br><span class="line"><span class="comment">## 上面这个 for loop 第一次执行，会输出 1 到 10。此时 iterator 'nums_iter' 已经指向最后一个数字了。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 此时在运行下面这个 for loop 不会输出任何东西，</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> nums_iter:</span><br><span class="line">  print(num)</span><br><span class="line">  </span><br><span class="line"><span class="comment">## 同样的，此时如果执行 next(nums_iter) 则会报错</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-generator-的好处："><a href="#使用-generator-的好处：" class="headerlink" title="使用 generator 的好处："></a>使用 generator 的好处：</h3><ol>
<li>程序运行更加 smooth，不会说要等待一个很大的东西(list, tuple, dictionary)生成以后才会继续执行，可以让用户持续不断地看到结果输出来，不会感觉程序“好像卡住了”。(参考下面的例子)</li>
<li>内存使用量减少</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 方案-1. 毫无效率的版本</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_nums</span><span class="params">()</span>:</span></span><br><span class="line">  res = []</span><br><span class="line">  n = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span> n &lt; <span class="number">4</span>:</span><br><span class="line">    res.append(n)</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> gen_nums():</span><br><span class="line">  print(num)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 方案-1 的分析：for loop 里调用 gen_nums() 会先生成一个 list，然后才会执行 loop 那个 list。</span></span><br><span class="line"><span class="comment">## 如果需要生成的 list 很大，那么不仅内存占用高，</span></span><br><span class="line"><span class="comment">## 而且用户必须等到 list 生成好以后，才能看到数字本输出来。</span></span><br><span class="line"><span class="comment">## 如果要是网站后台有这种程序，用户就会感觉到网页非常的卡顿，</span></span><br><span class="line"><span class="comment">## 会吐槽设计网页的程序员很屎。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. 使用 generator function 优化后的版本</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_nums</span><span class="params">()</span>:</span></span><br><span class="line">  n = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span> n&lt;<span class="number">4</span>:</span><br><span class="line">    <span class="keyword">yield</span> n</span><br><span class="line">    n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> gen_nums():</span><br><span class="line">  print(num)</span><br><span class="line">  </span><br><span class="line"><span class="comment">## 2 的分析：</span></span><br><span class="line"><span class="comment">## generator function 不同于一般的 function。</span></span><br><span class="line"><span class="comment">## 它有很多个 entry point，但是只有一个 exit point.</span></span><br><span class="line"><span class="comment">## 每次执行完 yield 后，会暂时退出，下次再进来从 yield</span></span><br><span class="line"><span class="comment">## 的后面一句开始执行。</span></span><br></pre></td></tr></table></figure>

<h3 id="range-vs-xrange"><a href="#range-vs-xrange" class="headerlink" title="range vs xrange"></a><strong>range</strong> vs <strong>xrange</strong></h3><ul>
<li>python2: xrange 返回一个 iterator, range 返回一个 list</li>
<li>python3: range 返回一个 iterator<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_squares</span><span class="params">(max_num)</span>:</span></span><br><span class="line">  <span class="keyword">for</span> num <span class="keyword">in</span> range(max_num):</span><br><span class="line">    <span class="keyword">yield</span> num ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">MAX = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> square <span class="keyword">in</span> gen_squares(MAX):</span><br><span class="line">  print(square)</span><br><span class="line">  </span><br><span class="line"><span class="comment">## 这个程序在 python2 环境下有问题，python3 下没有问题。</span></span><br><span class="line"><span class="comment">## 你看出来了吗？</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="iterator-vs-iterable"><a href="#iterator-vs-iterable" class="headerlink" title="iterator vs iterable"></a><strong>iterator</strong> vs <strong>iterable</strong></h3><ol>
<li>iterator 是一个可以传给 next() 的东西，或者可以在 for loop 里调用一次。iterable object 可以tongguo iter() 方法来产生一个 iterator。iterable object 不能直接用 next() 调用。</li>
<li>更准确的说，满足以下条件才是 iterator<ol>
<li>有一个 __next__ 方法</li>
<li>每次调用 __next__ 方法，会产生序列里的下一个 item</li>
<li>一旦序列里所有 items 都被产生过了，再次调用 __next__ 会报错</li>
<li>有一个 __iter__ 方法，调用后返回本身 self.</li>
</ol>
</li>
<li>而一个 iterable object 需要满足下面两个条件的其中一个：<ol>
<li>It defines a method called __iter__()，用来产生并返回一个 iterator 可以遍历 container 里所有 items.</li>
<li>It follows the sequence protocol. 亦即，定义了 __getitem__ 方法，亦即可以使用方括号来获取 item (foo[2]).</li>
</ol>
</li>
<li>注意到 iterator 和 iterable object 都定义了 __iter__ 方法。这是有意为之的，为了保证 for loop 在这两类 object 上的语法是一样的。每次碰到 for loop，它都会先 invoking iter(sequence), which 一定会返回一个 iterator，而不管本来的 sequence 是一个 iterator 还是一个 iterable object.</li>
</ol>
<h3 id="多重-generator-function-嵌套"><a href="#多重-generator-function-嵌套" class="headerlink" title="多重 generator function 嵌套"></a>多重 generator function 嵌套</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matching_lines_from_file</span><span class="params">(path, pattern)</span>:</span></span><br><span class="line">  <span class="keyword">with</span> open(path) <span class="keyword">as</span> handle:</span><br><span class="line">    <span class="comment"># for line in handle.readlines() 千万不要用这一句</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> handle:</span><br><span class="line">      <span class="keyword">if</span> pattern <span class="keyword">in</span> line:</span><br><span class="line">        <span class="keyword">yield</span> line.rstrip(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1. 强烈推荐使用 with 语句来打开文件，当 with 语句结束后，文件会自动关闭。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. "for line in handle" 不错，每次从 test 文件中读取一行！！！不是一下子全部读进来，那样会很费时间。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. .readlines() 这句话会读入整个文件，返回一个 list of strings, one string per line. 很明显，费时间费空间。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 4. 下面函数的输入 'lines' 可以是一个 iterator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_log_records</span><span class="params">(lines)</span>:</span></span><br><span class="line">  <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    level, message = line.split(<span class="string">": "</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">yield</span> &#123;<span class="string">"level"</span>: level, <span class="string">"message"</span>: message&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## 5. 用法</span></span><br><span class="line">log_lines = matching_lines_from_file(<span class="string">"log.txt"</span>, <span class="string">"WARNING:"</span>)</span><br><span class="line"><span class="comment"># 上一句log_lines 是一个 generator function 的结果</span></span><br><span class="line"><span class="comment"># 下一句 parse_log_records() 也是一个 generator function</span></span><br><span class="line"><span class="keyword">for</span> record <span class="keyword">in</span> parse_log_records(log_lines):</span><br><span class="line">  <span class="comment"># record is a dict</span></span><br><span class="line">  print(record)</span><br></pre></td></tr></table></figure>


<h3 id="send-结合-generator"><a href="#send-结合-generator" class="headerlink" title="send() 结合 generator"></a>send() 结合 generator</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>define test():</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    i = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">while</span> i &lt; <span class="number">5</span>:</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        temp = <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        print(temp)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t = test()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.__next__()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.__next__()</span><br><span class="line"><span class="literal">None</span>               <span class="comment"># 这里是 print(temp) 执行的结果</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析，调用第一次 __next__ 的时候，函数执行，到达 "temp = yield i" 这一句话。</span></span><br><span class="line"><span class="comment"># 此时，会先执行等号右边的部分</span></span><br><span class="line"><span class="comment"># 但是注意，右边执行完以后函数就暂停了。</span></span><br><span class="line"><span class="comment"># 这也是为什么结果为 0</span></span><br><span class="line"><span class="comment"># 接着执行第二次调用 __next__，程序会从上次 yield i 的下一句那里开始。</span></span><br><span class="line"><span class="comment"># 也就是给 temp 赋值那一句话。但是右边 yield i 不会提供 i 值给 temp</span></span><br><span class="line"><span class="comment"># 因此 temp 的值为 “None”。</span></span><br></pre></td></tr></table></figure>

<p>要想传递值给 temp, 需要使用 send() 函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 继续上面的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>t.send(<span class="string">"haha"</span>)</span><br><span class="line">haha</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>


<h3 id="views-in-python3"><a href="#views-in-python3" class="headerlink" title="views in python3"></a>views in python3</h3><ol>
<li>如果 calories 是一个 dict</li>
<li>items = calories.items() 是一个 view，支持<ol>
<li>len(view)</li>
<li>iter(view)</li>
<li>(key, value) in view 判断是否在 view 里面</li>
</ol>
</li>
<li>既然 items 是一个 view，因此如果你要接下来修改了 calories 的内容，view “看到” 的是新的 calories dict.</li>
<li>同理，.keys(), .values() 也是返回 view</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The built-in map, filter, and zip functions all return iterators:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>big_numbers = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">double</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">return</span> <span class="number">2</span> * n</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">is_even</span><span class="params">(n)</span>:</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">return</span> n % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mapped = map(double, numbers)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mapped</span><br><span class="line">&lt;map object at <span class="number">0x1013ac518</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> num <span class="keyword">in</span> mapped: print(num)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>filtered = filter(is_even, numbers)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>filtered</span><br><span class="line">&lt;filter object at <span class="number">0x1013ac668</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> num <span class="keyword">in</span> filtered: print(num)</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zipped = zip(numbers, big_numbers)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>zipped</span><br><span class="line">&lt;zip object at <span class="number">0x1013a9608</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> pair <span class="keyword">in</span> zipped: print(pair)</span><br><span class="line">(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">200</span>)</span><br><span class="line">(<span class="number">3</span>, <span class="number">300</span>)</span><br></pre></td></tr></table></figure>


<h3 id="注意-view-in-python2"><a href="#注意-view-in-python2" class="headerlink" title="注意 view in python2"></a>注意 view in python2</h3><ol>
<li>items() 返回的是 a list of key-value tuples, 不是 view 哦。</li>
<li>viewitems() 才是返回 view.</li>
<li>同理，建议使用 viewkeys() 和 viewvalues()</li>
</ol>
<h2 id="Creating-collections-with-comprehensions"><a href="#Creating-collections-with-comprehensions" class="headerlink" title="Creating collections with comprehensions"></a>Creating collections with comprehensions</h2><h3 id="最简单-list-comprehension"><a href="#最简单-list-comprehension" class="headerlink" title="最简单 list comprehension"></a>最简单 list comprehension</h3><ol>
<li>模板：[EXPRESSION for VARIABLE in SEQUENCE]</li>
<li>带 filter 的模板：[EXPRESSION for VARIABLE in SEQUENCE if CONDITION]</li>
<li>EXPRESSION 可以使任何表达式<ol>
<li>算术 n+3</li>
<li>function call f(n)</li>
<li>slice operation (like s[::-1], to reverse a string)</li>
<li>method call (foo.bar(), iterating over a sequence of objects)</li>
</ol>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pets = [<span class="string">"dog"</span>, <span class="string">"parakeet"</span>, <span class="string">"cat"</span>, <span class="string">"llama"</span>]</span><br><span class="line">numbers = [ <span class="number">9</span>, <span class="number">-1</span>, <span class="number">-4</span>, <span class="number">20</span>, <span class="number">11</span>, <span class="number">-3</span> ]</span><br><span class="line">words = [<span class="string">"bib"</span>, <span class="string">"bias"</span>, <span class="string">"dad"</span>, <span class="string">"eye"</span>, <span class="string">"deed"</span>, <span class="string">"tooth"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat</span><span class="params">(s)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> s + s</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_palindrome</span><span class="params">(s)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> s == s[::<span class="number">-1</span>]</span><br><span class="line">  </span><br><span class="line">[ <span class="number">2</span>*m+<span class="number">3</span> <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">10</span>, <span class="number">20</span>, <span class="number">2</span>) ]</span><br><span class="line">[abs(num) <span class="keyword">for</span> num <span class="keyword">in</span> numbers ]</span><br><span class="line">[ pet.upper() <span class="keyword">for</span> pet <span class="keyword">in</span> pets ]</span><br><span class="line">[ repeat(pet) <span class="keyword">for</span> pet <span class="keyword">in</span> pets ]</span><br><span class="line">[ word <span class="keyword">for</span> word <span class="keyword">in</span> words <span class="keyword">if</span> is_palindrome(word) ]</span><br></pre></td></tr></table></figure>

<h3 id="what-about-long-list-comprehension"><a href="#what-about-long-list-comprehension" class="headerlink" title="what about long list comprehension"></a>what about long list comprehension</h3><p>对于比较长的 list comprehension, 可以分几行来写。把三个逻辑不同的语句分开写，pre-parsed, 读起来方便，对于 version control and code review 也方便。比如我在一个 branch 里改了 “word + word + word”, 有一个其他人改了 “len(word) &lt; 3”, version control tools 可以自动 merge 这些改动。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">double_short_words</span><span class="params">(words)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> [ word + word</span><br><span class="line">           <span class="keyword">for</span> word <span class="keyword">in</span> words</span><br><span class="line">           <span class="keyword">if</span> len(word) &lt; <span class="number">5</span> ]</span><br></pre></td></tr></table></figure>

<h3 id="多个-for-语句和-if-语句-in-comprehension"><a href="#多个-for-语句和-if-语句-in-comprehension" class="headerlink" title="多个 for 语句和 if 语句 in comprehension"></a>多个 for 语句和 if 语句 in comprehension</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">colors = [<span class="string">"green"</span>, <span class="string">"red"</span>, <span class="string">"blue"</span>]</span><br><span class="line">toys = [<span class="string">"bike"</span>, <span class="string">"car"</span>, <span class="string">"boat"</span>]</span><br><span class="line"></span><br><span class="line">[ color + <span class="string">" "</span> + toy</span><br><span class="line">  <span class="keyword">for</span> color <span class="keyword">in</span> colors</span><br><span class="line">  <span class="keyword">for</span> toy <span class="keyword">in</span> toys ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># example-2</span></span><br><span class="line">numbers = [ <span class="number">9</span>, <span class="number">-1</span>, <span class="number">-4</span>, <span class="number">20</span>, <span class="number">17</span>, <span class="number">-3</span> ]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>odd_positives = [</span><br><span class="line"><span class="meta">... </span>num <span class="keyword">for</span> num <span class="keyword">in</span> numbers</span><br><span class="line"><span class="meta">... </span><span class="keyword">if</span> num &gt; <span class="number">0</span></span><br><span class="line"><span class="meta">... </span><span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">1</span></span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(odd_positives)</span><br><span class="line">[<span class="number">9</span>, <span class="number">17</span>]</span><br></pre></td></tr></table></figure>

<h3 id="scalable-generator-expression-来代替-list-comprehension"><a href="#scalable-generator-expression-来代替-list-comprehension" class="headerlink" title="scalable generator expression 来代替 list comprehension"></a>scalable generator expression 来代替 <strong>list comprehension</strong></h3><ol>
<li>只需要把 list comprehension 表达式中的方括号换成圆括号就好了。</li>
<li>generator expression 作为函数参数时候，可以去掉中间那个圆括号<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">generated_squares = ( n**<span class="number">2</span> <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">100</span>) )</span><br><span class="line"></span><br><span class="line">sorted((user.email <span class="keyword">for</span> user <span class="keyword">in</span> all_users <span class="keyword">if</span> user.is_active))</span><br><span class="line"><span class="comment"># Omitting the inner parentheses.</span></span><br><span class="line"><span class="comment"># Still passing in a generator expression!</span></span><br><span class="line">sorted(user.email <span class="keyword">for</span> user <span class="keyword">in</span> all_users <span class="keyword">if</span> user.is_active)</span><br><span class="line">[<span class="string">'fred@a.com'</span>, <span class="string">'sandy@f.net'</span>, <span class="string">'tim@d.com'</span>]</span><br><span class="line"><span class="comment"># 但是要注意，如果函数有其他参数，就不能省略</span></span><br><span class="line">sorted((user.email <span class="keyword">for</span> user <span class="keyword">in</span> all_users <span class="keyword">if</span> user.is_active), reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="comprehension-for-other-data-structures"><a href="#comprehension-for-other-data-structures" class="headerlink" title="comprehension for other data structures"></a>comprehension for other data structures</h3><p>注意！！！ Dictionaries, Sets, and Tuples 都有类似的 comprehension 的写法，但是如果需要 scalable solution，就之能定义 generator function 才行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得 dictionary</span></span><br><span class="line">&#123;student.name : student.gpa <span class="keyword">for</span> student <span class="keyword">in</span> students&#125;</span><br><span class="line"><span class="comment"># 获得 set 方法一</span></span><br><span class="line">&#123;student.major <span class="keyword">for</span> student <span class="keyword">in</span> students&#125;</span><br><span class="line"><span class="comment"># 获得 set 方法二</span></span><br><span class="line">set(student.major <span class="keyword">for</span> student <span class="keyword">in</span> students)</span><br><span class="line"><span class="comment"># 获得 tuple 只有一个方法</span></span><br><span class="line">tuple(student.gpa <span class="keyword">for</span> student <span class="keyword">in</span> students <span class="keyword">if</span> student.major == <span class="string">"CS"</span>)</span><br><span class="line"><span class="comment"># 这个获得 tuple 的方法不是 comprehension，实际上是把一个 generator 传递给了 tuple 的 constructor.</span></span><br></pre></td></tr></table></figure>


<h2 id="function-的高级使用技巧"><a href="#function-的高级使用技巧" class="headerlink" title="function 的高级使用技巧"></a>function 的高级使用技巧</h2><h3 id="可变数量的参数"><a href="#可变数量的参数" class="headerlink" title="可变数量的参数"></a>可变数量的参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">take_any_number_of_args</span><span class="params">(*args)</span>:</span></span><br><span class="line">  print(str(args))</span><br><span class="line"></span><br><span class="line"><span class="comment">## 这样子用，args 是一个 tuple</span></span><br><span class="line"></span><br><span class="line">takes_any_number_of_args([<span class="string">"first"</span>, <span class="string">"list"</span>], [<span class="string">"another"</span>, <span class="string">"list"</span>])</span><br><span class="line"><span class="comment"># args 是一个 tuple，里面有两个 list of two strings</span></span><br></pre></td></tr></table></figure>

<h3 id="argument-unpacking"><a href="#argument-unpacking" class="headerlink" title="argument unpacking"></a>argument unpacking</h3><p>讲到 unpacking, 可以先说一下一般的 unpacking 用法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. assign names to different parts of a list or a tuple</span></span><br><span class="line"><span class="comment">#    下面的例子我知道等号右边会把一个 string 拆成两部分</span></span><br><span class="line"><span class="comment">#    所以左边我就用两个变量来存右边的两个部分</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>filename, ext = <span class="string">"my_photo.orig.png"</span>.rsplit(<span class="string">"."</span>, <span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(filename, <span class="string">"is a"</span>, ext, <span class="string">"file"</span>)</span><br><span class="line">my_photo.orig <span class="keyword">is</span> a png file.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. more examples</span></span><br><span class="line">a, b = b, a</span><br><span class="line">a, (b, c) = <span class="number">1</span>, (<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. In Python 3 introduces extended unpacking</span></span><br><span class="line">a, *rest = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]  <span class="comment"># a = 1, rest = [2, 3]</span></span><br><span class="line">a, *middle, c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]  <span class="comment"># a = 1, middle = [2, 3], c = 4</span></span><br></pre></td></tr></table></figure>

<p>上面第三个例子可以用在函数的参数中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 你有一个函数接受 3 个参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_function</span><span class="params">(a, b, c)</span>:</span></span><br><span class="line">  do_something_here</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 如果你有一个 tuple of three things, 你可以直接带入进去</span></span><br><span class="line">nums = (<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="comment"># some_function(nums[0], nums[1], nums[2]) 不需要这样子写</span></span><br><span class="line">some_function(*nums)</span><br></pre></td></tr></table></figure>

<h3 id="variable-keyword-arguments"><a href="#variable-keyword-arguments" class="headerlink" title="variable keyword arguments"></a>variable keyword arguments</h3><p>上面说的都是 positional arguments, 这里换一个 keyword arguments. (kwargs 就是 keyword argument 的缩写)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_kwargs</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">  <span class="keyword">for</span> key, val <span class="keyword">in</span> kwargs.items():</span><br><span class="line">    print(<span class="string">"&#123;&#125; -&gt; &#123;&#125;"</span>.format(key, val))</span><br><span class="line"><span class="comment"># 这个例子里面变量 kwargs 是一个 dictionary</span></span><br><span class="line"><span class="comment"># 因此我们可以用 items() 来遍历 key, val 组合。</span></span><br><span class="line"></span><br><span class="line">print_kwargs(hero=<span class="string">"Homer"</span>, antihero=<span class="string">"Bart"</span>, genius=<span class="string">"Lisa"</span>)</span><br><span class="line"><span class="comment"># 实际调用 print_kwargs 函数时候，给的带 “=” 的三个参数</span></span><br><span class="line"><span class="comment"># 都属于 keyword arguments, 会被函数定义中的 **kwargs 捕捉到。</span></span><br></pre></td></tr></table></figure>

<h3 id="positional-arguments-和-keyword-arguments-组合起来用"><a href="#positional-arguments-和-keyword-arguments-组合起来用" class="headerlink" title="positional arguments 和 keyword arguments 组合起来用"></a>positional arguments 和 keyword arguments 组合起来用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_config_defaults</span><span class="params">(config, **kwargs)</span>:</span></span><br><span class="line">  <span class="keyword">for</span> key, val <span class="keyword">in</span> kwargs.items():</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> config:</span><br><span class="line">      config[key] = val</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>config = &#123;<span class="string">"verbosity"</span>: <span class="number">3</span>, <span class="string">"theme"</span>: <span class="string">"Blue Steel"</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_config_defaults(config, bass=<span class="number">11</span>, verbosity=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>config</span><br><span class="line">&#123;<span class="string">'verbosity'</span>: <span class="number">3</span>, <span class="string">'theme'</span>: <span class="string">'Blue Steel'</span>, <span class="string">'bass'</span>: <span class="number">11</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里有一点要注意，python always pass the object itself, whether it's changed depends on the mutability of the objects.</span></span><br><span class="line"><span class="comment"># 因为 dictionary is mutable, 所以 config 内容改变了。</span></span><br></pre></td></tr></table></figure>

<h3 id="keyword-arguments-unpacking"><a href="#keyword-arguments-unpacking" class="headerlink" title="keyword arguments unpacking"></a>keyword arguments unpacking</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">normal_function</span><span class="params">(a, b, c)</span>:</span></span><br><span class="line"><span class="meta">... </span>print(<span class="string">"a: &#123;&#125; b: &#123;&#125; c: &#123;&#125;"</span>.format(a,b,c))</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>numbers = &#123;<span class="string">"a"</span>: <span class="number">7</span>, <span class="string">"b"</span>: <span class="number">5</span>, <span class="string">"c"</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>normal_function(**numbers)</span><br><span class="line">a: <span class="number">7</span> b: <span class="number">5</span> c: <span class="number">3</span></span><br></pre></td></tr></table></figure>

<h3 id="functions-as-objects"><a href="#functions-as-objects" class="headerlink" title="functions as objects"></a><mark>functions as objects</mark></h3><p>在 Python 中，函数的地位很特殊，它是作为第一类对象（first-class object）存在的，也因此具有如下几个特点：</p>
<h4 id="函数具有对象模型的三个通用属性：id、类型和值。"><a href="#函数具有对象模型的三个通用属性：id、类型和值。" class="headerlink" title="函数具有对象模型的三个通用属性：id、类型和值。"></a>函数具有对象模型的三个通用属性：id、类型和值。</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(test)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> len(test)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>id(foo)</span><br><span class="line"><span class="number">2345234562346</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>type(foo)</span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">function</span>'&gt;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt; <span class="title">foo</span></span></span><br><span class="line"><span class="class">&lt;<span class="title">function</span> <span class="title">foo</span> <span class="title">at</span> 0<span class="title">x2345f2342</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="可以赋值给其他变量"><a href="#可以赋值给其他变量" class="headerlink" title="可以赋值给其他变量"></a>可以赋值给其他变量</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo2 = foo</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo2(<span class="string">"Weiwei is a good cook."</span>)</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure>

<h4 id="可以存储在container中"><a href="#可以存储在container中" class="headerlink" title="可以存储在container中"></a>可以存储在container中</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>func_list = [str, len, <span class="keyword">print</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func_list</span><br><span class="line">[&lt;class 'str'&gt;, &lt;built-in function len&gt;, &lt;built-in function print&gt;]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func_list[<span class="number">2</span>](<span class="string">"weiwei"</span>)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h4 id="可以作为其他函数的参数！"><a href="#可以作为其他函数的参数！" class="headerlink" title="可以作为其他函数的参数！"></a>可以作为其他函数的参数！</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">max_by_key</span><span class="params">(items, key)</span>:</span></span><br><span class="line"><span class="meta">... </span>  biggest = items[<span class="number">0</span>]</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">for</span> item <span class="keyword">in</span> items[<span class="number">1</span>:]:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> key(item) &gt; key(biggest):</span><br><span class="line"><span class="meta">... </span>      biggest = item</span><br><span class="line"><span class="meta">... </span>  <span class="keyword">return</span> biggest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个定义里面那个 key 代表一个函数哦！！</span></span><br><span class="line"><span class="comment"># 例如，</span></span><br><span class="line">nums = [<span class="string">"7"</span>, <span class="string">"13"</span>, <span class="string">"25"</span>, <span class="string">"4"</span>]</span><br><span class="line">max_by_key(nums, int)</span><br><span class="line"><span class="comment"># 就是说用这些数字代表的数值来比较，而不是作为 string 来比较。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># python 自带的函数 min, max, sorted 也接受 key 变量。</span></span><br><span class="line">min(nums, key=int)</span><br><span class="line">sorted(nums, key=int)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除了 int 这种系统自带的函数，也可以自定义函数。</span></span><br><span class="line">eric=&#123;<span class="string">"gpa"</span>:<span class="number">3.93</span>, <span class="string">"major"</span>:<span class="string">"geophysics"</span>, <span class="string">"name"</span>: <span class="string">"Eric"</span>&#125;</span><br><span class="line">...</span><br><span class="line">students = [eric, john, lisa]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gpa</span><span class="params">(student)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> student[<span class="string">"gpa"</span>]</span><br><span class="line">sorted(students, key=get_gpa)</span><br></pre></td></tr></table></figure>

<h4 id="接上面6，operator-module"><a href="#接上面6，operator-module" class="headerlink" title="接上面6，operator module"></a>接上面6，operator module</h4><p>operator 提供 itemgetter 函数可以构造新函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果每个 student 是一个 dictionary</span></span><br><span class="line">sorted(students, key=itemgetter(<span class="string">"gpa"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果每个 student 是一个 list or tuple</span></span><br><span class="line">sorted(students, key=itemgetter(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 此处 2 代表 index 是 2.</span></span><br></pre></td></tr></table></figure>
<p>operator 还提供 attrgetter, methodcaller 来给自定义的 class 使用。”operator also provides attrgetter, for keying off an attribute of the element, and methodcaller for keying off a method’s return value - useful when the sequence elements are instances of your own class”</p>
<h4 id="可以作为返回值"><a href="#可以作为返回值" class="headerlink" title="可以作为返回值"></a>可以作为返回值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">foo3</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> foo</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo3</span><br><span class="line">&lt;function foo3 at <span class="number">0x106c324a6</span>&gt;</span><br></pre></td></tr></table></figure>

<h4 id="函数可以嵌套-想想-decorator"><a href="#函数可以嵌套-想想-decorator" class="headerlink" title="函数可以嵌套(想想 decorator)"></a>函数可以嵌套(想想 decorator)</h4><h4 id="实现了-call-的类也可以作为函数"><a href="#实现了-call-的类也可以作为函数" class="headerlink" title="实现了 __call__ 的类也可以作为函数"></a>实现了 __call__ 的类也可以作为函数</h4><p>该类的实例对象的行为就是一个函数，callable.</p>
<h3 id="函数与闭包"><a href="#函数与闭包" class="headerlink" title="函数与闭包"></a>函数与闭包</h3><h4 id="作用域基本概念"><a href="#作用域基本概念" class="headerlink" title="作用域基本概念"></a>作用域基本概念</h4><ol>
<li>变量是有作用域的。定义在最外部的变量是全局变量，在全局范围内可见，函数体内当然也能见到。</li>
<li>定义在函数内部的是局部变量，作用范围是函数体内部。不能在函数外引用。</li>
<li>但是，对于嵌套函数来说，它可以访问外层函数中声明的非局部（non-local）变量。例子如下：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 例子一</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_msg</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># print_msg 是外围函数</span></span><br><span class="line">    msg = <span class="string">"zen of python"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printer</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># printer是嵌套函数</span></span><br><span class="line">        print(msg)</span><br><span class="line">    printer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 zen of python</span></span><br><span class="line">print_msg()</span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子二之错误用法</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    b = <span class="number">9</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="comment"># 这里会报错 “local variable 'b' referenced before assignment”</span></span><br><span class="line"><span class="comment"># 是因为Python编译器在编译函数的定义体的时候，看到 b=9 这一句话会判断 b 是局部 local 变量，python 会从本地环境获取 b。</span></span><br><span class="line"><span class="comment"># 这样子上面一句话 print(b) 中的 b 在语句执行的时候实际上 b 还没有绑定给 9 。 就提示错误了。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子二的正确用法之一</span></span><br><span class="line"><span class="comment">## 声明 b 为全局变量</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">global</span> b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    b = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">11</span>)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(b)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 例子二的正确用法之二</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(a)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    b = <span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(a)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(b)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func(<span class="number">11</span>)</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(b)</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>这里提到的理解比较好。闭包是由函数及其相关的引用环境组合而成的实体。定义为：在实现绑定时，需要创建一个能显示表示引用环境的东西，并将它与相关的子程序捆绑在一起，这个捆绑起来的整体就叫做闭包。</p>
<p>C++ 语言里面，我们理解的函数在定义的时候就确定了，不会在执行的时候发生变化。<br>而此处的闭包在运行的时候可以有多个实例，不同的引用环境和相同的环境组合可以产生不同的实例。</p>
<p>看一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_msg</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># print_msg 是外围函数</span></span><br><span class="line">    msg = <span class="string">"zen of python"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">printer</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># printer 是嵌套函数</span></span><br><span class="line">        print(msg)</span><br><span class="line">    <span class="keyword">return</span> printer</span><br><span class="line"></span><br><span class="line">another = print_msg()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 zen of python</span></span><br><span class="line">another()</span><br></pre></td></tr></table></figure>
<p>这个例子与上一个例子的输出是一样的，区别在于这里是把嵌套函数作为外层函数的输出返回了。<br>可以用其他的变量 temp 来接收这个返回的函数。这样子就可以 call temp 变量(函数)来<br>直接访问定义在 print_msg() 中的变量了。虽然一般情况下是不能访问函数内部变量的。<br>这就是闭包的作用，闭包使得局部变量在函数外被访问成为可能。</p>
<p>这里的 another 就是一个闭包，闭包本质上是一个函数，它由两部分组成，printer 函数和变量 msg。闭包使得这些变量的值始终保存在内存中。</p>
<p>再看一个例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line">    series = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line">        series.append(new_value)</span><br><span class="line">        total = sum(series)</span><br><span class="line">        <span class="keyword">return</span> total / len(series)</span><br><span class="line">    <span class="keyword">return</span> averager</span><br><span class="line"></span><br><span class="line">avg = make_averager()</span><br><span class="line">print(avg(<span class="number">10</span>))  <span class="comment"># 输出 10</span></span><br><span class="line">print(avg(<span class="number">20</span>))  <span class="comment"># 输出 15</span></span><br><span class="line">print(avg(<span class="number">15</span>))  <span class="comment"># 输出 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只要 avg 这个变量存在，它就指向那个函数空间。恰好那个函数空间里有一个 series 变量，是未在本地作用域绑定的变量。</span></span><br><span class="line"></span><br><span class="line">dir(avg)</span><br><span class="line"><span class="comment"># 这个命令的输出中会含有这个 “__code__”。它里面保存着自由变量的名称。</span></span><br><span class="line">print(avg.__code__.co_varnames)  <span class="comment"># ("new_value", "total")</span></span><br><span class="line">print(avg.__code__.co_freevars)  <span class="comment"># ('series')</span></span><br><span class="line">print(avg.__closure__)  <span class="comment"># (&lt;cell at 0x100399f48: list object at 0x10220b998&gt;,)</span></span><br><span class="line">print(avg.__closure__[<span class="number">0</span>].cell_contents)  <span class="comment"># [10, 20, 15]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># series 的绑定在返回的 avg 函数的 __closure__ 属性中。也就是说，闭包会保留定义函数时存在的自由变量的绑定。</span></span><br><span class="line"><span class="comment"># 这样在调用函数时候虽然定义作用域不能用了，但是仍然可以使用那些绑定。</span></span><br></pre></td></tr></table></figure>



<h4 id="闭包的使用场景"><a href="#闭包的使用场景" class="headerlink" title="闭包的使用场景"></a>闭包的使用场景</h4><p>闭包避免了使用全局变量，此外，闭包允许将函数与其所操作的某些数据（环境）关连起来。这一点与面向对象编程是非常类似的，在面对象编程中，对象允许我们将某些数据（对象的属性）与一个或者多个方法相关联。</p>
<p>一般来说，当对象中只有一个方法时，这时使用闭包是更好的选择。来看一个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adder</span><span class="params">(x)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">(y)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">adder5 = adder(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 15</span></span><br><span class="line"></span><br><span class="line">adder5(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出 11</span></span><br><span class="line"></span><br><span class="line">adder5(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">这比用类来实现更优雅，此外装饰器也是基于闭包的一中应用场景。</span><br></pre></td></tr></table></figure>

<p>所有函数都有一个 __closure__属性，如果这个函数是一个闭包的话，那么它返回的是一个由 cell 对象 组成的元组对象。cell 对象的cell_contents 属性就是闭包中的自由变量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder.__closure__</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder5.__closure__</span><br><span class="line"></span><br><span class="line">(&lt;cell at <span class="number">0x103075910</span>: int object at <span class="number">0x7fd251604518</span>&gt;,)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>adder5.__closure__[<span class="number">0</span>].cell_contents</span><br><span class="line"></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>


<h4 id="一个易错点"><a href="#一个易错点" class="headerlink" title="一个易错点"></a>一个易错点</h4><p>例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">make_averager</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    count = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    total = <span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="function"><span class="keyword">def</span> <span class="title">averager</span><span class="params">(new_value)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        count += <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        total += new_value</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        <span class="keyword">return</span> total / count</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">return</span> averager</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg = make_averager()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>avg(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里跟之前出现的例子不一样，这里会报错</span></span><br><span class="line"><span class="comment"># 原因是 count, total 都是数字，是不可变类型。而 series 是一个 list，是可变类型。</span></span><br><span class="line"><span class="comment"># 因此 count += 1 就是说 count = count+1, 这句话使得 count 变成了局部变量。</span></span><br><span class="line"><span class="comment"># 解决办法就是在 “count += 1” 这句话之前加上 “nonlocal count, total” 就可以了。</span></span><br></pre></td></tr></table></figure>


<h4 id="后期绑定-late-binding"><a href="#后期绑定-late-binding" class="headerlink" title="后期绑定 late binding"></a>后期绑定 late binding</h4><p>Python 需要用到变量的时候才回去找变量的值！！！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    print(xxx)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>xxx = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>xxx = <span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test()</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<p>你定义一个函数，函数内的变量并不是立刻就把值绑定了，而是等调用的时候再查找这个变量。<br>上面的例子中，定义函数的时候没有 xxx 变量，但是仍然可以这么做，只要调用的时候环境里有这个变量就可以。</p>
<p>Python 的 list comprehension 只形成了一个词法作用域。<br>下面的例子中，生成的 4 个闭包保存的环境是一样的。因此每个闭包的调用结果就一样了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 错误方法：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multipliers</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">lambda</span> x: i * x <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line"><span class="keyword">for</span> multiplier <span class="keyword">in</span> multipliers():</span><br><span class="line">    print(multiplier(<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 输出 6, 6, 6, 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 正确方法一，使用默认参数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multipliers</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">lambda</span> x, i=i : i*x <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment">## 正确方法二，使用生成器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multipliers</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">lambda</span> x : <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## 正确方法三，利用 yield 的惰性求值的思想</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multipliers</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">lambda</span> x : i * x</span><br></pre></td></tr></table></figure>



<h3 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h3><p>装饰器就是把一个函数变成另外一个函数。<br>其方法是把本来的函数作为参数传到修饰函数里面，修饰函数再运行传进来的本来的函数之前会加上一些步骤。</p>
<h4 id="双重装饰"><a href="#双重装饰" class="headerlink" title="双重装饰"></a>双重装饰</h4><p>思考下面一段 Python 的代码会输出什么？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">w1</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(<span class="string">"---正在装饰1---"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        print(<span class="string">"---正在验证权限1---"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        func()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">return</span> inner</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">w2</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(<span class="string">"---正在装饰2---"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        print(<span class="string">"---正在验证权限2---"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        func()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">return</span> inner</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@w1</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@w2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    print(<span class="string">"---f1---"</span>)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1()</span><br></pre></td></tr></table></figure>
<p>分析：<br>    1. 内层装饰器会先执行，因此先输出：—正在装饰2—<br>    2. 外层装饰器后执行，  所以第二个输出： —正在装饰1—<br>    3. 装饰完毕，f1 指向的是 w1 里面定义的 inner 函数<br>    4. 所以，执行 f1 第三个输出是：—正在验证权限1—<br>    5. 然后执行 w1 内部 inner 的 func， which 指向 w2 里面的 inner<br>    6. 所以，执行 f4 第四个输出是：—正在验证权限2—<br>    7. 最后的输出是：—f1—</p>
<h4 id="装饰带参数的函数"><a href="#装饰带参数的函数" class="headerlink" title="装饰带参数的函数"></a>装饰带参数的函数</h4><p>下面的装饰器可以装饰带若干个参数的函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorator_func</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        <span class="comment"># here do some thing</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        func(*args, **kwargs)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>


<h4 id="装饰-有返回值-的函数"><a href="#装饰-有返回值-的函数" class="headerlink" title="装饰 有返回值 的函数"></a>装饰 有返回值 的函数</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里是一个通用的装饰器，带不带参数，有没有返回值都试用！</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">decorator_func</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        <span class="comment"># here do some thing</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        ret = func(*args, **kwargs)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>        <span class="keyword">return</span> ret</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure>

<h4 id="带有参数的装饰器"><a href="#带有参数的装饰器" class="headerlink" title="带有参数的装饰器"></a>带有参数的装饰器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime, sleep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">timefun_arg</span><span class="params">(pre=<span class="string">"hello"</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">timefun</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrappedfunc</span><span class="params">()</span>:</span></span><br><span class="line">            print(<span class="string">"%s called at %s %s"</span> % (func.__name__, ctime(), pre))</span><br><span class="line">            <span class="keyword">return</span> func</span><br><span class="line">        <span class="keyword">return</span> wrappedfunc</span><br><span class="line">    <span class="keyword">return</span> timefun</span><br><span class="line"></span><br><span class="line"><span class="meta">@timefun_arg("itcast")  # 这一句会先执行 timefun_arg(pre=hello) 获得 timefun, 而 timefun 就是一个装饰器。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am foo"</span>)</span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<h2 id="exceptions-and-errors"><a href="#exceptions-and-errors" class="headerlink" title="exceptions and errors"></a>exceptions and errors</h2><p>exception 是程序运行时候出现的一些错误，比如在 dict 里查找一个不存在的 key 就会出现 keyerror.<br>但是这个时候其实也可以用 if else 语句来代替啦，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> key <span class="keyword">in</span> mydict:</span><br><span class="line">    value = mydict[key]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    value = default_value</span><br><span class="line"></span><br><span class="line"><span class="comment">## using try/except</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    value = mydict[key]</span><br><span class="line"><span class="keyword">except</span> KeyError:</span><br><span class="line">    value = default_value</span><br></pre></td></tr></table></figure>
<p>不过要注意的是，使用 if else 语句的前提是你可以直接读取那个 dict object，万一你没有这个前提条件，比如<br>你只能使用提供的 api，那么你就只能写 try/except block 了。</p>
<h3 id="基本形式"><a href="#基本形式" class="headerlink" title="基本形式"></a>基本形式</h3><p>exception 出现的时候程序会终止，不过你可以采取预防措施去避免中止。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 形式如下</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    run some_code</span><br><span class="line"><span class="keyword">except</span> SomeTypeError:</span><br><span class="line">    method_deal_with_this_error</span><br><span class="line"><span class="keyword">except</span> SomeOtherError:</span><br><span class="line">    other_method_for_this_error</span><br><span class="line"></span><br><span class="line"><span class="comment">## 一个具体例子</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> speedyjson <span class="keyword">import</span> load</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> json <span class="keyword">import</span> load</span><br></pre></td></tr></table></figure>

<h3 id="finally-版本"><a href="#finally-版本" class="headerlink" title="finally 版本"></a>finally 版本</h3><p>这种情况下如果没有 exception 出现，那么先执行 try block 再执行 finally block；<br>如果有 exception 出现并且被 except 捕捉到，那么先执行 try block，然后执行对应的 except block，最后是 finally block.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    run_some_stuff</span><br><span class="line"><span class="keyword">except</span> SomeTypeError:</span><br><span class="line">    method_1</span><br><span class="line"><span class="keyword">except</span> OtherTypeError:</span><br><span class="line">    method_2</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    necessary_stuff_need_to_be_done</span><br></pre></td></tr></table></figure>

<h3 id="exception-as-objects-more-configuations"><a href="#exception-as-objects-more-configuations" class="headerlink" title="exception as objects, more configuations"></a>exception as objects, more configuations</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Better version!</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">UPLOAD_ROOT = <span class="string">"/var/www/uploads/"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_upload_dir</span><span class="params">(username)</span>:</span></span><br><span class="line">    userdir = os.path.join(UPLOAD_ROOT, username)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.makedirs(userdir)</span><br><span class="line">    <span class="keyword">except</span> FileExistsError <span class="keyword">as</span> err:</span><br><span class="line">        logging.error(<span class="string">"Upload dir already exist: %s"</span>, err.filename)</span><br></pre></td></tr></table></figure>

<h3 id="raising-exceptions"><a href="#raising-exceptions" class="headerlink" title="raising exceptions"></a>raising exceptions</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">money_from_string</span><span class="params">(amount)</span>:</span></span><br><span class="line">  match = re.search(<span class="string">r'^\$(?P&lt;dollars&gt;\d+)\.(?P&lt;cents&gt;\d\d)$'</span>, amount)</span><br><span class="line">  <span class="comment"># Adding the next two lines here</span></span><br><span class="line">  <span class="keyword">if</span> match <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">"Invalid amount: "</span> + repr(amount))</span><br><span class="line">  dollars = int(match.group(<span class="string">'dollars'</span>))</span><br><span class="line">  cents = int(match.group(<span class="string">'cents'</span>))</span><br><span class="line">  <span class="keyword">return</span> Money(dollars, cents)</span><br></pre></td></tr></table></figure>

<h3 id="catching-and-re-raising"><a href="#catching-and-re-raising" class="headerlink" title="catching and re-raising"></a>catching and re-raising</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    do_something()</span><br><span class="line"><span class="keyword">except</span> ExceptionClass:</span><br><span class="line">    handle_exception()</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure>

<h2 id="python-类-class"><a href="#python-类-class" class="headerlink" title="python 类 class"></a>python 类 class</h2><h3 id="private-public-members"><a href="#private-public-members" class="headerlink" title="private/public members"></a>private/public members</h3><p>Python 跟 C++ 不一样，不是使用 “private” 和 “public” 关键词才定义 methods 和 attributes 是否公开的。Python 里使用默认的下划线 _ 来说明一个 method 和 attribute 的性质。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 没有前置下划线就是 public</span></span><br><span class="line"><span class="comment"># 2. 前置单下划线的 method 或 attribute，在类定义中可以调用和访问，</span></span><br><span class="line"><span class="comment">#    类的实例可以直接访问，子类中可以访问；另外，前置单下划线常用语模块中，被当做模块内部的变量和函数。</span></span><br><span class="line"><span class="comment">#    From some_module import * 时不会被导入。但是用 import some_module 后还是可以用</span></span><br><span class="line"><span class="comment">#    some_module._some_var 来调用的。</span></span><br><span class="line"><span class="comment"># 3. 前置双下划线的函数或属性，在类定义中可以调用和访问，</span></span><br><span class="line"><span class="comment">#    类的实例不可以直接访问，子类不可访问。因为名字被改了(name mangling)，参见第4.</span></span><br><span class="line"><span class="comment"># 4. 但是注意，虽然第 3 点说了 Python 不允许类的实例访问私有数据，</span></span><br><span class="line"><span class="comment">#    但是可以使用 object._className__attrName 来访问。</span></span><br><span class="line"><span class="comment"># 5. 前后都是双下划线的情况，留给 python 自己内部的一些 magic methods，自己写 class 时候不要用！</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__private</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        print(<span class="string">"private value in Base"</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_protected</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        print(<span class="string">"protected value in Base"</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">public</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        print(<span class="string">"public value in Base"</span>)  </span><br><span class="line">        self.__private()  </span><br><span class="line">        self._protected()  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span><span class="params">(Base)</span>:</span>  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__private</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        print(<span class="string">"override private"</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_protected</span><span class="params">(self)</span>:</span>  </span><br><span class="line">        print(<span class="string">"override protected"</span>)  </span><br><span class="line">        </span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">In [103]: d = Derived()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [104]: d.__private()</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">AttributeError                            Traceback (most recent call last)</span></span><br><span class="line"><span class="string">&lt;ipython-input-104-200093705fee&gt; in &lt;module&gt;()</span></span><br><span class="line"><span class="string">----&gt; 1 d.__private()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">AttributeError: 'Derived' object has no attribute '__private'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [105]: d._protected()</span></span><br><span class="line"><span class="string">override protected</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [106]: d.public()</span></span><br><span class="line"><span class="string">public value in Base</span></span><br><span class="line"><span class="string">private value in Base    # 注意这里，子类的私有方法没有执行，说明没法覆盖父类的。</span></span><br><span class="line"><span class="string">override protected      # 子类的 protected 方法执行了。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [107]: d._Base__private()</span></span><br><span class="line"><span class="string">private value in Base</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [108]: d._Base__private()</span></span><br><span class="line"><span class="string">private value in Base</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [109]: d._Derived__private()</span></span><br><span class="line"><span class="string">override private</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>

<h3 id="A-big-difference-between-python-2-and-3-when-writing-classes"><a href="#A-big-difference-between-python-2-and-3-when-writing-classes" class="headerlink" title="A big difference between python 2 and 3 when writing classes"></a>A big difference between python 2 and 3 when writing classes</h3><ol>
<li>In Python 2, you need to explicitly inherit your class from <strong>object</strong></li>
<li>In Python 3, you dont need to write that.</li>
</ol>
<h3 id="动态-add-attribute-method-to-a-class-instance"><a href="#动态-add-attribute-method-to-a-class-instance" class="headerlink" title="动态 add attribute/method to a class/instance"></a>动态 add attribute/method to a class/instance</h3><p>动态编程语言 是 高级程序设计语言 的一个类别，在计算机科学领域已被广泛应用。它是一类 在运行时可以改变其结构的语言 ：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。动态语言目前非常具有活力。例如JavaScript便是一个动态语言，除此之外如 PHP 、 Ruby 、 Python 等也都属于动态语言，而 C 、 C++ 等语言则不属于动态语言。—-来自 维基百科</p>
<h4 id="动态给instance添加属性"><a href="#动态给instance添加属性" class="headerlink" title="动态给instance添加属性"></a>动态给instance添加属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name = None, age = None)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P = Person(<span class="string">"小明"</span>, <span class="string">"24"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.sex = <span class="string">"male"</span>  <span class="comment"># 实例 P 本来没有 .sex 这个属性的</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(P.sex)</span><br><span class="line"><span class="string">"male"</span></span><br></pre></td></tr></table></figure>

<p>给 instance 添加的 attribute 不会令其他 instances 拥有这个 attribute</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>P2 = Person(<span class="string">"John"</span>, <span class="string">"25"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(P2.sex)</span><br><span class="line"><span class="comment"># 此处会报错</span></span><br></pre></td></tr></table></figure>

<h4 id="动态给class添加属性"><a href="#动态给class添加属性" class="headerlink" title="动态给class添加属性"></a>动态给class添加属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person.sex = <span class="string">"None"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(P2.sex)</span><br><span class="line"><span class="string">"None"</span></span><br></pre></td></tr></table></figure>

<h4 id="动态给-class-添加-method"><a href="#动态给-class-添加-method" class="headerlink" title="动态给 class 添加 method"></a>动态给 class 添加 method</h4><p>对于 methods，给 class 添加 method 跟添加 attribute 的语法一模一样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, speed)</span>:</span></span><br><span class="line">        print(<span class="string">"%s is running at a speed of %d km/s."</span> % (self.name, speed))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person.run = run</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P2.run(<span class="number">50</span>)</span><br><span class="line"><span class="string">"John is running at a speed of 50 km/s."</span></span><br></pre></td></tr></table></figure>

<p>上面的代码是把一个函数 bound to a class.</p>
<p>Bound methods have been “bound” (how descriptive) to an instance, and that instance will be passed as the first argument whenever the method is called.</p>
<p>这下你明白了 class member function 里面的 self 含义了吧。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>run</span><br><span class="line">&lt;function run at <span class="number">0x103f7dc80</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Person.run</span><br><span class="line">&lt;unbound method Person.run&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P2.run</span><br><span class="line">&lt;bound method Person.run of &lt;__main__.Person object at <span class="number">0x103f8dbd0</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="动态给实例添加-methods"><a href="#动态给实例添加-methods" class="headerlink" title="动态给实例添加 methods"></a>动态给实例添加 methods</h4><p>跟给实例添加属性不一样，不能直接使用 = 号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">"walking"</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk = walk</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: barFighters() takes exactly <span class="number">1</span> argument (<span class="number">0</span> given)</span><br></pre></td></tr></table></figure>

<p>The function is not automatically bound when it’s attached directly to an instance:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk</span><br><span class="line">&lt;function walk at <span class="number">0x00A98EF0</span>&gt;</span><br></pre></td></tr></table></figure>

<p>To bind it, we can use the MethodType function in the types module:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> types</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk = types.MethodType( walk, P)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk</span><br><span class="line">&lt;bound method ?.walk of &lt;__main__.P instance at 0x00A9BC88&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.walk()</span><br><span class="line"><span class="string">"walking"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P2.walk()</span><br><span class="line"><span class="comment"># 报错了, walk() 只关联了 instance P，所以 P2 没有。</span></span><br></pre></td></tr></table></figure>

<h4 id="slot-定义可添加属性"><a href="#slot-定义可添加属性" class="headerlink" title="__slot__定义可添加属性"></a>__slot__定义可添加属性</h4><p>使用__slot__ 可以限制那些属性可以被动态添加</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>    __slot__ = (<span class="string">"name"</span>, <span class="string">"age"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P = Person()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.name = <span class="string">"John"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.age = <span class="number">16</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>P.sex = <span class="string">"Male"</span>  <span class="comment"># 这里会报错，不能动态添加 sex 属性</span></span><br></pre></td></tr></table></figure>




<h3 id="Property"><a href="#Property" class="headerlink" title="Property"></a>Property</h3><p>Python 里一个很厉害的地方就在于存在 property, 这个概念介于 method 和 attribute 中间。用法就是用 “@property” 把一个 method 修饰(decorator)成 property。这样就可以用类似于调用 attribute 的方法去调用 method. 这样子得到的 property 是 read-only.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, firstname, lastname)</span>:</span></span><br><span class="line">        self.firstname = firstname</span><br><span class="line">        self.lastname = lastname</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fullname</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.firstname + <span class="string">" "</span> + self.lastname</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Person(<span class="string">"Joe"</span>, <span class="string">"Smith"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe.fullname</span><br><span class="line"><span class="string">'Joe Smith'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意上面不是用 joe.fullname()，如果你用了会报错</span></span><br></pre></td></tr></table></figure>
<p>注意 如果你试图用 joe.fullname = “John Smith” 去修改，也会报错。上面的 @property 只是定义了一个 getter, 不是 setter。setter 的定义方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, firstname, lastname)</span>:</span></span><br><span class="line">        self.firstname = firstname</span><br><span class="line">        self.lastname  = lastname</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fullname</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.firstname + <span class="string">" "</span> + self.lastname</span><br><span class="line"><span class="meta">    @fullname.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fullname</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.firstname, self.lastname = value.split(<span class="string">" "</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Person(<span class="string">"Joe"</span>, <span class="string">"Smith"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe.fullname</span><br><span class="line"><span class="string">"Joe Smite"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe.fullname = <span class="string">"John Smith"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe.fullname</span><br><span class="line"><span class="string">"John Smith"</span></span><br></pre></td></tr></table></figure>

<h3 id="活用-property-写安全的-class"><a href="#活用-property-写安全的-class" class="headerlink" title="活用 property 写安全的 class"></a>活用 property 写安全的 class</h3><ol>
<li>property 在 python class 内部也可以调用.</li>
<li>下面的例子就在 constructor 里面调用了 price.setter</li>
<li>This implementation <mark>centralizes all reads and writes of self._price in the property, which is a useful encapsulation in general.</mark><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Final version, with modified constructor. (Constructor</span></span><br><span class="line"><span class="comment"># is different; code for getter &amp; setter is the same.)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ticket</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, price)</span>:</span></span><br><span class="line">        <span class="comment"># instead of "self._price = price"</span></span><br><span class="line">        self.price = price</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._price</span><br><span class="line"><span class="meta">    @price.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">price</span><span class="params">(self, new_price)</span>:</span></span><br><span class="line">        <span class="comment"># Only allow positive prices.</span></span><br><span class="line">        <span class="keyword">if</span> new_price &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Nice try"</span>)</span><br><span class="line">        self._price = new_price</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="活用-property-来-refactoring-lagacy-code"><a href="#活用-property-来-refactoring-lagacy-code" class="headerlink" title="活用 property 来 refactoring lagacy code"></a>活用 property 来 refactoring lagacy code</h3><p>使用场景：如果有一天，你想用另外的 attributes 去代替本来的 attributes，因为新的 attributes 更方便，似的你的 code 更加简洁。这个时候，万一有其他人的 code 里面直接调用了 本来的 attribute，就会出错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 老 code</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Money</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dollars, cents)</span>:</span></span><br><span class="line">        self.dollars = dollars</span><br><span class="line">        self.cents = cents</span><br><span class="line">    <span class="comment"># And some other methods...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 新的 code</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Money</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dollars, cents)</span>:</span></span><br><span class="line">        self.total_cents = dollars * <span class="number">100</span> + cents</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Getter and setter for dollars...</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dollars</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.total_cents // <span class="number">100</span></span><br><span class="line"><span class="meta">    @dollars.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dollars</span><span class="params">(self, new_dollars)</span>:</span></span><br><span class="line">        self.total_cents = <span class="number">100</span> * new_dollars + self.cents</span><br><span class="line"></span><br><span class="line">    <span class="comment"># And for cents.</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cents</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.total_cents % <span class="number">100</span></span><br><span class="line"><span class="meta">    @cents.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">cents</span><span class="params">(self, new_cents)</span>:</span></span><br><span class="line">        self.total_cents = <span class="number">100</span> * self.dollars + new_cents</span><br></pre></td></tr></table></figure>

<p>看出来了吧，python 里面 refactoring code 很方便，对于 java 程序员来说，情况往往是下面这个样子的：</p>
<ol>
<li>A newbie developer starts writing Java classes. They want to expose some state, so create public member variables.</li>
<li>They use this class everywhere. Other developers use it too.</li>
<li>One day, they want to change the name or type of that member variable, or even do away with it entirely (like what we did with Money).</li>
<li>But that would break everyone’s code. So they can’t.</li>
</ol>
<p>Because of this, Java developers quickly learn to make all their variables private by default - proactively creating getters and setters for every publicly<br>exposed chunk of data. They realize this boilerplate is far less painful than the<br>alternative, because if everyone must use the public getters and setters to<br>begin with, you always have the freedom to make internal changes later.</p>
<h3 id="Factory-Patterns"><a href="#Factory-Patterns" class="headerlink" title="Factory Patterns"></a>Factory Patterns</h3><p>参见单独的文章</p>
<h3 id="Observer-Patterns"><a href="#Observer-Patterns" class="headerlink" title="Observer Patterns"></a>Observer Patterns</h3><p>参见单独的文章</p>
<h3 id="Magic-method-实际就是一些运算符的定义，重载"><a href="#Magic-method-实际就是一些运算符的定义，重载" class="headerlink" title="Magic method (实际就是一些运算符的定义，重载)"></a>Magic method (实际就是一些运算符的定义，重载)</h3><p>常见的 magic methods:</p>
<ul>
<li>__add__               a + b</li>
<li>__sub__               a - b</li>
<li>__mul__               a * b</li>
<li>__truediv__           a / b (floating-point division)</li>
<li>__mod__               a % b</li>
<li>__pow__               a ** b</li>
<li>也可以定义 bit 操作</li>
<li>__lshift__</li>
<li>__rshift__</li>
<li>__and__</li>
<li>__xor__</li>
<li>__or__<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Angle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value % <span class="number">360</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Angle(self.value + other.value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有了上面的定义，我们就可以执行下面的语句了。</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>total = Angle(<span class="number">30</span>) + Angle(<span class="number">45</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>total.value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本质上，python 把 a + b 看成 a.__add__(b)</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>__str__ 操作符: print() function, str() 和 string formating 操作会调用这个 magic method</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&#123;&#125; degrees'</span>.format(self.value)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(Angle(<span class="number">30</span>))</span><br><span class="line"><span class="number">30</span> degrees</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>str(Angle(<span class="number">45</span>))</span><br><span class="line"><span class="string">'45 degrees'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'&#123;&#125;'</span>.format(Angle(<span class="number">30</span>) + Angle(<span class="number">45</span>)))</span><br><span class="line"><span class="number">75</span> degrees</span><br></pre></td></tr></table></figure>

<p>__repr__ 方法：这个方法的输出是 用来重新生成这个 object。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Angle(&#123;&#125;)'</span>.format(self.value)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>repr(Angle(<span class="number">30</span>))</span><br><span class="line"><span class="string">'Angle(30)'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(<span class="string">'&#123;!r&#125;'</span>.format(Angle(<span class="number">30</span>) + Angle(<span class="number">45</span>)))</span><br><span class="line">Angle(<span class="number">75</span>)</span><br></pre></td></tr></table></figure>

<p>比较运算符：</p>
<ul>
<li>__eq__</li>
<li>__ne__</li>
<li>__lt__</li>
<li>__le__</li>
<li>__gt__</li>
<li>__ge__</li>
</ul>
<h2 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h2><p>一般人平时调试程序的时候，可能会在代码中不同的位置写很多 print 语句，以观察程序到底在哪里终止了。<br>这样做有一个比较烦人的地方就是，如果你改好了一个地方，其他地方有错，你可能需要把某些 print 语句注释掉。<br>如此反复，显得很麻烦。</p>
<p>logging 的一个好处是它有五种不同的输出等级。你可以通过调节输出的 threshold 来控制那些内容会输出。<br>比如在开发阶段，INFO 信息会非常有用，因此你希望输出它们。但是在 production 阶段，你就只希望看到<br>那些真正出错的信息了。此时只需要改动一句话去修改 threshold 就好了，如果本来写的是很多 print 语句，<br>那还得一个一个的找到它们并且注释掉。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面的五个 logging 严重程度依次递增</span></span><br><span class="line"><span class="comment"># 默认情况下 debug 和 info 等级是不会输出到 console 的。</span></span><br><span class="line">logging.debug(<span class="string">"Small detail. Useful for troubleshooting."</span>)</span><br><span class="line">logging.info(<span class="string">"This is informative."</span>)</span><br><span class="line">logging.warning(<span class="string">"This is a warning message."</span>)</span><br><span class="line">logging.error(<span class="string">"Uh oh. Something went wrong."</span>)</span><br><span class="line">logging.critical(<span class="string">"We have a big problem!"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 threshold</span></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logging.debug(<span class="string">"This message will not be shown"</span>)</span><br><span class="line">logging.error(<span class="string">"This message will be shown"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="passing-arguments-to-logging"><a href="#passing-arguments-to-logging" class="headerlink" title="passing arguments to logging"></a>passing arguments to logging</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># good way</span></span><br><span class="line">num_fruits = <span class="number">14</span></span><br><span class="line">fruit_name = <span class="string">"apple"</span></span><br><span class="line">logging.info(<span class="string">"We ate %d of your %s. Thanks!"</span>, num_fruits, fruit_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bad way 1</span></span><br><span class="line">logging.warning(<span class="string">"We ate %d of your %s."</span> % (num_fruits, fruit_name))</span><br><span class="line"></span><br><span class="line"><span class="comment"># bad way 2</span></span><br><span class="line">logging.warning(<span class="string">"We ate &#123;:d&#125; of your &#123;:s&#125;."</span>.format(num_fruits, fruit_name))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后两种方法之所以不好，主要原因就是效率问题。</span></span><br><span class="line"><span class="comment"># 如果当前的 logging level 是的这一个 logging 不输出，那么这两个语句中的 string format 仍然会执行。</span></span><br><span class="line"><span class="comment"># 而第一种方法不会执行 format string.</span></span><br></pre></td></tr></table></figure>

<h3 id="logging-to-different-locations-with-different-threshold"><a href="#logging-to-different-locations-with-different-threshold" class="headerlink" title="logging to different locations with different threshold"></a>logging to different locations with different threshold</h3><ul>
<li>WatchedFileHandler and RotatingFileHandler, for logging to rotated log files</li>
<li>SocketHandler and DatagramHandler for logging over network sockets</li>
<li>HTTPHandler for logging over an HTTP REST interface</li>
<li>QueueHandler and QueueListener for queuing log records across thread and process boundaries<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logger = logging.getLogger()</span><br><span class="line">logger.setLevel(logging.DEBUG)</span><br><span class="line"><span class="comment"># Warnings and higher only on the console.</span></span><br><span class="line">console_handler = logging.StreamHandler()</span><br><span class="line">console_handler.setLevel(logging.WARNING)</span><br><span class="line">logger.addHandler(console_handler)</span><br><span class="line"><span class="comment"># But allow everything to into the log file.</span></span><br><span class="line">logfile_handler = logging.FileHandler(<span class="string">"log.txt"</span>)</span><br><span class="line">logger.addHandler(logfile_handler)</span><br><span class="line">logger.warning(<span class="string">"This goes to both the console, AND into log.txt."</span>)</span><br><span class="line">logger.debug(<span class="string">"While this only goes to the file."</span>)</span><br></pre></td></tr></table></figure>
Note: 有一点要注意，a handler can only make itself more selective than its logger.</li>
</ul>
<h2 id="资料来源"><a href="#资料来源" class="headerlink" title="资料来源"></a>资料来源</h2><p>《OOD Powerful Python》</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/" itemprop="url">机器学习的损失函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-23T17:15:07-08:00">
                2017-11-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/23/机器学习的损失函数/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/08/First-Day/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zheng Xing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/08/First-Day/" itemprop="url">First Day</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-08T14:15:05-08:00">
                2017-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/beginning/" itemprop="url" rel="index">
                    <span itemprop="name">beginning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/08/First-Day/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/08/First-Day/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="This-is-just-a-test"><a href="#This-is-just-a-test" class="headerlink" title="This is just a test!"></a>This is just a test!</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/%5C/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/%5C/">1</a><a class="page-number" href="/%5C/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Zheng Xing" />
            
              <p class="site-author-name" itemprop="name">Zheng Xing</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zheng Xing</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  

    
      <script id="dsq-count-scr" src="https://githubio-2.disqus.com/count.js" async></script>
    

    

  




	





  











<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>



  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
